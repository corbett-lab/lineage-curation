import{s as y,ad as oo,ae as eo,O as C,u as d,af as w,ag as u}from"./JBrowsePanel-CjeUdi3D-Dhrr89W5.js";import"./index-Bwk-R6QR.js";import"./taxonium-component.es-D8UFPkMd.js";function ro(t,x){const l=t.toHsl(),m=l.l*(1+x);return w.colord({...l,l:d.clamp(m,0,100)})}function to(t,x){const l=t.toHsl(),m=l.l*(1-x);return w.colord({...l,l:d.clamp(m,0,100)})}const P=.3,W=2;function so(t,x){const{features:l,bpPerPx:m,regions:X,scaleOpts:I,height:z,config:v,ticks:Z,displayCrossHatches:_,offset:N=0,colorCallback:g,inverted:q,stopToken:k}=x,h=X[0],D=(h.end-h.start)/m,V=z-N*2,J=y.readConfObject(v,"filled"),K=y.readConfObject(v,"clipColor"),Y=y.readConfObject(v,"summaryScoreMode"),A=y.readConfObject(v,"bicolorPivotValue"),M=y.readConfObject(v,"minSize"),B=oo({...I,range:[0,V],inverted:q}),L=eo(I.scaleType),G=B.domain(),O=G[0],j=G[1],i=o=>d.clamp(V-(B(o)||0),0,V)+N,Q=o=>i(L)-i(o),S=o=>J?Q(o):Math.max(M,1);let b=!1,H=Number.NEGATIVE_INFINITY;const E=[],F=O<A&&j>A;let n=performance.now();if(Y==="whiskers"){let o,a;n=performance.now();for(const e of l.values()){performance.now()-n>400&&(C.checkStopToken(k),n=performance.now());const[r,f]=d.featureSpanPx(e,h,m);if(e.get("summary")){const s=Math.max(f-r+P,M),c=e.get("maxScore"),p=g(e,c),T=F?p:p===o?a:a=ro(w.colord(p),.4).toHex();u(r,i(c),s,S(c),t,T),o=p}}a=void 0,o=void 0,n=performance.now();for(const e of l.values()){performance.now()-n>400&&(C.checkStopToken(k),n=performance.now());const[r,f]=d.featureSpanPx(e,h,m),s=e.get("score"),c=e.get("maxScore"),p=e.get("minScore"),T=e.get("summary"),R=g(e,s),U=F&&T?R===o?a:a=w.colord(g(e,c)).mix(w.colord(g(e,p))).toString():R,$=Math.max(f-r+P,M);(Math.floor(r)!==Math.floor(H)||f-r>1)&&(E.push(e),H=r),b=b||s<O||s>j,u(r,i(s),$,S(s),t,U),o=R}a=void 0,o=void 0,n=performance.now();for(const e of l.values()){performance.now()-n>400&&(C.checkStopToken(k),n=performance.now());const[r,f]=d.featureSpanPx(e,h,m);if(e.get("summary")){const s=e.get("minScore"),c=g(e,s),p=Math.max(f-r+P,M),T=F?c:c===o?a:a=to(w.colord(c),.4).toHex();u(r,i(s),p,S(s),t,T),o=c}}}else{n=performance.now();for(const o of l.values()){performance.now()-n>400&&(C.checkStopToken(k),n=performance.now());const[a,e]=d.featureSpanPx(o,h,m);(Math.floor(a)!==Math.floor(H)||e-a>1)&&(E.push(o),H=a);const r=o.get("score"),f=g(o,r);b=b||r<O||r>j;const s=Math.max(e-a+P,M);if(Y==="max"){const c=o.get("summary")?o.get("maxScore"):r;u(a,i(c),s,S(c),t,f)}else if(Y==="min"){const c=o.get("summary")?o.get("minScore"):r;u(a,i(c),s,S(c),t,f)}else u(a,i(r),s,S(r),t,f)}}if(t.save(),b){t.fillStyle=K,n=performance.now();for(const o of l.values()){performance.now()-n>400&&(C.checkStopToken(k),n=performance.now());const[a,e]=d.featureSpanPx(o,h,m),r=e-a+P,f=o.get("score");f>j?u(a,N,r,W,t):f<O&&I.scaleType!=="log"&&u(a,z,r,W,t)}}if(t.restore(),_){t.lineWidth=1,t.strokeStyle="rgba(200,200,200,0.5)";for(const o of Z.values)t.beginPath(),t.moveTo(0,Math.round(i(o))),t.lineTo(D,Math.round(i(o))),t.stroke()}return{reducedFeatures:E}}export{so as drawXY};
