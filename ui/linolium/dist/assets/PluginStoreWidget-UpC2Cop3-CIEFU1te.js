const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DeletePluginDialog-C1O_uuQu-aPurxl9S.js","assets/index-Bwk-R6QR.js","assets/JBrowsePanel-CjeUdi3D-Dhrr89W5.js","assets/taxonium-component.es-D8UFPkMd.js","assets/AddCustomPluginDialog-ceT5X-GA-1eJFLcgN.js","assets/ExpandMore-D_3gmqEI-BdX02XnD.js","assets/Collapse-BxSvw4ja-BFsBk1wj.js","assets/DialogContentText-InFbTjBo-BLNq3_Le.js"])))=>i.map(i=>d[i]);
import{j as n,r as g,_ as M}from"./index-Bwk-R6QR.js";import{o as p,m as j,u,bP as A,U as h,T as d,B as C,c as k,bG as O,a4 as f,a as N,an as D,bO as E,bp as z,E as V,G as B,a3 as w,H as F,A as W,z as $}from"./JBrowsePanel-CjeUdi3D-Dhrr89W5.js";import{e as q}from"./Clear-Bq9BgXq5-zru5vVp-.js";import{u as b,x as y,S}from"./ExpandMore-D_3gmqEI-BdX02XnD.js";import{r as U}from"./Delete-DSU0jSiU-1j-ZpVRl.js";import{a as H}from"./ListItem-BegJmGel-CD2nrZTw.js";import{T as Y,U as G}from"./CardContent-Di2YOEAl-B4_V9uGq.js";import{q as J,O as X,o as c}from"./taxonium-component.es-D8UFPkMd.js";import"./Collapse-BxSvw4ja-BFsBk1wj.js";function K(e){return W("MuiCardActions",e)}$("MuiCardActions",["root","spacing"]);const Q=e=>{const{classes:s,disableSpacing:i}=e;return F({root:["root",!i&&"spacing"]},K,s)},Z=B("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(e,s)=>{const{ownerState:i}=e;return[s.root,!i.disableSpacing&&s.spacing]}})({display:"flex",alignItems:"center",padding:8,variants:[{props:{disableSpacing:!1},style:{"& > :not(style) ~ :not(style)":{marginLeft:8}}}]}),P=g.forwardRef(function(e,s){const i=V({props:e,name:"MuiCardActions"}),{disableSpacing:t=!1,className:a,...o}=i,r={...i,disableSpacing:t},m=Q(r);return n.jsx(Z,{className:J(m.root,a),ownerState:r,ref:s,...o})});X.env.NODE_ENV!=="production"&&(P.propTypes={children:c.node,classes:c.object,className:c.string,disableSpacing:c.bool,sx:c.oneOfType([c.arrayOf(c.oneOfType([c.func,c.object,c.bool])),c.func,c.object])});const nn=h(n.jsx("path",{d:"M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"}),"InfoOutlined"),en=h(n.jsx("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2m3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1s3.1 1.39 3.1 3.1z"}),"Lock");function sn(){const[e,s]=g.useState(),[i,t]=g.useState();return g.useEffect(()=>{(async()=>{try{const a=await fetch("https://jbrowse.org/plugin-store/plugins.json");if(!a.ok){const r=await a.text();throw new Error(`HTTP ${a.status} fetching plugins: ${r}`)}const o=await a.json();s(o.plugins)}catch(a){console.error(a),t(a)}})()},[]),{plugins:e,error:i}}function an(e,s){const{pluginManager:i}=u.getEnv(s);return u.isSessionWithSessionPlugins(s)?s.sessionPlugins.some(t=>{var a;return((a=i.pluginMetadata[e.name])===null||a===void 0?void 0:a.url)===t.url}):!1}const tn=g.lazy(()=>M(()=>import("./DeletePluginDialog-C1O_uuQu-aPurxl9S.js"),__vite__mapDeps([0,1,2,3]))),T=j()(()=>({iconMargin:{marginRight:"0.5rem"}}));function on(){const{classes:e}=T();return n.jsx(w,{className:e.iconMargin,title:"This plugin was installed by an administrator, you cannot remove it.",children:n.jsx("span",{children:n.jsx(f,{disabled:!0,children:n.jsx(en,{})})})})}const rn=p(function({plugin:e,model:s}){const{classes:i}=T(),{pluginManager:t}=u.getEnv(s),a=u.getSession(s),{jbrowse:o,adminMode:r}=a;return n.jsx(w,{className:i.iconMargin,title:"Uninstall plugin",children:n.jsx(f,{"data-testid":`removePlugin-${e.name}`,onClick:()=>{a.queueDialog(m=>[tn,{plugin:e.name,onClose:l=>{if(l){const x=t.pluginMetadata[e.name];r?o.removePlugin(x):E.isSessionWithSessionPlugins(a)&&a.removeSessionPlugin(x)}m()}}])},children:n.jsx(U,{})})})}),ln=p(function({plugin:e,model:s}){const i=u.getSession(s),{adminMode:t}=i;return n.jsxs(H,{children:[t||an(e,i)?n.jsx(rn,{plugin:e,model:s}):n.jsx(on,{}),n.jsx(d,{children:[e.name,e.version?`(v${e.version})`:""].filter(a=>!!a).join(" ")})]},e.name)}),cn=p(function({pluginManager:e,model:s}){const{plugins:i}=e,{filterText:t}=s,a=i.filter(o=>{var r;return!(!((r=e.pluginMetadata[o.name])===null||r===void 0)&&r.isCore)});return n.jsx(D,{children:a.length>0?a.filter(o=>o.name.toLowerCase().includes(t.toLowerCase())).map(o=>n.jsx(ln,{plugin:o,model:s},o.name)):n.jsx(d,{children:"No plugins currently installed"})})}),dn=h(n.jsx("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check"),un=h(n.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"Person"),mn=j()({card:{margin:"0.5em"},icon:{marginLeft:"0.5em",marginRight:"0.5em"},bold:{fontWeight:600},dataField:{display:"flex",alignItems:"center"},mr:{marginRight:"0.5em"}}),gn=p(function({plugin:e,model:s}){const{classes:i}=mn(),t=u.getSession(s),{pluginManager:a}=u.getEnv(s),{runtimePluginDefinitions:o}=a,r=o.some(v=>"url"in v&&v.url===e.url),[m,l]=g.useState(!1),{adminMode:x,jbrowse:I}=t,{name:_,authors:L,description:R}=e;return n.jsxs(Y,{variant:"outlined",className:i.card,children:[n.jsxs(G,{children:[n.jsx(d,{variant:"h5",children:n.jsx(N.ExternalLink,{href:`${e.location}#readme`,children:e.name})}),n.jsxs("div",{className:i.dataField,children:[n.jsx(un,{className:i.mr}),n.jsx(d,{children:L.join(", ")})]}),n.jsx(d,{className:i.bold,children:"Description:"}),n.jsx(d,{children:R})]}),n.jsx(P,{children:n.jsx(C,{variant:"contained",disabled:r||m,startIcon:r?n.jsx(dn,{}):n.jsx(z,{}),onClick:()=>{x?I.addPlugin(e):E.isSessionWithSessionPlugins(t)?t.addSessionPlugin(e):t.notify("No way to install plugin"),l(!0)},children:r?"Installed":"Install"})})]},_)}),pn=g.lazy(()=>M(()=>import("./AddCustomPluginDialog-ceT5X-GA-1eJFLcgN.js"),__vite__mapDeps([4,1,2,3,5,6,7]))),xn=j()(e=>({expandIcon:{color:e.palette.tertiary.contrastText},adminBadge:{borderRadius:3,backgroundColor:e.palette.quaternary.main,padding:"1em",display:"flex",alignContent:"center"},customPluginButton:{margin:"1em auto",display:"flex"},mr:{marginRight:"0.3em"},m:{margin:"1em"}})),Nn=p(function({model:e}){const{classes:s}=xn(),{plugins:i,error:t}=sn(),{filterText:a}=e,o=u.getSession(e),{adminMode:r}=o,{pluginManager:m}=A(e);return n.jsxs("div",{children:[r&&n.jsxs(n.Fragment,{children:[!u.isElectron&&n.jsxs("div",{className:s.adminBadge,children:[n.jsx(nn,{className:s.mr}),n.jsxs(d,{children:["You are using the ",n.jsx("code",{children:"admin-server"}),". Any changes you make will be saved to your configuration file. You also have the ability to add custom plugins that are not in the store."]})]}),n.jsx(C,{className:s.customPluginButton,variant:"contained",onClick:()=>{o.queueDialog(l=>[pn,{model:e,onClose:l}])},children:"Add custom plugin"})]}),n.jsx(k,{label:"Filter plugins",value:a,onChange:l=>{e.setFilterText(l.target.value)},fullWidth:!0,slotProps:{input:{endAdornment:n.jsx(O,{position:"end",children:n.jsx(f,{onClick:()=>{e.clearFilterText()},children:n.jsx(q,{})})})}}}),n.jsxs(b,{defaultExpanded:!0,children:[n.jsx(y,{expandIcon:n.jsx(S,{className:s.expandIcon}),children:n.jsx(d,{variant:"h5",children:"Installed plugins"})}),n.jsx("div",{className:s.m,children:n.jsx(cn,{pluginManager:m,model:e})})]}),n.jsxs(b,{defaultExpanded:!0,children:[n.jsx(y,{expandIcon:n.jsx(S,{className:s.expandIcon}),children:n.jsx(d,{variant:"h5",children:"Available plugins"})}),t?n.jsx(d,{color:"error",children:`${t}`}):i?i.filter(l=>!(u.isElectron&&l.cjsUrl)&&l.name.toLowerCase().includes(a.toLowerCase())).map(l=>n.jsx(gn,{plugin:l,model:e},l.name)):n.jsx(N.LoadingEllipses,{})]})]})});export{Nn as default};
