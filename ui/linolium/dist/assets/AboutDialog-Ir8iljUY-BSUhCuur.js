import{j as t,r as l}from"./index-Bwk-R6QR.js";import{s as k}from"./Dialog-p0A-Q_LV-CuILaiC_.js";import{u as m,t as S,o as v,s as g,m as y,B as C,aN as E,bJ as O,a as x,D as $}from"./JBrowsePanel-CjeUdi3D-Dhrr89W5.js";import{Q as L}from"./taxonium-component.es-D8UFPkMd.js";import{t as b}from"./BaseCard-Bb7pKL_2-B3TEoNCR.js";var R=O();const h=L(R);function U({config:e}){const[s,n]=l.useState(),[o,c]=l.useState(),r=m.getSession(e),{rpcManager:f}=r;l.useEffect(()=>{(async()=>{try{const i=g.readConfObject(e,"adapter"),u=await f.call(e.trackId,"CoreGetInfo",{adapterConfig:i});c(u)}catch(i){console.error(i),n(i)}})()},[e,f]);const p=typeof o=="string"?{header:`<pre>${o.replaceAll("<","&lt;").replaceAll(">","&gt;")}</pre>`}:o||{};return t.jsx(b,{title:"File info",children:s?t.jsx(x.ErrorMessage,{error:s}):o===void 0?t.jsx(x.LoadingEllipses,{message:"Loading file data"}):t.jsx(h,{attributes:p})})}function M(e,s){for(const n in e)n===s?delete e[n]:typeof e[n]=="object"&&M(e[n],s);return e}function P({config:e,pluginManager:s}){const n=m.getSession(e),o=g.readConfObject(e);return s.evaluateExtensionPoint("Core-customizeAbout",{config:{...o,...g.getConf(n,["formatAbout","config"],{config:o}),...g.readConfObject(e,["formatAbout","config"],{config:o})}},{session:n,config:e})}const T=y()({button:{float:"right"}});function W({conf:e,setShowRefNames:s}){const[n,o]=l.useState(!1),{classes:c}=T();return t.jsxs("span",{className:c.button,children:[t.jsx(C,{variant:"contained",color:"secondary",onClick:()=>{s(!0)},children:"Show ref names"}),t.jsx(C,{variant:"contained",onClick:()=>{const r=M(structuredClone(e),"baseUri");E(JSON.stringify(r,null,2)),o(!0),setTimeout(()=>{o(!1)},1e3)},children:n?"Copied to clipboard!":"Copy config"})]})}const N=1e4,G=y()(e=>({container:{minWidth:800},refNames:{maxHeight:300,overflow:"auto",flexGrow:1,background:e.palette.background.default}})),I=v(function({config:e,onClose:s}){const{classes:n}=G(),[o,c]=l.useState(),[r,f]=l.useState(),[p,i]=l.useState(!1),{rpcManager:u}=m.getSession(e);l.useEffect(()=>{(async()=>{try{const a=await Promise.all([...new Set(S.getConfAssemblyNames(e))].map(async d=>{const A=g.readConfObject(e,"adapter");return[d,await u.call(e.trackId,"CoreGetRefNames",{adapterConfig:A,regions:[{assemblyName:d}]})]}));f(Object.fromEntries(a))}catch(a){console.error(a),c(a)}})()},[e,u]);const j=r?Object.entries(r):[],w=j.flatMap(([a,d])=>[`--- ${a} ---`,...d.slice(0,N),d.length>N?`
Too many refNames to show in browser for ${a}, use "Copy ref names" button to copy to clipboard`:""]).filter(a=>!!a).join(`
`);return t.jsx(x.Dialog,{open:!0,title:"Reference sequence names used in track",onClose:s,maxWidth:"xl",children:t.jsx($,{className:n.container,children:o?t.jsx(x.ErrorMessage,{error:o}):r===void 0?t.jsx(x.LoadingEllipses,{message:"Loading refNames"}):t.jsxs(t.Fragment,{children:[t.jsx(C,{variant:"contained",onClick:()=>{E(j.flatMap(([a,d])=>[`--- ${a} ---`,...d]).filter(a=>!!a).join(`
`)),i(!0),setTimeout(()=>{i(!1)},1e3)},children:p?"Copied to clipboard!":"Copy ref names"}),t.jsx("pre",{className:n.refNames,children:w})]})})})}),D=y()({content:{minWidth:800}}),Q=v(function({config:e}){const s=g.readConfObject(e),n=m.getSession(e),{classes:o}=D(),[c,r]=l.useState(!1),f=g.getConf(n,["formatAbout","hideUris"])||g.readConfObject(e,["formatAbout","hideUris"]),{pluginManager:p}=m.getEnv(n),i=P({config:e,pluginManager:p}),u=p.evaluateExtensionPoint("Core-extraAboutPanel",null,{session:n,config:e}),j=["displays","baseUri","refNames","formatAbout"];return t.jsxs("div",{className:o.content,children:[t.jsxs(b,{title:"Configuration",children:[f?null:t.jsx(W,{conf:s,setShowRefNames:r}),t.jsx(h,{attributes:i.config,omit:[...j,"metadata"],hideUris:f})]}),i.config.metadata?t.jsx(b,{title:"Metadata",children:t.jsx(h,{attributes:i.config.metadata,omit:j,hideUris:f})}):null,u?t.jsx(b,{title:u.name,children:t.jsx(u.Component,{config:e})}):null,t.jsx(U,{config:e}),c?t.jsx(I,{config:e,onClose:()=>{r(!1)}}):null]})});function V({config:e,handleClose:s}){const n=m.getSession(e),o=S.getTrackName(e,n),{pluginManager:c}=m.getEnv(n),r=c.evaluateExtensionPoint("Core-replaceAbout",Q,{session:n,config:e});return t.jsx(k,{open:!0,onClose:s,title:o,maxWidth:"xl",children:t.jsx(r,{config:e})})}export{V as default};
