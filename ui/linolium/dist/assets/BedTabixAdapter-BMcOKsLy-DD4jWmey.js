import{J as C,K as b}from"./util-DIF6WZFN-BRzR6C_J.js";import{m as w}from"./tabixIndexedFile-kFQg_R3d-BgchFq_1.js";import"./unzip-CwWdnRSo-02Ze3MCz.js";import{e as N}from"./index-Bp4pXTEU-Cipcrd2k.js";import{a1 as c,u as m,O as u}from"./JBrowsePanel-CjeUdi3D-Dhrr89W5.js";import{o as S}from"./rxjs-euq-mp90-DvajfGj-.js";import"./AbortablePromiseCache-CcuMrnn7-56xRj2xE.js";import"./browser-BpRiKmO--zAOSyNoU.js";import"./remoteFile-DvhH--az-9OF1arfw.js";import"./taxonium-component.es-D8UFPkMd.js";import"./index-Bwk-R6QR.js";import"./index-CJFOLICt-oWu2Snlz.js";class k extends N.BaseFeatureDataAdapter{constructor(e,t,a){super(e,t,a);const r=this.getConf("bedGzLocation"),s=this.getConf(["index","indexType"]),i=this.getConf(["index","location"]),o=this.getConf("autoSql"),n=this.pluginManager;this.bed=new w({filehandle:c.openLocation(r,n),csiFilehandle:s==="CSI"?c.openLocation(i,n):void 0,tbiFilehandle:s!=="CSI"?c.openLocation(i,n):void 0,chunkCacheSize:50*2**20}),this.columnNames=this.getConf("columnNames"),this.scoreColumn=this.getConf("scoreColumn"),this.parser=new C({autoSql:o})}async getRefNames(e={}){return this.bed.getReferenceSequenceNames(e)}async getHeader(e){return this.bed.getHeader(e)}async getMetadataPre2(e){return this.setupP||(this.setupP=this.getMetadataPre().catch(t=>{throw this.setupP=void 0,t})),this.setupP}async getMetadataPre(){return{meta:await this.bed.getMetadata()}}async getMetadata(e){const{statusCallback:t=()=>{}}=e||{};return m.updateStatus("Downloading index",t,()=>this.getMetadataPre2(e))}async getNames(){if(this.columnNames.length)return this.columnNames;const e=(await this.getHeader()).split(/\n|\r\n|\r/).filter(t=>!!t).at(-1);return e!=null&&e.includes("	")?e.slice(1).split("	").map(t=>t.trim()):void 0}getFeatures(e,t){const{stopToken:a,statusCallback:r=()=>{}}=t||{};return S.ObservableCreate(async s=>{const{meta:i}=await this.getMetadata(),{columnNumbers:o}=i,n=o.ref-1,p=o.start-1,d=o.end-1,h=await this.getNames();let l=performance.now();u.checkStopToken(a),await m.updateStatus("Downloading features",r,()=>this.bed.getLines(e.refName,e.start,e.end,{lineCallback:(g,f)=>{performance.now()-l>200&&(u.checkStopToken(a),l=performance.now()),s.next(new m.SimpleFeature(b({line:g,colRef:n,colStart:p,colEnd:d,scoreColumn:this.scoreColumn,parser:this.parser,uniqueId:`${this.id}-${f}`,names:h})))},stopToken:a})),s.complete()},a)}}k.capabilities=["getFeatures","getRefNames"];export{k as default};
