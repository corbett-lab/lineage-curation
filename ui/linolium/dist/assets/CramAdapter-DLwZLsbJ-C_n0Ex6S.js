import{c as Ei}from"./crc32-CxoSWZf_-CJxmRem5.js";import{$ as _i,y as Qi}from"./remoteFile-DvhH--az-9OF1arfw.js";import{i as Si,Q as Ri,H as Vr}from"./taxonium-component.es-D8UFPkMd.js";import{r as vi}from"./browser-BpRiKmO--zAOSyNoU.js";import{l as Di}from"./index-CJFOLICt-oWu2Snlz.js";import{e as ki}from"./index-Bp4pXTEU-Cipcrd2k.js";import{a1 as Xr,$ as qi,a0 as Ni,u as ye,O as Fi,bW as Ti,bX as Pi,bV as Qr}from"./JBrowsePanel-CjeUdi3D-Dhrr89W5.js";import{s as Mi}from"./QuickLRU-Bsq1VS-k-DOcaC3o-.js";import{o as Li}from"./rxjs-euq-mp90-DvajfGj-.js";import"./index-Bwk-R6QR.js";var Oi=Object.defineProperty,xi=(t,e,r)=>e in t?Oi(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Vt=(t,e,r)=>xi(t,typeof e!="symbol"?e+"":e,r);const L={CRAM_FLAG_PRESERVE_QUAL_SCORES:1,CRAM_FLAG_DETACHED:2,CRAM_FLAG_MATE_DOWNSTREAM:4,CRAM_FLAG_NO_SEQ:8,BAM_FPAIRED:1,BAM_FPROPER_PAIR:2,BAM_FUNMAP:4,BAM_FMUNMAP:8,BAM_FREVERSE:16,BAM_FMREVERSE:32,BAM_FREAD1:64,BAM_FREAD2:128,BAM_FSECONDARY:256,BAM_FQCFAIL:512,BAM_FDUP:1024,BAM_FSUPPLEMENTARY:2048};function Ui(t,e){if(!t.lengthOnRef&&!t.readLength||t.isUnknownBases())return null;const r=t.alignmentStart-e.start;if(!t.readFeatures)return e.seq.slice(r,r+(t.lengthOnRef||0)).toUpperCase();let o="",n=r,i=0;for(;o.length<t.readLength;)if(i<t.readFeatures.length){const a=t.readFeatures[i];if(a.code==="Q"||a.code==="q")i+=1;else if(a.pos===o.length+1)if(i+=1,a.code==="b"){const s=a.data;o+=s,n+=s.length}else a.code==="B"?(o+=a.data[0],n+=1):a.code==="X"?(o+=a.sub,n+=1):a.code==="I"?o+=a.data:a.code==="D"?n+=a.data:a.code==="i"?o+=a.data:a.code==="N"?n+=a.data:a.code==="S"?o+=a.data:a.code==="P"||a.code;else if(i<t.readFeatures.length){const s=e.seq.slice(n,n+a.pos-o.length-1);o+=s,n+=s.length}}else{const a=e.seq.slice(n,n+t.readLength-o.length);o+=a,n+=a.length}return o.toUpperCase()}const Hi={a:0,A:0,c:1,C:1,g:2,G:2,t:3,T:3,n:4,N:4};function Yi(t,e,r,o){const n=o.refPos-e.start,i=e.seq.charAt(n);i&&(o.ref=i);let a=Hi[i];a===void 0&&(a=4);const s=r.substitutionMatrix[a][o.data];s&&(o.sub=s)}const Ji=[[1,"Paired"],[2,"ProperlyPaired"],[4,"SegmentUnmapped"],[8,"MateUnmapped"],[16,"ReverseComplemented"],[32,"MateReverseComplemented"],[64,"Read1"],[128,"Read2"],[256,"Secondary"],[512,"FailedQc"],[1024,"Duplicate"],[2048,"Supplementary"]],zi=[[1,"PreservingQualityScores"],[2,"Detached"],[4,"WithMateDownstream"],[8,"DecodeSequenceAsStar"]],Gi=[[1,"OnNegativeStrand"],[2,"Unmapped"]];function Sr(t){const e={};for(const[r,o]of t)e[`is${o}`]=n=>!!(n&r),e[`set${o}`]=n=>n|r;return e}const Xt=Sr(Ji),je=Sr(zi),Zr=Sr(Gi);class ji{constructor({flags:e,cramFlags:r,readLength:o,mappingQuality:n,lengthOnRef:i,qualityScores:a,mateRecordNumber:s,readBases:c,readFeatures:l,mateToUse:A,readGroupId:d,readName:u,sequenceId:g,uniqueId:I,templateSize:m,alignmentStart:f,tags:h}){this.flags=e,this.cramFlags=r,this.readLength=o,this.mappingQuality=n,this.lengthOnRef=i,this.qualityScores=a,c&&(this.readBases=c),this.readGroupId=d,this.readName=u,this.sequenceId=g,this.uniqueId=I,this.templateSize=m,this.alignmentStart=f,this.tags=h,l&&(this.readFeatures=l),A&&(this.mate={flags:A.mateFlags,readName:A.mateReadName,sequenceId:A.mateSequenceId,alignmentStart:A.mateAlignmentStart}),s&&(this.mateRecordNumber=s)}isPaired(){return!!(this.flags&L.BAM_FPAIRED)}isProperlyPaired(){return!!(this.flags&L.BAM_FPROPER_PAIR)}isSegmentUnmapped(){return!!(this.flags&L.BAM_FUNMAP)}isMateUnmapped(){return!!(this.flags&L.BAM_FMUNMAP)}isReverseComplemented(){return!!(this.flags&L.BAM_FREVERSE)}isMateReverseComplemented(){return!!(this.flags&L.BAM_FMREVERSE)}isRead1(){return!!(this.flags&L.BAM_FREAD1)}isRead2(){return!!(this.flags&L.BAM_FREAD2)}isSecondary(){return!!(this.flags&L.BAM_FSECONDARY)}isFailedQc(){return!!(this.flags&L.BAM_FQCFAIL)}isDuplicate(){return!!(this.flags&L.BAM_FDUP)}isSupplementary(){return!!(this.flags&L.BAM_FSUPPLEMENTARY)}isDetached(){return!!(this.cramFlags&L.CRAM_FLAG_DETACHED)}hasMateDownStream(){return!!(this.cramFlags&L.CRAM_FLAG_MATE_DOWNSTREAM)}isPreservingQualityScores(){return!!(this.cramFlags&L.CRAM_FLAG_PRESERVE_QUAL_SCORES)}isUnknownBases(){return!!(this.cramFlags&L.CRAM_FLAG_NO_SEQ)}getReadBases(){if(!this.readBases&&this._refRegion){const e=Ui(this,this._refRegion);e&&(this.readBases=e)}return this.readBases}getPairOrientation(){if(!this.isSegmentUnmapped()&&this.isPaired()&&!this.isMateUnmapped()&&this.mate&&this.sequenceId===this.mate.sequenceId){const e=this.isReverseComplemented()?"R":"F",r=this.isMateReverseComplemented()?"R":"F";let o=" ",n=" ";this.isRead1()?(o="1",n="2"):this.isRead2()&&(o="2",n="1");const i=[];let a=this.templateLength||this.templateSize;if(a===void 0)throw new Error("One of templateSize and templateLength must be set");return this.alignmentStart>this.mate.alignmentStart&&a>0&&(a=-a),a>0?(i[0]=e,i[1]=o,i[2]=r,i[3]=n):(i[2]=e,i[3]=o,i[0]=r,i[1]=n),i.join("")}return null}addReferenceSequence(e,r){this.readFeatures&&this.readFeatures.forEach(o=>{o.code==="X"&&Yi(this,e,r,o)}),!this.readBases&&e.start<=this.alignmentStart&&e.end>=this.alignmentStart+(this.lengthOnRef||this.readLength)-1&&(this._refRegion=e)}toJSON(){const e={};return Object.keys(this).forEach(r=>{r.startsWith("_")||(e[r]=this[r])}),e.readBases=this.getReadBases(),e}}var ur={exports:{}};/**
 * @license
 * web-streams-polyfill v4.2.0
 * Copyright 2025 Mattias Buelens, Diwank Singh Tomer and other contributors.
 * This code is released under the MIT license.
 * SPDX-License-Identifier: MIT
 */function rt(){}function x(t){return typeof t=="object"&&t!==null||typeof t=="function"}const Vo=rt;function N(t,e){try{Object.defineProperty(t,"name",{value:e,configurable:!0})}catch{}}const Rr=Promise,Wi=Promise.resolve.bind(Rr),Ki=Promise.prototype.then,$i=Promise.reject.bind(Rr),Vi=Wi;function U(t){return new Rr(t)}function F(t){return U(e=>e(t))}function w(t){return $i(t)}function Z(t,e,r){return Ki.call(t,e,r)}function J(t,e,r){Z(Z(t,e,r),void 0,Vo)}function Zt(t,e){J(t,e)}function dr(t,e){J(t,void 0,e)}function se(t,e,r){return Z(t,e,r)}function Ge(t){Z(t,void 0,Vo)}let Re=t=>{if(typeof queueMicrotask=="function")Re=queueMicrotask;else{const e=F(void 0);Re=r=>Z(e,r)}return Re(t)};function ke(t,e,r){if(typeof t!="function")throw new TypeError("Argument is not a function");return Function.prototype.apply.call(t,e,r)}function Ae(t,e,r){try{return F(ke(t,e,r))}catch(o){return w(o)}}class W{constructor(){this._cursor=0,this._size=0,this._front={_elements:[],_next:void 0},this._back=this._front,this._cursor=0,this._size=0}get length(){return this._size}push(e){const r=this._back;let o=r;r._elements.length===16383&&(o={_elements:[],_next:void 0}),r._elements.push(e),o!==r&&(this._back=o,r._next=o),++this._size}shift(){const e=this._front;let r=e;const o=this._cursor;let n=o+1;const i=e._elements,a=i[o];return n===16384&&(r=e._next,n=0),--this._size,this._cursor=n,e!==r&&(this._front=r),i[o]=void 0,a}forEach(e){let r=this._cursor,o=this._front,n=o._elements;for(;!(r===n.length&&o._next===void 0||r===n.length&&(o=o._next,n=o._elements,r=0,n.length===0));)e(n[r]),++r}peek(){const e=this._front,r=this._cursor;return e._elements[r]}}const Xo=Symbol("[[AbortSteps]]"),Zo=Symbol("[[ErrorSteps]]"),vr=Symbol("[[CancelSteps]]"),Dr=Symbol("[[PullSteps]]"),kr=Symbol("[[ReleaseSteps]]");function en(t,e){t._ownerReadableStream=e,e._reader=t,e._state==="readable"?gr(t):e._state==="closed"?(function(r){gr(r),rn(r)})(t):tn(t,e._storedError)}function qr(t,e){return $(t._ownerReadableStream,e)}function ie(t){const e=t._ownerReadableStream;e._state==="readable"?Nr(t,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")):(function(r,o){tn(r,o)})(t,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")),e._readableStreamController[kr](),e._reader=void 0,t._ownerReadableStream=void 0}function Dt(t){return new TypeError("Cannot "+t+" a stream using a released reader")}function gr(t){t._closedPromise=U((e,r)=>{t._closedPromise_resolve=e,t._closedPromise_reject=r})}function tn(t,e){gr(t),Nr(t,e)}function Nr(t,e){t._closedPromise_reject!==void 0&&(Ge(t._closedPromise),t._closedPromise_reject(e),t._closedPromise_resolve=void 0,t._closedPromise_reject=void 0)}function rn(t){t._closedPromise_resolve!==void 0&&(t._closedPromise_resolve(void 0),t._closedPromise_resolve=void 0,t._closedPromise_reject=void 0)}const eo=Number.isFinite||function(t){return typeof t=="number"&&isFinite(t)},Xi=Math.trunc||function(t){return t<0?Math.ceil(t):Math.floor(t)};function ee(t,e){if(t!==void 0&&typeof(r=t)!="object"&&typeof r!="function")throw new TypeError(`${e} is not an object.`);var r}function K(t,e){if(typeof t!="function")throw new TypeError(`${e} is not a function.`)}function on(t,e){if(!(function(r){return typeof r=="object"&&r!==null||typeof r=="function"})(t))throw new TypeError(`${e} is not an object.`)}function ae(t,e,r){if(t===void 0)throw new TypeError(`Parameter ${e} is required in '${r}'.`)}function fr(t,e,r){if(t===void 0)throw new TypeError(`${e} is required in '${r}'.`)}function Fr(t){return Number(t)}function to(t){return t===0?0:t}function Tr(t,e){const r=Number.MAX_SAFE_INTEGER;let o=Number(t);if(o=to(o),!eo(o))throw new TypeError(`${e} is not a finite number`);if(o=(function(n){return to(Xi(n))})(o),o<0||o>r)throw new TypeError(`${e} is outside the accepted range of 0 to ${r}, inclusive`);return eo(o)&&o!==0?o:0}function Pr(t,e){if(!le(t))throw new TypeError(`${e} is not a ReadableStream.`)}function xe(t){return new ce(t)}function nn(t,e){t._reader._readRequests.push(e)}function Mr(t,e,r){const o=t._reader._readRequests.shift();r?o._closeSteps():o._chunkSteps(e)}function Jt(t){return t._reader._readRequests.length}function sn(t){const e=t._reader;return e!==void 0&&!!fe(e)}class ce{constructor(e){if(ae(e,1,"ReadableStreamDefaultReader"),Pr(e,"First parameter"),he(e))throw new TypeError("This stream has already been locked for exclusive reading by another reader");en(this,e),this._readRequests=new W}get closed(){return fe(this)?this._closedPromise:w(dt("closed"))}cancel(e=void 0){return fe(this)?this._ownerReadableStream===void 0?w(Dt("cancel")):qr(this,e):w(dt("cancel"))}read(){if(!fe(this))return w(dt("read"));if(this._ownerReadableStream===void 0)return w(Dt("read from"));let e,r;const o=U((n,i)=>{e=n,r=i});return ot(this,{_chunkSteps:n=>e({value:n,done:!1}),_closeSteps:()=>e({value:void 0,done:!0}),_errorSteps:n=>r(n)}),o}releaseLock(){if(!fe(this))throw dt("releaseLock");this._ownerReadableStream!==void 0&&(function(e){ie(e);const r=new TypeError("Reader was released");an(e,r)})(this)}}function fe(t){return!!x(t)&&!!Object.prototype.hasOwnProperty.call(t,"_readRequests")&&t instanceof ce}function ot(t,e){const r=t._ownerReadableStream;r._disturbed=!0,r._state==="closed"?e._closeSteps():r._state==="errored"?e._errorSteps(r._storedError):r._readableStreamController[Dr](e)}function an(t,e){const r=t._readRequests;t._readRequests=new W,r.forEach(o=>{o._errorSteps(e)})}function dt(t){return new TypeError(`ReadableStreamDefaultReader.prototype.${t} can only be used on a ReadableStreamDefaultReader`)}var er,tr,rr;function Ke(t){return t.slice()}function An(t,e,r,o,n){new Uint8Array(t).set(new Uint8Array(r,o,n),e)}Object.defineProperties(ce.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),N(ce.prototype.cancel,"cancel"),N(ce.prototype.read,"read"),N(ce.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(ce.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultReader",configurable:!0});let qe=t=>(qe=typeof t.transfer=="function"?e=>e.transfer():typeof structuredClone=="function"?e=>structuredClone(e,{transfer:[e]}):e=>e,qe(t)),Ne=t=>(Ne=typeof t.detached=="boolean"?e=>e.detached:e=>e.byteLength===0,Ne(t));function ln(t,e,r){if(t.slice)return t.slice(e,r);const o=r-e,n=new ArrayBuffer(o);return An(n,0,t,e,o),n}function $e(t,e){const r=t[e];if(r!=null){if(typeof r!="function")throw new TypeError(`${String(e)} is not a function`);return r}}function ro(t){try{const e=t.done,r=t.value;return Z(Vi(r),o=>({done:e,value:o}))}catch(e){return w(e)}}const lt=(rr=(er=Symbol.asyncIterator)!==null&&er!==void 0?er:(tr=Symbol.for)===null||tr===void 0?void 0:tr.call(Symbol,"Symbol.asyncIterator"))!==null&&rr!==void 0?rr:"@@asyncIterator";function cn(t,e="sync",r){if(r===void 0)if(e==="async"){if((r=$e(t,lt))===void 0)return(function(n){const i={next(){let a;try{a=un(n)}catch(s){return w(s)}return ro(a)},return(a){let s;try{const c=$e(n.iterator,"return");if(c===void 0)return F({done:!0,value:a});s=ke(c,n.iterator,[a])}catch(c){return w(c)}return x(s)?ro(s):w(new TypeError("The iterator.return() method must return an object"))}};return{iterator:i,nextMethod:i.next,done:!1}})(cn(t,"sync",$e(t,Symbol.iterator)))}else r=$e(t,Symbol.iterator);if(r===void 0)throw new TypeError("The object is not iterable");const o=ke(r,t,[]);if(!x(o))throw new TypeError("The iterator method must return an object");return{iterator:o,nextMethod:o.next,done:!1}}function un(t){const e=ke(t.nextMethod,t.iterator,[]);if(!x(e))throw new TypeError("The iterator.next() method must return an object");return e}class dn{constructor(e,r){this._ongoingPromise=void 0,this._isFinished=!1,this._reader=e,this._preventCancel=r}next(){const e=()=>this._nextSteps();return this._ongoingPromise=this._ongoingPromise?se(this._ongoingPromise,e,e):e(),this._ongoingPromise}return(e){const r=()=>this._returnSteps(e);return this._ongoingPromise=this._ongoingPromise?se(this._ongoingPromise,r,r):r(),this._ongoingPromise}_nextSteps(){if(this._isFinished)return Promise.resolve({value:void 0,done:!0});const e=this._reader;let r,o;const n=U((i,a)=>{r=i,o=a});return ot(e,{_chunkSteps:i=>{this._ongoingPromise=void 0,Re(()=>r({value:i,done:!1}))},_closeSteps:()=>{this._ongoingPromise=void 0,this._isFinished=!0,ie(e),r({value:void 0,done:!0})},_errorSteps:i=>{this._ongoingPromise=void 0,this._isFinished=!0,ie(e),o(i)}}),n}_returnSteps(e){if(this._isFinished)return Promise.resolve({value:e,done:!0});this._isFinished=!0;const r=this._reader;if(!this._preventCancel){const o=qr(r,e);return ie(r),se(o,()=>({value:e,done:!0}))}return ie(r),F({value:e,done:!0})}}const gn={next(){return oo(this)?this._asyncIteratorImpl.next():w(no("next"))},return(t){return oo(this)?this._asyncIteratorImpl.return(t):w(no("return"))},[lt](){return this}};function oo(t){if(!x(t)||!Object.prototype.hasOwnProperty.call(t,"_asyncIteratorImpl"))return!1;try{return t._asyncIteratorImpl instanceof dn}catch{return!1}}function no(t){return new TypeError(`ReadableStreamAsyncIterator.${t} can only be used on a ReadableSteamAsyncIterator`)}Object.defineProperty(gn,lt,{enumerable:!1});const fn=Number.isNaN||function(t){return t!=t};function io(t){const e=ln(t.buffer,t.byteOffset,t.byteOffset+t.byteLength);return new Uint8Array(e)}function hr(t){const e=t._queue.shift();return t._queueTotalSize-=e.size,t._queueTotalSize<0&&(t._queueTotalSize=0),e.value}function Lr(t,e,r){if(typeof(o=r)!="number"||fn(o)||o<0||r===1/0)throw new RangeError("Size must be a finite, non-NaN, non-negative number.");var o;t._queue.push({value:e,size:r}),t._queueTotalSize+=r}function Ie(t){t._queue=new W,t._queueTotalSize=0}function hn(t){return t===DataView}class _e{constructor(){throw new TypeError("Illegal constructor")}get view(){if(!or(this))throw nr("view");return this._view}respond(e){if(!or(this))throw nr("respond");if(ae(e,1,"respond"),e=Tr(e,"First parameter"),this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(Ne(this._view.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be used as a response");_t(this._associatedReadableByteStreamController,e)}respondWithNewView(e){if(!or(this))throw nr("respondWithNewView");if(ae(e,1,"respondWithNewView"),!ArrayBuffer.isView(e))throw new TypeError("You can only respond with array buffer views");if(this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(Ne(e.buffer))throw new TypeError("The given view's buffer has been detached and so cannot be used as a response");Qt(this._associatedReadableByteStreamController,e)}}Object.defineProperties(_e.prototype,{respond:{enumerable:!0},respondWithNewView:{enumerable:!0},view:{enumerable:!0}}),N(_e.prototype.respond,"respond"),N(_e.prototype.respondWithNewView,"respondWithNewView"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(_e.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBRequest",configurable:!0});class oe{constructor(){throw new TypeError("Illegal constructor")}get byobRequest(){if(!Ee(this))throw We("byobRequest");return Ir(this)}get desiredSize(){if(!Ee(this))throw We("desiredSize");return Qn(this)}close(){if(!Ee(this))throw We("close");if(this._closeRequested)throw new TypeError("The stream has already been closed; do not close it again!");const e=this._controlledReadableByteStream._state;if(e!=="readable")throw new TypeError(`The stream (in ${e} state) is not in the readable state and cannot be closed`);Ve(this)}enqueue(e){if(!Ee(this))throw We("enqueue");if(ae(e,1,"enqueue"),!ArrayBuffer.isView(e))throw new TypeError("chunk must be an array buffer view");if(e.byteLength===0)throw new TypeError("chunk must have non-zero byteLength");if(e.buffer.byteLength===0)throw new TypeError("chunk's buffer must have non-zero byteLength");if(this._closeRequested)throw new TypeError("stream is closed or draining");const r=this._controlledReadableByteStream._state;if(r!=="readable")throw new TypeError(`The stream (in ${r} state) is not in the readable state and cannot be enqueued to`);Et(this,e)}error(e=void 0){if(!Ee(this))throw We("error");j(this,e)}[vr](e){Cn(this),Ie(this);const r=this._cancelAlgorithm(e);return zt(this),r}[Dr](e){const r=this._controlledReadableByteStream;if(this._queueTotalSize>0)return void _n(this,e);const o=this._autoAllocateChunkSize;if(o!==void 0){let n;try{n=new ArrayBuffer(o)}catch(a){return void e._errorSteps(a)}const i={buffer:n,bufferByteLength:o,byteOffset:0,byteLength:o,bytesFilled:0,minimumFill:1,elementSize:1,viewConstructor:Uint8Array,readerType:"default"};this._pendingPullIntos.push(i)}nn(r,e),Te(this)}[kr](){if(this._pendingPullIntos.length>0){const e=this._pendingPullIntos.peek();e.readerType="none",this._pendingPullIntos=new W,this._pendingPullIntos.push(e)}}}function Ee(t){return!!x(t)&&!!Object.prototype.hasOwnProperty.call(t,"_controlledReadableByteStream")&&t instanceof oe}function or(t){return!!x(t)&&!!Object.prototype.hasOwnProperty.call(t,"_associatedReadableByteStreamController")&&t instanceof _e}function Te(t){if((function(e){const r=e._controlledReadableByteStream;return r._state!=="readable"||e._closeRequested||!e._started?!1:!!(sn(r)&&Jt(r)>0||xr(r)&&vn(r)>0||Qn(e)>0)})(t)){if(t._pulling)return void(t._pullAgain=!0);t._pulling=!0,J(t._pullAlgorithm(),()=>(t._pulling=!1,t._pullAgain&&(t._pullAgain=!1,Te(t)),null),e=>(j(t,e),null))}}function Cn(t){Or(t),t._pendingPullIntos=new W}function In(t,e){let r=!1;t._state==="closed"&&(r=!0);const o=mn(e);e.readerType==="default"?Mr(t,o,r):(function(n,i,a){const s=n._reader,c=s._readIntoRequests.shift();a?c._closeSteps(i):c._chunkSteps(i)})(t,o,r)}function wt(t,e){for(let r=0;r<e.length;++r)In(t,e[r])}function mn(t){const e=t.bytesFilled,r=t.elementSize;return new t.viewConstructor(t.buffer,t.byteOffset,e/r)}function Bt(t,e,r,o){t._queue.push({buffer:e,byteOffset:r,byteLength:o}),t._queueTotalSize+=o}function pn(t,e,r,o){let n;try{n=ln(e,r,r+o)}catch(i){throw j(t,i),i}Bt(t,n,0,o)}function yn(t,e){e.bytesFilled>0&&pn(t,e.buffer,e.byteOffset,e.bytesFilled),Ue(t)}function bn(t,e){const r=Math.min(t._queueTotalSize,e.byteLength-e.bytesFilled),o=e.bytesFilled+r;let n=r,i=!1;const a=o-o%e.elementSize;a>=e.minimumFill&&(n=a-e.bytesFilled,i=!0);const s=t._queue;for(;n>0;){const c=s.peek(),l=Math.min(n,c.byteLength),A=e.byteOffset+e.bytesFilled;An(e.buffer,A,c.buffer,c.byteOffset,l),c.byteLength===l?s.shift():(c.byteOffset+=l,c.byteLength-=l),t._queueTotalSize-=l,wn(t,l,e),n-=l}return i}function wn(t,e,r){r.bytesFilled+=e}function Bn(t){t._queueTotalSize===0&&t._closeRequested?(zt(t),ct(t._controlledReadableByteStream)):Te(t)}function Or(t){t._byobRequest!==null&&(t._byobRequest._associatedReadableByteStreamController=void 0,t._byobRequest._view=null,t._byobRequest=null)}function Cr(t){const e=[];for(;t._pendingPullIntos.length>0&&t._queueTotalSize!==0;){const r=t._pendingPullIntos.peek();bn(t,r)&&(Ue(t),e.push(r))}return e}function Zi(t,e,r,o){const n=t._controlledReadableByteStream,i=e.constructor,a=(function(u){return hn(u)?1:u.BYTES_PER_ELEMENT})(i),{byteOffset:s,byteLength:c}=e,l=r*a;let A;try{A=qe(e.buffer)}catch(u){return void o._errorSteps(u)}const d={buffer:A,bufferByteLength:A.byteLength,byteOffset:s,byteLength:c,bytesFilled:0,minimumFill:l,elementSize:a,viewConstructor:i,readerType:"byob"};if(t._pendingPullIntos.length>0)return t._pendingPullIntos.push(d),void so(n,o);if(n._state==="closed"){const u=new i(d.buffer,d.byteOffset,0);return void o._closeSteps(u)}if(t._queueTotalSize>0){if(bn(t,d)){const u=mn(d);return Bn(t),void o._chunkSteps(u)}if(t._closeRequested){const u=new TypeError("Insufficient bytes to fill elements in the given buffer");return j(t,u),void o._errorSteps(u)}}t._pendingPullIntos.push(d),so(n,o),Te(t)}function En(t,e){const r=t._pendingPullIntos.peek();Or(t),t._controlledReadableByteStream._state==="closed"?(function(o,n){n.readerType==="none"&&Ue(o);const i=o._controlledReadableByteStream;if(xr(i)){const a=[];for(;a.length<vn(i);)a.push(Ue(o));wt(i,a)}})(t,r):(function(o,n,i){if(wn(0,n,i),i.readerType==="none"){yn(o,i);const c=Cr(o);return void wt(o._controlledReadableByteStream,c)}if(i.bytesFilled<i.minimumFill)return;Ue(o);const a=i.bytesFilled%i.elementSize;if(a>0){const c=i.byteOffset+i.bytesFilled;pn(o,i.buffer,c-a,a)}i.bytesFilled-=a;const s=Cr(o);In(o._controlledReadableByteStream,i),wt(o._controlledReadableByteStream,s)})(t,e,r),Te(t)}function Ue(t){return t._pendingPullIntos.shift()}function zt(t){t._pullAlgorithm=void 0,t._cancelAlgorithm=void 0}function Ve(t){const e=t._controlledReadableByteStream;if(!t._closeRequested&&e._state==="readable")if(t._queueTotalSize>0)t._closeRequested=!0;else{if(t._pendingPullIntos.length>0){const r=t._pendingPullIntos.peek();if(r.bytesFilled%r.elementSize!==0){const o=new TypeError("Insufficient bytes to fill elements in the given buffer");throw j(t,o),o}}zt(t),ct(e)}}function Et(t,e){const r=t._controlledReadableByteStream;if(t._closeRequested||r._state!=="readable")return;const{buffer:o,byteOffset:n,byteLength:i}=e;if(Ne(o))throw new TypeError("chunk's buffer is detached and so cannot be enqueued");const a=qe(o);if(t._pendingPullIntos.length>0){const s=t._pendingPullIntos.peek();if(Ne(s.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be filled with an enqueued chunk");Or(t),s.buffer=qe(s.buffer),s.readerType==="none"&&yn(t,s)}sn(r)?((function(s){const c=s._controlledReadableByteStream._reader;for(;c._readRequests.length>0;){if(s._queueTotalSize===0)return;_n(s,c._readRequests.shift())}})(t),Jt(r)===0?Bt(t,a,n,i):(t._pendingPullIntos.length>0&&Ue(t),Mr(r,new Uint8Array(a,n,i),!1))):xr(r)?(Bt(t,a,n,i),wt(r,Cr(t))):Bt(t,a,n,i),Te(t)}function j(t,e){const r=t._controlledReadableByteStream;r._state==="readable"&&(Cn(t),Ie(t),zt(t),Kn(r,e))}function _n(t,e){const r=t._queue.shift();t._queueTotalSize-=r.byteLength,Bn(t);const o=new Uint8Array(r.buffer,r.byteOffset,r.byteLength);e._chunkSteps(o)}function Ir(t){if(t._byobRequest===null&&t._pendingPullIntos.length>0){const e=t._pendingPullIntos.peek(),r=new Uint8Array(e.buffer,e.byteOffset+e.bytesFilled,e.byteLength-e.bytesFilled),o=Object.create(_e.prototype);(function(n,i,a){n._associatedReadableByteStreamController=i,n._view=a})(o,t,r),t._byobRequest=o}return t._byobRequest}function Qn(t){const e=t._controlledReadableByteStream._state;return e==="errored"?null:e==="closed"?0:t._strategyHWM-t._queueTotalSize}function _t(t,e){const r=t._pendingPullIntos.peek();if(t._controlledReadableByteStream._state==="closed"){if(e!==0)throw new TypeError("bytesWritten must be 0 when calling respond() on a closed stream")}else{if(e===0)throw new TypeError("bytesWritten must be greater than 0 when calling respond() on a readable stream");if(r.bytesFilled+e>r.byteLength)throw new RangeError("bytesWritten out of range")}r.buffer=qe(r.buffer),En(t,e)}function Qt(t,e){const r=t._pendingPullIntos.peek();if(t._controlledReadableByteStream._state==="closed"){if(e.byteLength!==0)throw new TypeError("The view's length must be 0 when calling respondWithNewView() on a closed stream")}else if(e.byteLength===0)throw new TypeError("The view's length must be greater than 0 when calling respondWithNewView() on a readable stream");if(r.byteOffset+r.bytesFilled!==e.byteOffset)throw new RangeError("The region specified by view does not match byobRequest");if(r.bufferByteLength!==e.buffer.byteLength)throw new RangeError("The buffer of view has different capacity than byobRequest");if(r.bytesFilled+e.byteLength>r.byteLength)throw new RangeError("The region specified by view is larger than byobRequest");const o=e.byteLength;r.buffer=qe(e.buffer),En(t,o)}function Sn(t,e,r,o,n,i,a){e._controlledReadableByteStream=t,e._pullAgain=!1,e._pulling=!1,e._byobRequest=null,e._queue=e._queueTotalSize=void 0,Ie(e),e._closeRequested=!1,e._started=!1,e._strategyHWM=i,e._pullAlgorithm=o,e._cancelAlgorithm=n,e._autoAllocateChunkSize=a,e._pendingPullIntos=new W,t._readableStreamController=e,J(F(r()),()=>(e._started=!0,Te(e),null),s=>(j(e,s),null))}function nr(t){return new TypeError(`ReadableStreamBYOBRequest.prototype.${t} can only be used on a ReadableStreamBYOBRequest`)}function We(t){return new TypeError(`ReadableByteStreamController.prototype.${t} can only be used on a ReadableByteStreamController`)}function es(t,e){if((t=`${t}`)!="byob")throw new TypeError(`${e} '${t}' is not a valid enumeration value for ReadableStreamReaderMode`);return t}function Rn(t){return new ue(t)}function so(t,e){t._reader._readIntoRequests.push(e)}function vn(t){return t._reader._readIntoRequests.length}function xr(t){const e=t._reader;return e!==void 0&&!!Qe(e)}Object.defineProperties(oe.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},byobRequest:{enumerable:!0},desiredSize:{enumerable:!0}}),N(oe.prototype.close,"close"),N(oe.prototype.enqueue,"enqueue"),N(oe.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(oe.prototype,Symbol.toStringTag,{value:"ReadableByteStreamController",configurable:!0});class ue{constructor(e){if(ae(e,1,"ReadableStreamBYOBReader"),Pr(e,"First parameter"),he(e))throw new TypeError("This stream has already been locked for exclusive reading by another reader");if(!Ee(e._readableStreamController))throw new TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");en(this,e),this._readIntoRequests=new W}get closed(){return Qe(this)?this._closedPromise:w(gt("closed"))}cancel(e=void 0){return Qe(this)?this._ownerReadableStream===void 0?w(Dt("cancel")):qr(this,e):w(gt("cancel"))}read(e,r={}){if(!Qe(this))return w(gt("read"));if(!ArrayBuffer.isView(e))return w(new TypeError("view must be an array buffer view"));if(e.byteLength===0)return w(new TypeError("view must have non-zero byteLength"));if(e.buffer.byteLength===0)return w(new TypeError("view's buffer must have non-zero byteLength"));if(Ne(e.buffer))return w(new TypeError("view's buffer has been detached"));let o;try{o=(function(c,l){var A;return ee(c,l),{min:Tr((A=c==null?void 0:c.min)!==null&&A!==void 0?A:1,`${l} has member 'min' that`)}})(r,"options")}catch(c){return w(c)}const n=o.min;if(n===0)return w(new TypeError("options.min must be greater than 0"));if((function(c){return hn(c.constructor)})(e)){if(n>e.byteLength)return w(new RangeError("options.min must be less than or equal to view's byteLength"))}else if(n>e.length)return w(new RangeError("options.min must be less than or equal to view's length"));if(this._ownerReadableStream===void 0)return w(Dt("read from"));let i,a;const s=U((c,l)=>{i=c,a=l});return Dn(this,e,n,{_chunkSteps:c=>i({value:c,done:!1}),_closeSteps:c=>i({value:c,done:!0}),_errorSteps:c=>a(c)}),s}releaseLock(){if(!Qe(this))throw gt("releaseLock");this._ownerReadableStream!==void 0&&(function(e){ie(e);const r=new TypeError("Reader was released");kn(e,r)})(this)}}function Qe(t){return!!x(t)&&!!Object.prototype.hasOwnProperty.call(t,"_readIntoRequests")&&t instanceof ue}function Dn(t,e,r,o){const n=t._ownerReadableStream;n._disturbed=!0,n._state==="errored"?o._errorSteps(n._storedError):Zi(n._readableStreamController,e,r,o)}function kn(t,e){const r=t._readIntoRequests;t._readIntoRequests=new W,r.forEach(o=>{o._errorSteps(e)})}function gt(t){return new TypeError(`ReadableStreamBYOBReader.prototype.${t} can only be used on a ReadableStreamBYOBReader`)}function nt(t,e){const{highWaterMark:r}=t;if(r===void 0)return e;if(fn(r)||r<0)throw new RangeError("Invalid highWaterMark");return r}function kt(t){const{size:e}=t;return e||(()=>1)}function qt(t,e){ee(t,e);const r=t==null?void 0:t.highWaterMark,o=t==null?void 0:t.size;return{highWaterMark:r===void 0?void 0:Fr(r),size:o===void 0?void 0:ts(o,`${e} has member 'size' that`)}}function ts(t,e){return K(t,e),r=>Fr(t(r))}function rs(t,e,r){return K(t,r),o=>Ae(t,e,[o])}function os(t,e,r){return K(t,r),()=>Ae(t,e,[])}function ns(t,e,r){return K(t,r),o=>ke(t,e,[o])}function is(t,e,r){return K(t,r),(o,n)=>Ae(t,e,[o,n])}function qn(t,e){if(!Oe(t))throw new TypeError(`${e} is not a WritableStream.`)}Object.defineProperties(ue.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),N(ue.prototype.cancel,"cancel"),N(ue.prototype.read,"read"),N(ue.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(ue.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBReader",configurable:!0});class de{constructor(e={},r={}){e===void 0?e=null:on(e,"First parameter");const o=qt(r,"Second parameter"),n=(function(a,s){ee(a,s);const c=a==null?void 0:a.abort,l=a==null?void 0:a.close,A=a==null?void 0:a.start,d=a==null?void 0:a.type,u=a==null?void 0:a.write;return{abort:c===void 0?void 0:rs(c,a,`${s} has member 'abort' that`),close:l===void 0?void 0:os(l,a,`${s} has member 'close' that`),start:A===void 0?void 0:ns(A,a,`${s} has member 'start' that`),write:u===void 0?void 0:is(u,a,`${s} has member 'write' that`),type:d}})(e,"First parameter");if(Fn(this),n.type!==void 0)throw new RangeError("Invalid type is specified");const i=kt(o);(function(a,s,c,l){const A=Object.create(Ye.prototype);let d,u,g,I;d=s.start!==void 0?()=>s.start(A):()=>{},u=s.write!==void 0?m=>s.write(m,A):()=>F(void 0),g=s.close!==void 0?()=>s.close():()=>F(void 0),I=s.abort!==void 0?m=>s.abort(m):()=>F(void 0),Un(a,A,d,u,g,I,c,l)})(this,n,nt(o,1),i)}get locked(){if(!Oe(this))throw ht("locked");return He(this)}abort(e=void 0){return Oe(this)?He(this)?w(new TypeError("Cannot abort a stream that already has a writer")):Nt(this,e):w(ht("abort"))}close(){return Oe(this)?He(this)?w(new TypeError("Cannot close a stream that already has a writer")):te(this)?w(new TypeError("Cannot close an already-closing stream")):Tn(this):w(ht("close"))}getWriter(){if(!Oe(this))throw ht("getWriter");return Nn(this)}}function Nn(t){return new re(t)}function Fn(t){t._state="writable",t._storedError=void 0,t._writer=void 0,t._writableStreamController=void 0,t._writeRequests=new W,t._inFlightWriteRequest=void 0,t._closeRequest=void 0,t._inFlightCloseRequest=void 0,t._pendingAbortRequest=void 0,t._backpressure=!1}function Oe(t){return!!x(t)&&!!Object.prototype.hasOwnProperty.call(t,"_writableStreamController")&&t instanceof de}function He(t){return t._writer!==void 0}function Nt(t,e){var r;if(t._state==="closed"||t._state==="errored")return F(void 0);t._writableStreamController._abortReason=e,(r=t._writableStreamController._abortController)===null||r===void 0||r.abort(e);const o=t._state;if(o==="closed"||o==="errored")return F(void 0);if(t._pendingAbortRequest!==void 0)return t._pendingAbortRequest._promise;let n=!1;o==="erroring"&&(n=!0,e=void 0);const i=U((a,s)=>{t._pendingAbortRequest={_promise:void 0,_resolve:a,_reject:s,_reason:e,_wasAlreadyErroring:n}});return t._pendingAbortRequest._promise=i,n||Ur(t,e),i}function Tn(t){const e=t._state;if(e==="closed"||e==="errored")return w(new TypeError(`The stream (in ${e} state) is not in the writable state and cannot be closed`));const r=U((i,a)=>{const s={_resolve:i,_reject:a};t._closeRequest=s}),o=t._writer;var n;return o!==void 0&&t._backpressure&&e==="writable"&&Gr(o),Lr(n=t._writableStreamController,xn,0),Gt(n),r}function mr(t,e){t._state!=="writable"?Hr(t):Ur(t,e)}function Ur(t,e){const r=t._writableStreamController;t._state="erroring",t._storedError=e;const o=t._writer;o!==void 0&&Mn(o,e),!(function(n){return!(n._inFlightWriteRequest===void 0&&n._inFlightCloseRequest===void 0)})(t)&&r._started&&Hr(t)}function Hr(t){t._state="errored",t._writableStreamController[Zo]();const e=t._storedError;if(t._writeRequests.forEach(o=>{o._reject(e)}),t._writeRequests=new W,t._pendingAbortRequest===void 0)return void ft(t);const r=t._pendingAbortRequest;if(t._pendingAbortRequest=void 0,r._wasAlreadyErroring)return r._reject(e),void ft(t);J(t._writableStreamController[Xo](r._reason),()=>(r._resolve(),ft(t),null),o=>(r._reject(o),ft(t),null))}function te(t){return t._closeRequest!==void 0||t._inFlightCloseRequest!==void 0}function ft(t){t._closeRequest!==void 0&&(t._closeRequest._reject(t._storedError),t._closeRequest=void 0);const e=t._writer;e!==void 0&&zr(e,t._storedError)}function Yr(t,e){const r=t._writer;r!==void 0&&e!==t._backpressure&&(e?(function(o){jt(o)})(r):Gr(r)),t._backpressure=e}Object.defineProperties(de.prototype,{abort:{enumerable:!0},close:{enumerable:!0},getWriter:{enumerable:!0},locked:{enumerable:!0}}),N(de.prototype.abort,"abort"),N(de.prototype.close,"close"),N(de.prototype.getWriter,"getWriter"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(de.prototype,Symbol.toStringTag,{value:"WritableStream",configurable:!0});class re{constructor(e){if(ae(e,1,"WritableStreamDefaultWriter"),qn(e,"First parameter"),He(e))throw new TypeError("This stream has already been locked for exclusive writing by another writer");this._ownerWritableStream=e,e._writer=this;const r=e._state;if(r==="writable")!te(e)&&e._backpressure?jt(this):ao(this),St(this);else if(r==="erroring")pr(this,e._storedError),St(this);else if(r==="closed")ao(this),St(o=this),zn(o);else{const n=e._storedError;pr(this,n),Jn(this,n)}var o}get closed(){return be(this)?this._closedPromise:w(we("closed"))}get desiredSize(){if(!be(this))throw we("desiredSize");if(this._ownerWritableStream===void 0)throw Xe("desiredSize");return(function(e){const r=e._ownerWritableStream,o=r._state;return o==="errored"||o==="erroring"?null:o==="closed"?0:Hn(r._writableStreamController)})(this)}get ready(){return be(this)?this._readyPromise:w(we("ready"))}abort(e=void 0){return be(this)?this._ownerWritableStream===void 0?w(Xe("abort")):(function(r,o){return Nt(r._ownerWritableStream,o)})(this,e):w(we("abort"))}close(){if(!be(this))return w(we("close"));const e=this._ownerWritableStream;return e===void 0?w(Xe("close")):te(e)?w(new TypeError("Cannot close an already-closing stream")):Pn(this)}releaseLock(){if(!be(this))throw we("releaseLock");this._ownerWritableStream!==void 0&&Ln(this)}write(e=void 0){return be(this)?this._ownerWritableStream===void 0?w(Xe("write to")):On(this,e):w(we("write"))}}function be(t){return!!x(t)&&!!Object.prototype.hasOwnProperty.call(t,"_ownerWritableStream")&&t instanceof re}function Pn(t){return Tn(t._ownerWritableStream)}function ss(t,e){t._closedPromiseState==="pending"?zr(t,e):(function(r,o){Jn(r,o)})(t,e)}function Mn(t,e){t._readyPromiseState==="pending"?Gn(t,e):(function(r,o){pr(r,o)})(t,e)}function Ln(t){const e=t._ownerWritableStream,r=new TypeError("Writer was released and can no longer be used to monitor the stream's closedness");Mn(t,r),ss(t,r),e._writer=void 0,t._ownerWritableStream=void 0}function On(t,e){const r=t._ownerWritableStream,o=r._writableStreamController,n=(function(s,c){if(s._strategySizeAlgorithm===void 0)return 1;try{return s._strategySizeAlgorithm(c)}catch(l){return it(s,l),1}})(o,e);if(r!==t._ownerWritableStream)return w(Xe("write to"));const i=r._state;if(i==="errored")return w(r._storedError);if(te(r)||i==="closed")return w(new TypeError("The stream is closing or closed and cannot be written to"));if(i==="erroring")return w(r._storedError);const a=(function(s){return U((c,l)=>{const A={_resolve:c,_reject:l};s._writeRequests.push(A)})})(r);return(function(s,c,l){try{Lr(s,c,l)}catch(d){return void it(s,d)}const A=s._controlledWritableStream;!te(A)&&A._state==="writable"&&Yr(A,Jr(s)),Gt(s)})(o,e,n),a}Object.defineProperties(re.prototype,{abort:{enumerable:!0},close:{enumerable:!0},releaseLock:{enumerable:!0},write:{enumerable:!0},closed:{enumerable:!0},desiredSize:{enumerable:!0},ready:{enumerable:!0}}),N(re.prototype.abort,"abort"),N(re.prototype.close,"close"),N(re.prototype.releaseLock,"releaseLock"),N(re.prototype.write,"write"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(re.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultWriter",configurable:!0});const xn={};class Ye{constructor(){throw new TypeError("Illegal constructor")}get abortReason(){if(!ir(this))throw sr("abortReason");return this._abortReason}get signal(){if(!ir(this))throw sr("signal");if(this._abortController===void 0)throw new TypeError("WritableStreamDefaultController.prototype.signal is not supported");return this._abortController.signal}error(e=void 0){if(!ir(this))throw sr("error");this._controlledWritableStream._state==="writable"&&Yn(this,e)}[Xo](e){const r=this._abortAlgorithm(e);return Ft(this),r}[Zo](){Ie(this)}}function ir(t){return!!x(t)&&!!Object.prototype.hasOwnProperty.call(t,"_controlledWritableStream")&&t instanceof Ye}function Un(t,e,r,o,n,i,a,s){e._controlledWritableStream=t,t._writableStreamController=e,e._queue=void 0,e._queueTotalSize=void 0,Ie(e),e._abortReason=void 0,e._abortController=(function(){if(typeof AbortController=="function")return new AbortController})(),e._started=!1,e._strategySizeAlgorithm=s,e._strategyHWM=a,e._writeAlgorithm=o,e._closeAlgorithm=n,e._abortAlgorithm=i;const c=Jr(e);Yr(t,c),J(F(r()),()=>(e._started=!0,Gt(e),null),l=>(e._started=!0,mr(t,l),null))}function Ft(t){t._writeAlgorithm=void 0,t._closeAlgorithm=void 0,t._abortAlgorithm=void 0,t._strategySizeAlgorithm=void 0}function Hn(t){return t._strategyHWM-t._queueTotalSize}function Gt(t){const e=t._controlledWritableStream;if(!t._started||e._inFlightWriteRequest!==void 0)return;if(e._state==="erroring")return void Hr(e);if(t._queue.length===0)return;const r=t._queue.peek().value;r===xn?(function(o){const n=o._controlledWritableStream;(function(a){a._inFlightCloseRequest=a._closeRequest,a._closeRequest=void 0})(n),hr(o);const i=o._closeAlgorithm();Ft(o),J(i,()=>((function(a){a._inFlightCloseRequest._resolve(void 0),a._inFlightCloseRequest=void 0,a._state==="erroring"&&(a._storedError=void 0,a._pendingAbortRequest!==void 0&&(a._pendingAbortRequest._resolve(),a._pendingAbortRequest=void 0)),a._state="closed";const s=a._writer;s!==void 0&&zn(s)})(n),null),a=>((function(s,c){s._inFlightCloseRequest._reject(c),s._inFlightCloseRequest=void 0,s._pendingAbortRequest!==void 0&&(s._pendingAbortRequest._reject(c),s._pendingAbortRequest=void 0),mr(s,c)})(n,a),null))})(t):(function(o,n){const i=o._controlledWritableStream;(function(s){s._inFlightWriteRequest=s._writeRequests.shift()})(i);const a=o._writeAlgorithm(n);J(a,()=>{(function(c){c._inFlightWriteRequest._resolve(void 0),c._inFlightWriteRequest=void 0})(i);const s=i._state;if(hr(o),!te(i)&&s==="writable"){const c=Jr(o);Yr(i,c)}return Gt(o),null},s=>(i._state==="writable"&&Ft(o),(function(c,l){c._inFlightWriteRequest._reject(l),c._inFlightWriteRequest=void 0,mr(c,l)})(i,s),null))})(t,r)}function it(t,e){t._controlledWritableStream._state==="writable"&&Yn(t,e)}function Jr(t){return Hn(t)<=0}function Yn(t,e){const r=t._controlledWritableStream;Ft(t),Ur(r,e)}function ht(t){return new TypeError(`WritableStream.prototype.${t} can only be used on a WritableStream`)}function sr(t){return new TypeError(`WritableStreamDefaultController.prototype.${t} can only be used on a WritableStreamDefaultController`)}function we(t){return new TypeError(`WritableStreamDefaultWriter.prototype.${t} can only be used on a WritableStreamDefaultWriter`)}function Xe(t){return new TypeError("Cannot "+t+" a stream using a released writer")}function St(t){t._closedPromise=U((e,r)=>{t._closedPromise_resolve=e,t._closedPromise_reject=r,t._closedPromiseState="pending"})}function Jn(t,e){St(t),zr(t,e)}function zr(t,e){t._closedPromise_reject!==void 0&&(Ge(t._closedPromise),t._closedPromise_reject(e),t._closedPromise_resolve=void 0,t._closedPromise_reject=void 0,t._closedPromiseState="rejected")}function zn(t){t._closedPromise_resolve!==void 0&&(t._closedPromise_resolve(void 0),t._closedPromise_resolve=void 0,t._closedPromise_reject=void 0,t._closedPromiseState="resolved")}function jt(t){t._readyPromise=U((e,r)=>{t._readyPromise_resolve=e,t._readyPromise_reject=r}),t._readyPromiseState="pending"}function pr(t,e){jt(t),Gn(t,e)}function ao(t){jt(t),Gr(t)}function Gn(t,e){t._readyPromise_reject!==void 0&&(Ge(t._readyPromise),t._readyPromise_reject(e),t._readyPromise_resolve=void 0,t._readyPromise_reject=void 0,t._readyPromiseState="rejected")}function Gr(t){t._readyPromise_resolve!==void 0&&(t._readyPromise_resolve(void 0),t._readyPromise_resolve=void 0,t._readyPromise_reject=void 0,t._readyPromiseState="fulfilled")}Object.defineProperties(Ye.prototype,{abortReason:{enumerable:!0},signal:{enumerable:!0},error:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Ye.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultController",configurable:!0});const Ao=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof Vr<"u"?Vr:void 0,as=(function(){const t=Ao==null?void 0:Ao.DOMException;return(function(e){if(typeof e!="function"&&typeof e!="object"||e.name!=="DOMException")return!1;try{return new e,!0}catch{return!1}})(t)?t:void 0})()||(function(){const t=function(e,r){this.message=e||"",this.name=r||"Error",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)};return N(t,"DOMException"),t.prototype=Object.create(Error.prototype),Object.defineProperty(t.prototype,"constructor",{value:t,writable:!0,configurable:!0}),t})();function lo(t,e,r,o,n,i){const a=xe(t),s=Nn(e);t._disturbed=!0;let c=!1,l=F(void 0);return U((A,d)=>{let u;if(i!==void 0){if(u=()=>{const p=i.reason!==void 0?i.reason:new as("Aborted","AbortError"),v=[];o||v.push(()=>e._state==="writable"?Nt(e,p):F(void 0)),n||v.push(()=>t._state==="readable"?$(t,p):F(void 0)),C(()=>Promise.all(v.map(E=>E())),!0,p)},i.aborted)return void u();i.addEventListener("abort",u)}var g,I,m;if(h(t,a._closedPromise,p=>(o?y(!0,p):C(()=>Nt(e,p),!0,p),null)),h(e,s._closedPromise,p=>(n?y(!0,p):C(()=>$(t,p),!0,p),null)),g=t,I=a._closedPromise,m=()=>(r?y():C(()=>(function(p){const v=p._ownerWritableStream,E=v._state;return te(v)||E==="closed"?F(void 0):E==="errored"?w(v._storedError):Pn(p)})(s)),null),g._state==="closed"?m():Zt(I,m),te(e)||e._state==="closed"){const p=new TypeError("the destination writable stream closed before all data could be piped to it");n?y(!0,p):C(()=>$(t,p),!0,p)}function f(){const p=l;return Z(l,()=>p!==l?f():void 0)}function h(p,v,E){p._state==="errored"?E(p._storedError):dr(v,E)}function C(p,v,E){function _(){return J(p(),()=>B(v,E),Q=>B(!0,Q)),null}c||(c=!0,e._state!=="writable"||te(e)?_():Zt(f(),_))}function y(p,v){c||(c=!0,e._state!=="writable"||te(e)?B(p,v):Zt(f(),()=>B(p,v)))}function B(p,v){return Ln(s),ie(a),i!==void 0&&i.removeEventListener("abort",u),p?d(v):A(void 0),null}Ge(U((p,v)=>{(function E(_){_?p():Z(c?F(!0):Z(s._readyPromise,()=>U((Q,q)=>{ot(a,{_chunkSteps:D=>{l=Z(On(s,D),void 0,rt),Q(!1)},_closeSteps:()=>Q(!0),_errorSteps:q})})),E,v)})(!1)}))})}class ne{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!Ct(this))throw It("desiredSize");return jr(this)}close(){if(!Ct(this))throw It("close");if(!ze(this))throw new TypeError("The stream is not in a state that permits close");Fe(this)}enqueue(e=void 0){if(!Ct(this))throw It("enqueue");if(!ze(this))throw new TypeError("The stream is not in a state that permits enqueue");return Je(this,e)}error(e=void 0){if(!Ct(this))throw It("error");X(this,e)}[vr](e){Ie(this);const r=this._cancelAlgorithm(e);return Tt(this),r}[Dr](e){const r=this._controlledReadableStream;if(this._queue.length>0){const o=hr(this);this._closeRequested&&this._queue.length===0?(Tt(this),ct(r)):st(this),e._chunkSteps(o)}else nn(r,e),st(this)}[kr](){}}function Ct(t){return!!x(t)&&!!Object.prototype.hasOwnProperty.call(t,"_controlledReadableStream")&&t instanceof ne}function st(t){if(jn(t)){if(t._pulling)return void(t._pullAgain=!0);t._pulling=!0,J(t._pullAlgorithm(),()=>(t._pulling=!1,t._pullAgain&&(t._pullAgain=!1,st(t)),null),e=>(X(t,e),null))}}function jn(t){const e=t._controlledReadableStream;return!ze(t)||!t._started?!1:he(e)&&Jt(e)>0?!0:jr(t)>0}function Tt(t){t._pullAlgorithm=void 0,t._cancelAlgorithm=void 0,t._strategySizeAlgorithm=void 0}function Fe(t){if(!ze(t))return;const e=t._controlledReadableStream;t._closeRequested=!0,t._queue.length===0&&(Tt(t),ct(e))}function Je(t,e){if(!ze(t))return;const r=t._controlledReadableStream;if(he(r)&&Jt(r)>0)Mr(r,e,!1);else{let o;try{o=t._strategySizeAlgorithm(e)}catch(n){throw X(t,n),n}try{Lr(t,e,o)}catch(n){throw X(t,n),n}}st(t)}function X(t,e){const r=t._controlledReadableStream;r._state==="readable"&&(Ie(t),Tt(t),Kn(r,e))}function jr(t){const e=t._controlledReadableStream._state;return e==="errored"?null:e==="closed"?0:t._strategyHWM-t._queueTotalSize}function ze(t){const e=t._controlledReadableStream._state;return!t._closeRequested&&e==="readable"}function Wn(t,e,r,o,n,i,a){e._controlledReadableStream=t,e._queue=void 0,e._queueTotalSize=void 0,Ie(e),e._started=!1,e._closeRequested=!1,e._pullAgain=!1,e._pulling=!1,e._strategySizeAlgorithm=a,e._strategyHWM=i,e._pullAlgorithm=o,e._cancelAlgorithm=n,t._readableStreamController=e,J(F(r()),()=>(e._started=!0,st(e),null),s=>(X(e,s),null))}function It(t){return new TypeError(`ReadableStreamDefaultController.prototype.${t} can only be used on a ReadableStreamDefaultController`)}function As(t,e){return Ee(t._readableStreamController)?(function(r){let o,n,i,a,s,c=xe(r),l=!1,A=!1,d=!1,u=!1,g=!1;const I=U(E=>{s=E});function m(E){dr(E._closedPromise,_=>(E!==c||(j(i._readableStreamController,_),j(a._readableStreamController,_),u&&g||s(void 0)),null))}function f(){Qe(c)&&(ie(c),c=xe(r),m(c)),ot(c,{_chunkSteps:E=>{Re(()=>{A=!1,d=!1;const _=E;let Q=E;if(!u&&!g)try{Q=io(E)}catch(q){return j(i._readableStreamController,q),j(a._readableStreamController,q),void s($(r,q))}u||Et(i._readableStreamController,_),g||Et(a._readableStreamController,Q),l=!1,A?C():d&&y()})},_closeSteps:()=>{l=!1,u||Ve(i._readableStreamController),g||Ve(a._readableStreamController),i._readableStreamController._pendingPullIntos.length>0&&_t(i._readableStreamController,0),a._readableStreamController._pendingPullIntos.length>0&&_t(a._readableStreamController,0),u&&g||s(void 0)},_errorSteps:()=>{l=!1}})}function h(E,_){fe(c)&&(ie(c),c=Rn(r),m(c));const Q=_?a:i,q=_?i:a;Dn(c,E,1,{_chunkSteps:D=>{Re(()=>{A=!1,d=!1;const b=_?g:u;if(_?u:g)b||Qt(Q._readableStreamController,D);else{let k;try{k=io(D)}catch(T){return j(Q._readableStreamController,T),j(q._readableStreamController,T),void s($(r,T))}b||Qt(Q._readableStreamController,D),Et(q._readableStreamController,k)}l=!1,A?C():d&&y()})},_closeSteps:D=>{l=!1;const b=_?g:u,k=_?u:g;b||Ve(Q._readableStreamController),k||Ve(q._readableStreamController),D!==void 0&&(b||Qt(Q._readableStreamController,D),!k&&q._readableStreamController._pendingPullIntos.length>0&&_t(q._readableStreamController,0)),b&&k||s(void 0)},_errorSteps:()=>{l=!1}})}function C(){if(l)return A=!0,F(void 0);l=!0;const E=Ir(i._readableStreamController);return E===null?f():h(E._view,!1),F(void 0)}function y(){if(l)return d=!0,F(void 0);l=!0;const E=Ir(a._readableStreamController);return E===null?f():h(E._view,!0),F(void 0)}function B(E){if(u=!0,o=E,g){const _=Ke([o,n]),Q=$(r,_);s(Q)}return I}function p(E){if(g=!0,n=E,u){const _=Ke([o,n]),Q=$(r,_);s(Q)}return I}function v(){}return i=uo(v,C,B),a=uo(v,y,p),m(c),[i,a]})(t):(function(r){const o=xe(r);let n,i,a,s,c,l=!1,A=!1,d=!1,u=!1;const g=U(C=>{c=C});function I(){return l?(A=!0,F(void 0)):(l=!0,ot(o,{_chunkSteps:C=>{Re(()=>{A=!1;const y=C,B=C;d||Je(a._readableStreamController,y),u||Je(s._readableStreamController,B),l=!1,A&&I()})},_closeSteps:()=>{l=!1,d||Fe(a._readableStreamController),u||Fe(s._readableStreamController),d&&u||c(void 0)},_errorSteps:()=>{l=!1}}),F(void 0))}function m(C){if(d=!0,n=C,u){const y=Ke([n,i]),B=$(r,y);c(B)}return g}function f(C){if(u=!0,i=C,d){const y=Ke([n,i]),B=$(r,y);c(B)}return g}function h(){}return a=at(h,I,m),s=at(h,I,f),dr(o._closedPromise,C=>(X(a._readableStreamController,C),X(s._readableStreamController,C),d&&u||c(void 0),null)),[a,s]})(t)}function ls(t){return x(e=t)&&e.getReader!==void 0?(function(r){let o;function n(){let a;try{a=r.read()}catch(s){return w(s)}return se(a,s=>{if(!x(s))throw new TypeError("The promise returned by the reader.read() method must fulfill with an object");if(s.done)Fe(o._readableStreamController);else{const c=s.value;Je(o._readableStreamController,c)}})}function i(a){try{return F(r.cancel(a))}catch(s){return w(s)}}return o=at(rt,n,i,0),o})(t.getReader()):(function(r){let o;const n=cn(r,"async");function i(){let s;try{s=un(n)}catch(c){return w(c)}return se(F(s),c=>{if(!x(c))throw new TypeError("The promise returned by the iterator.next() method must fulfill with an object");if(c.done)Fe(o._readableStreamController);else{const l=c.value;Je(o._readableStreamController,l)}})}function a(s){const c=n.iterator;let l;try{l=$e(c,"return")}catch(A){return w(A)}return l===void 0?F(void 0):se(Ae(l,c,[s]),A=>{if(!x(A))throw new TypeError("The promise returned by the iterator.return() method must fulfill with an object")})}return o=at(rt,i,a,0),o})(t);var e}function cs(t,e,r){return K(t,r),o=>Ae(t,e,[o])}function us(t,e,r){return K(t,r),o=>Ae(t,e,[o])}function ds(t,e,r){return K(t,r),o=>ke(t,e,[o])}function gs(t,e){if((t=`${t}`)!="bytes")throw new TypeError(`${e} '${t}' is not a valid enumeration value for ReadableStreamType`);return t}function co(t,e){ee(t,e);const r=t==null?void 0:t.preventAbort,o=t==null?void 0:t.preventCancel,n=t==null?void 0:t.preventClose,i=t==null?void 0:t.signal;return i!==void 0&&(function(a,s){if(!(function(c){if(typeof c!="object"||c===null)return!1;try{return typeof c.aborted=="boolean"}catch{return!1}})(a))throw new TypeError(`${s} is not an AbortSignal.`)})(i,`${e} has member 'signal' that`),{preventAbort:!!r,preventCancel:!!o,preventClose:!!n,signal:i}}Object.defineProperties(ne.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},desiredSize:{enumerable:!0}}),N(ne.prototype.close,"close"),N(ne.prototype.enqueue,"enqueue"),N(ne.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(ne.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultController",configurable:!0});let Y=class{constructor(t={},e={}){t===void 0?t=null:on(t,"First parameter");const r=qt(e,"Second parameter"),o=(function(n,i){ee(n,i);const a=n,s=a==null?void 0:a.autoAllocateChunkSize,c=a==null?void 0:a.cancel,l=a==null?void 0:a.pull,A=a==null?void 0:a.start,d=a==null?void 0:a.type;return{autoAllocateChunkSize:s===void 0?void 0:Tr(s,`${i} has member 'autoAllocateChunkSize' that`),cancel:c===void 0?void 0:cs(c,a,`${i} has member 'cancel' that`),pull:l===void 0?void 0:us(l,a,`${i} has member 'pull' that`),start:A===void 0?void 0:ds(A,a,`${i} has member 'start' that`),type:d===void 0?void 0:gs(d,`${i} has member 'type' that`)}})(t,"First parameter");if(Wr(this),o.type==="bytes"){if(r.size!==void 0)throw new RangeError("The strategy for a byte stream cannot have a size function");(function(n,i,a){const s=Object.create(oe.prototype);let c,l,A;c=i.start!==void 0?()=>i.start(s):()=>{},l=i.pull!==void 0?()=>i.pull(s):()=>F(void 0),A=i.cancel!==void 0?u=>i.cancel(u):()=>F(void 0);const d=i.autoAllocateChunkSize;if(d===0)throw new TypeError("autoAllocateChunkSize must be greater than 0");Sn(n,s,c,l,A,a,d)})(this,o,nt(r,0))}else{const n=kt(r);(function(i,a,s,c){const l=Object.create(ne.prototype);let A,d,u;A=a.start!==void 0?()=>a.start(l):()=>{},d=a.pull!==void 0?()=>a.pull(l):()=>F(void 0),u=a.cancel!==void 0?g=>a.cancel(g):()=>F(void 0),Wn(i,l,A,d,u,s,c)})(this,o,nt(r,1),n)}}get locked(){if(!le(this))throw Be("locked");return he(this)}cancel(t=void 0){return le(this)?he(this)?w(new TypeError("Cannot cancel a stream that already has a reader")):$(this,t):w(Be("cancel"))}getReader(t=void 0){if(!le(this))throw Be("getReader");return(function(e,r){ee(e,r);const o=e==null?void 0:e.mode;return{mode:o===void 0?void 0:es(o,`${r} has member 'mode' that`)}})(t,"First parameter").mode===void 0?xe(this):Rn(this)}pipeThrough(t,e={}){if(!le(this))throw Be("pipeThrough");ae(t,1,"pipeThrough");const r=(function(n,i){ee(n,i);const a=n==null?void 0:n.readable;fr(a,"readable","ReadableWritablePair"),Pr(a,`${i} has member 'readable' that`);const s=n==null?void 0:n.writable;return fr(s,"writable","ReadableWritablePair"),qn(s,`${i} has member 'writable' that`),{readable:a,writable:s}})(t,"First parameter"),o=co(e,"Second parameter");if(he(this))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream");if(He(r.writable))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream");return Ge(lo(this,r.writable,o.preventClose,o.preventAbort,o.preventCancel,o.signal)),r.readable}pipeTo(t,e={}){if(!le(this))return w(Be("pipeTo"));if(t===void 0)return w("Parameter 1 is required in 'pipeTo'.");if(!Oe(t))return w(new TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream"));let r;try{r=co(e,"Second parameter")}catch(o){return w(o)}return he(this)?w(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream")):He(t)?w(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream")):lo(this,t,r.preventClose,r.preventAbort,r.preventCancel,r.signal)}tee(){if(!le(this))throw Be("tee");return Ke(As(this))}values(t=void 0){if(!le(this))throw Be("values");return(function(e,r){const o=xe(e),n=new dn(o,r),i=Object.create(gn);return i._asyncIteratorImpl=n,i})(this,(function(e,r){return ee(e,r),{preventCancel:!!(e!=null&&e.preventCancel)}})(t,"First parameter").preventCancel)}[lt](t){return this.values(t)}static from(t){return ls(t)}};function at(t,e,r,o=1,n=()=>1){const i=Object.create(Y.prototype);return Wr(i),Wn(i,Object.create(ne.prototype),t,e,r,o,n),i}function uo(t,e,r){const o=Object.create(Y.prototype);return Wr(o),Sn(o,Object.create(oe.prototype),t,e,r,0,void 0),o}function Wr(t){t._state="readable",t._reader=void 0,t._storedError=void 0,t._disturbed=!1}function le(t){return!!x(t)&&!!Object.prototype.hasOwnProperty.call(t,"_readableStreamController")&&t instanceof Y}function he(t){return t._reader!==void 0}function $(t,e){if(t._disturbed=!0,t._state==="closed")return F(void 0);if(t._state==="errored")return w(t._storedError);ct(t);const r=t._reader;if(r!==void 0&&Qe(r)){const o=r._readIntoRequests;r._readIntoRequests=new W,o.forEach(n=>{n._closeSteps(void 0)})}return se(t._readableStreamController[vr](e),rt)}function ct(t){t._state="closed";const e=t._reader;if(e!==void 0&&(rn(e),fe(e))){const r=e._readRequests;e._readRequests=new W,r.forEach(o=>{o._closeSteps()})}}function Kn(t,e){t._state="errored",t._storedError=e;const r=t._reader;r!==void 0&&(Nr(r,e),fe(r)?an(r,e):kn(r,e))}function Be(t){return new TypeError(`ReadableStream.prototype.${t} can only be used on a ReadableStream`)}function $n(t,e){ee(t,e);const r=t==null?void 0:t.highWaterMark;return fr(r,"highWaterMark","QueuingStrategyInit"),{highWaterMark:Fr(r)}}Object.defineProperties(Y,{from:{enumerable:!0}}),Object.defineProperties(Y.prototype,{cancel:{enumerable:!0},getReader:{enumerable:!0},pipeThrough:{enumerable:!0},pipeTo:{enumerable:!0},tee:{enumerable:!0},values:{enumerable:!0},locked:{enumerable:!0}}),N(Y.from,"from"),N(Y.prototype.cancel,"cancel"),N(Y.prototype.getReader,"getReader"),N(Y.prototype.pipeThrough,"pipeThrough"),N(Y.prototype.pipeTo,"pipeTo"),N(Y.prototype.tee,"tee"),N(Y.prototype.values,"values"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Y.prototype,Symbol.toStringTag,{value:"ReadableStream",configurable:!0}),Object.defineProperty(Y.prototype,lt,{value:Y.prototype.values,writable:!0,configurable:!0});const Vn=t=>t.byteLength;N(Vn,"size");class Pt{constructor(e){ae(e,1,"ByteLengthQueuingStrategy"),e=$n(e,"First parameter"),this._byteLengthQueuingStrategyHighWaterMark=e.highWaterMark}get highWaterMark(){if(!fo(this))throw go("highWaterMark");return this._byteLengthQueuingStrategyHighWaterMark}get size(){if(!fo(this))throw go("size");return Vn}}function go(t){return new TypeError(`ByteLengthQueuingStrategy.prototype.${t} can only be used on a ByteLengthQueuingStrategy`)}function fo(t){return!!x(t)&&!!Object.prototype.hasOwnProperty.call(t,"_byteLengthQueuingStrategyHighWaterMark")&&t instanceof Pt}Object.defineProperties(Pt.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Pt.prototype,Symbol.toStringTag,{value:"ByteLengthQueuingStrategy",configurable:!0});const Xn=()=>1;N(Xn,"size");class Mt{constructor(e){ae(e,1,"CountQueuingStrategy"),e=$n(e,"First parameter"),this._countQueuingStrategyHighWaterMark=e.highWaterMark}get highWaterMark(){if(!Co(this))throw ho("highWaterMark");return this._countQueuingStrategyHighWaterMark}get size(){if(!Co(this))throw ho("size");return Xn}}function ho(t){return new TypeError(`CountQueuingStrategy.prototype.${t} can only be used on a CountQueuingStrategy`)}function Co(t){return!!x(t)&&!!Object.prototype.hasOwnProperty.call(t,"_countQueuingStrategyHighWaterMark")&&t instanceof Mt}function fs(t,e,r){return K(t,r),o=>Ae(t,e,[o])}function hs(t,e,r){return K(t,r),o=>ke(t,e,[o])}function Cs(t,e,r){return K(t,r),(o,n)=>Ae(t,e,[o,n])}function Is(t,e,r){return K(t,r),o=>Ae(t,e,[o])}Object.defineProperties(Mt.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Mt.prototype,Symbol.toStringTag,{value:"CountQueuingStrategy",configurable:!0});class Lt{constructor(e={},r={},o={}){e===void 0&&(e=null);const n=qt(r,"Second parameter"),i=qt(o,"Third parameter"),a=(function(u,g){ee(u,g);const I=u==null?void 0:u.cancel,m=u==null?void 0:u.flush,f=u==null?void 0:u.readableType,h=u==null?void 0:u.start,C=u==null?void 0:u.transform,y=u==null?void 0:u.writableType;return{cancel:I===void 0?void 0:Is(I,u,`${g} has member 'cancel' that`),flush:m===void 0?void 0:fs(m,u,`${g} has member 'flush' that`),readableType:f,start:h===void 0?void 0:hs(h,u,`${g} has member 'start' that`),transform:C===void 0?void 0:Cs(C,u,`${g} has member 'transform' that`),writableType:y}})(e,"First parameter");if(a.readableType!==void 0)throw new RangeError("Invalid readableType specified");if(a.writableType!==void 0)throw new RangeError("Invalid writableType specified");const s=nt(i,0),c=kt(i),l=nt(n,1),A=kt(n);let d;(function(u,g,I,m,f,h){function C(){return g}function y(_){return(function(Q,q){const D=Q._transformStreamController;return Q._backpressure?se(Q._backpressureChangePromise,()=>{const b=Q._writable;if(b._state==="erroring")throw b._storedError;return mo(D,q)}):mo(D,q)})(u,_)}function B(_){return(function(Q,q){const D=Q._transformStreamController;if(D._finishPromise!==void 0)return D._finishPromise;const b=Q._readable;D._finishPromise=U((T,pe)=>{D._finishPromise_resolve=T,D._finishPromise_reject=pe});const k=D._cancelAlgorithm(q);return Rt(D),J(k,()=>(b._state==="errored"?Me(D,b._storedError):(X(b._readableStreamController,q),ar(D)),null),T=>(X(b._readableStreamController,T),Me(D,T),null)),D._finishPromise})(u,_)}function p(){return(function(_){const Q=_._transformStreamController;if(Q._finishPromise!==void 0)return Q._finishPromise;const q=_._readable;Q._finishPromise=U((b,k)=>{Q._finishPromise_resolve=b,Q._finishPromise_reject=k});const D=Q._flushAlgorithm();return Rt(Q),J(D,()=>(q._state==="errored"?Me(Q,q._storedError):(Fe(q._readableStreamController),ar(Q)),null),b=>(X(q._readableStreamController,b),Me(Q,b),null)),Q._finishPromise})(u)}function v(){return(function(_){return Ot(_,!1),_._backpressureChangePromise})(u)}function E(_){return(function(Q,q){const D=Q._transformStreamController;if(D._finishPromise!==void 0)return D._finishPromise;const b=Q._writable;D._finishPromise=U((T,pe)=>{D._finishPromise_resolve=T,D._finishPromise_reject=pe});const k=D._cancelAlgorithm(q);return Rt(D),J(k,()=>(b._state==="errored"?Me(D,b._storedError):(it(b._writableStreamController,q),yr(Q),ar(D)),null),T=>(it(b._writableStreamController,T),yr(Q),Me(D,T),null)),D._finishPromise})(u,_)}u._writable=(function(_,Q,q,D,b=1,k=()=>1){const T=Object.create(de.prototype);return Fn(T),Un(T,Object.create(Ye.prototype),_,Q,q,D,b,k),T})(C,y,p,B,I,m),u._readable=at(C,v,E,f,h),u._backpressure=void 0,u._backpressureChangePromise=void 0,u._backpressureChangePromise_resolve=void 0,Ot(u,!0),u._transformStreamController=void 0})(this,U(u=>{d=u}),l,A,s,c),(function(u,g){const I=Object.create(ge.prototype);let m,f,h;m=g.transform!==void 0?C=>g.transform(C,I):C=>{try{return ei(I,C),F(void 0)}catch(y){return w(y)}},f=g.flush!==void 0?()=>g.flush(I):()=>F(void 0),h=g.cancel!==void 0?C=>g.cancel(C):()=>F(void 0),(function(C,y,B,p,v){y._controlledTransformStream=C,C._transformStreamController=y,y._transformAlgorithm=B,y._flushAlgorithm=p,y._cancelAlgorithm=v,y._finishPromise=void 0,y._finishPromise_resolve=void 0,y._finishPromise_reject=void 0})(u,I,m,f,h)})(this,a),a.start!==void 0?d(a.start(this._transformStreamController)):d(void 0)}get readable(){if(!Io(this))throw po("readable");return this._readable}get writable(){if(!Io(this))throw po("writable");return this._writable}}function Io(t){return!!x(t)&&!!Object.prototype.hasOwnProperty.call(t,"_transformStreamController")&&t instanceof Lt}function Zn(t,e){X(t._readable._readableStreamController,e),Kr(t,e)}function Kr(t,e){Rt(t._transformStreamController),it(t._writable._writableStreamController,e),yr(t)}function yr(t){t._backpressure&&Ot(t,!1)}function Ot(t,e){t._backpressureChangePromise!==void 0&&t._backpressureChangePromise_resolve(),t._backpressureChangePromise=U(r=>{t._backpressureChangePromise_resolve=r}),t._backpressure=e}Object.defineProperties(Lt.prototype,{readable:{enumerable:!0},writable:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Lt.prototype,Symbol.toStringTag,{value:"TransformStream",configurable:!0});class ge{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!mt(this))throw pt("desiredSize");return jr(this._controlledTransformStream._readable._readableStreamController)}enqueue(e=void 0){if(!mt(this))throw pt("enqueue");ei(this,e)}error(e=void 0){if(!mt(this))throw pt("error");var r;r=e,Zn(this._controlledTransformStream,r)}terminate(){if(!mt(this))throw pt("terminate");(function(e){const r=e._controlledTransformStream;Fe(r._readable._readableStreamController);const o=new TypeError("TransformStream terminated");Kr(r,o)})(this)}}function mt(t){return!!x(t)&&!!Object.prototype.hasOwnProperty.call(t,"_controlledTransformStream")&&t instanceof ge}function Rt(t){t._transformAlgorithm=void 0,t._flushAlgorithm=void 0,t._cancelAlgorithm=void 0}function ei(t,e){const r=t._controlledTransformStream,o=r._readable._readableStreamController;if(!ze(o))throw new TypeError("Readable side is not in a state that permits enqueue");try{Je(o,e)}catch(n){throw Kr(r,n),r._readable._storedError}(function(n){return!jn(n)})(o)!==r._backpressure&&Ot(r,!0)}function mo(t,e){return se(t._transformAlgorithm(e),void 0,r=>{throw Zn(t._controlledTransformStream,r),r})}function pt(t){return new TypeError(`TransformStreamDefaultController.prototype.${t} can only be used on a TransformStreamDefaultController`)}function ar(t){t._finishPromise_resolve!==void 0&&(t._finishPromise_resolve(),t._finishPromise_resolve=void 0,t._finishPromise_reject=void 0)}function Me(t,e){t._finishPromise_reject!==void 0&&(Ge(t._finishPromise),t._finishPromise_reject(e),t._finishPromise_resolve=void 0,t._finishPromise_reject=void 0)}function po(t){return new TypeError(`TransformStream.prototype.${t} can only be used on a TransformStream`)}Object.defineProperties(ge.prototype,{enqueue:{enumerable:!0},error:{enumerable:!0},terminate:{enumerable:!0},desiredSize:{enumerable:!0}}),N(ge.prototype.enqueue,"enqueue"),N(ge.prototype.error,"error"),N(ge.prototype.terminate,"terminate"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(ge.prototype,Symbol.toStringTag,{value:"TransformStreamDefaultController",configurable:!0});const ms=Object.freeze(Object.defineProperty({__proto__:null,ByteLengthQueuingStrategy:Pt,CountQueuingStrategy:Mt,ReadableByteStreamController:oe,ReadableStream:Y,ReadableStreamBYOBReader:ue,ReadableStreamBYOBRequest:_e,ReadableStreamDefaultController:ne,ReadableStreamDefaultReader:ce,TransformStream:Lt,TransformStreamDefaultController:ge,WritableStream:de,WritableStreamDefaultController:Ye,WritableStreamDefaultWriter:re},Symbol.toStringTag,{value:"Module"})),ps=Si(ms);/*!
 * Based on xzwasm (c) Steve Sanderson. License: MIT - https://github.com/SteveSanderson/xzwasm
 * Contains xz-embedded by Lasse Collin and Igor Pavlov. License: Public domain - https://tukaani.org/xz/embedded.html
 * and walloc (c) 2020 Igalia, S.L. License: MIT - https://github.com/wingo/walloc
 */var ys=ur.exports,yo;function bs(){return yo||(yo=1,(function(t,e){(function(r,o){t.exports=o(ps)})(ys,r=>(()=>{var o=[,(s=>{s.exports="data:application/wasm;base64,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ACABQX9qIgENAAsgAkJ/hSECCyACC8oQAgx/An4CQAJAIAAoAiRFDQAgACgCACECDAELQQAhAiAAQQA6ACggAEIANwMAIABCADcDGCAAQcgAakEAQeQAEIaAgIAAGiAAQawBakEMNgIACyAAIAEoAgQiAzYCECAAQeAAaiEEIABByABqIQUgAEG2AWohBiAAQbABaiEHIABBqAFqIQggASgCECEJAkACQAJAAkADQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQCACDgoBAgAEBQYHCAkKDwsgASgCACEKIAAoAqgBIQIgACgCrAEhCyABKAIEIQwgASgCCCENDAILIAcgACgCqAEiDGogASgCACABKAIEIgJqIAEoAgggAmsiAiAAKAKsASAMayIMIAIgDEkbIgIQh4CAgAAaIAEgASgCBCACajYCBEEAIQwgAEEAIAAoAqgBIAJqIgIgAiAAKAKsASILRhs2AqgBIAIgC0cNESAAQQE2AgACQCAHQaiIgIAAQQYQhICAgABFDQBBBSEMDBILIAZBAkEAEI2AgIAAIAAoALgBRw0QQQYhDCAGLQAADREgACAALQC3ASICNgIgIAJBBEsNEUEBIAJ0QRNxRQ0RCyABKAIEIgwgASgCCCINRg0OAkAgASgCACIKIAxqLQAAIgsNACAAIAw2AhAgASAMQQFqNgIEQQYhAgwMC0EAIQIgAEEANgKoASAAQQI2AgAgACALQQJ0QQRqIgs2AqwBIAAgCzYCQAsgByACaiAKIAxqIA0gDGsiDCALIAJrIgIgDCACSRsiAhCHgICAABogASABKAIEIAJqNgIEQQAhDCAAQQAgACgCqAEgAmoiAiACIAAoAqwBIgtGGzYCqAEgAiALRw0PIAAgAkF8aiICNgKsAUEHIQwgByACQQAQjYCAgAAgByAAKAKsASICaigAAEcNDyAAQQI2AqgBIAAtALEBIgtBP3ENDAJAAkAgC0HAAHFFDQAgACAHIAggAhCRgICAAEEBRw0RIAAgACkDCDcDMCAAKAKsASECIAAtALEBIQsMAQsgAEJ/NwMwC0J/IQ4CQCALwEF/Sg0AIAAgByAIIAIQkYCAgABBAUcNECAAKAKsASECIAApAwghDgsgACAONwM4IAIgACgCqAEiC2tBAkkNDyAAIAtBAWoiCjYCqAEgCCALakEI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AA8LIAEgA0EBaiIFNgIEAkAgASgCACADai0AACAAKQMYIAAoAgQiA62Ip0H/AXFGDQBBBw8LIAAgA0EIaiIGNgIEIAUhAyAGIAJJDQALIABBADYCBCAAQgA3AxhBAQtvAQF/QQchAQJAIABBugFqLwAAQdm0AUcNACAAQbQBakEGQQAQjYCAgAAgAEGwAWooAABHDQAgAEGAAWopAwBCAoggADUAtAFSDQAgAEG4AWotAAANAEEBQQcgACgCICAAQbkBai0AAEYbIQELIAELwAIBA38CQAJAAkAgACgCJA0AIABBADoAKCAAQQA2AgBBASECDAELAkAgACgCAEEKRw0AQQAhAwwCC0ECIQMMAQtBASEDCwJAAkADQAJAAkACQAJAIAMOAwABAwMLIAEoAgQiAyABKAIIIgRGDQQgASgCACEFAkADQCAFIANqLQAADQEgASADQQFqIgM2AgQgACAAKAIEQQFqQQNxNgIEIAQgA0YNBgwACwsCQCAAKAIERQ0AQQcPCyAAKAIkRQ0BIABBADoAKCAAQQA2AgBBASEDDAMLIABCADcDGCAAQQA2AgQgAEHIAGpBAEHkABCGgICAABogAEGsAWpBDDYCAAtBAiEDDAELIAAgARCQgICAACIDQQFHDQIgAEEKNgIAQQAhAwwACwsCQCACDQBBAA8LQQdBASAAKAIEGyEDCyADC3UBAX8CQEG4CRCAgICAACICRQ0AIAIgADYCJCACIAAgARCbgICAACIANgKwCQJAIABFDQAgAkEAOgAoIAJCADcDACACQgA3AxggAkHIAGpBAEHkABCGgICAABogAkGsAWpBDDYCACACDwsgAhCCgICAAAtBAAseAAJAIABFDQAgACgCsAkQnYCAgAAgABCCgICAAAsL3RABCn8gAEHo3QFqIQIgAEHUAGohAyAAQRxqIgRBCGohBQJAAkADQCAAKAJAIQYCQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAgASgCBCIHIAEoAghJDQAgBkEHRg0BDBELIAYOCQECAwQFBgcACQ4LIAAoAkwhBgwHC0EBIQYgASAHQQFqNgIEIAEoAgAgB2otAAAiB0UNCAJAAkAgB0HfAUsNACAHQQFHDQELIABBgAI7AVACQCAAKAI8DQAgACABKAIMIAEoAhAiBmo2AhggACABKAIUIAZr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"}),(s=>{s.exports=r})],n={};function i(s){var c=n[s];if(c!==void 0)return c.exports;var l=n[s]={exports:{}};return o[s](l,l.exports,i),l.exports}i.d=(s,c)=>{for(var l in c)i.o(c,l)&&!i.o(s,l)&&Object.defineProperty(s,l,{enumerable:!0,get:c[l]})},i.o=(s,c)=>Object.prototype.hasOwnProperty.call(s,c),i.r=s=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})};var a={};return(()=>{i.r(a),i.d(a,{XzReadableStream:()=>I});var s=i(1);const c=globalThis.ReadableStream||i(2).ReadableStream,l=0,A=1;class d{constructor(f){this.exports=f.exports,this.memory=this.exports.memory,this.ptr=this.exports.create_context(),this._refresh(),this.bufSize=this.mem32[0],this.inStart=this.mem32[1]-this.ptr,this.inEnd=this.inStart+this.bufSize,this.outStart=this.mem32[4]-this.ptr}supplyInput(f){this._refresh(),this.mem8.subarray(this.inStart,this.inEnd).set(f,0),this.exports.supply_input(this.ptr,f.byteLength),this._refresh()}getNextOutput(){const f=this.exports.get_next_output(this.ptr);if(this._refresh(),f!==l&&f!==A)throw new Error(`get_next_output failed with error code ${f}`);return{outChunk:this.mem8.slice(this.outStart,this.outStart+this.mem32[5]),finished:f===A}}needsMoreInput(){return this.mem32[2]===this.mem32[3]}outputBufferIsFull(){return this.mem32[5]===this.bufSize}resetOutputBuffer(){this.outPos=this.mem32[5]=0}dispose(){this.exports.destroy_context(this.ptr),this.exports=null}_refresh(){var f;this.memory.buffer!==((f=this.mem8)==null?void 0:f.buffer)&&(this.mem8=new Uint8Array(this.memory.buffer,this.ptr),this.mem32=new Uint32Array(this.memory.buffer,this.ptr))}}class u{constructor(){this.locked=!1,this.waitQueue=[]}async acquire(){if(!this.locked){this.locked=!0;return}return new Promise(f=>{this.waitQueue.push(f)})}release(){this.waitQueue.length>0?this.waitQueue.shift()():this.locked=!1}}const g=class G extends c{static async _getModuleInstance(){const f=s.replace("data:application/wasm;base64,",""),h=Uint8Array.from(atob(f),B=>B.charCodeAt(0)).buffer,C={},y=await WebAssembly.instantiate(h,C);G._moduleInstance=y.instance}constructor(f){let h,C=null;const y=f.getReader();super({async start(B){await G._contextMutex.acquire();try{G._moduleInstance||await(G._moduleInstancePromise||(G._moduleInstancePromise=G._getModuleInstance())),h=new d(G._moduleInstance)}catch(p){throw G._contextMutex.release(),p}},async pull(B){try{if(h.needsMoreInput()){if(C===null||C.byteLength===0){const{done:E,value:_}=await y.read();E||(C=_)}const v=Math.min(h.bufSize,C.byteLength);h.supplyInput(C.subarray(0,v)),C=C.subarray(v)}const p=h.getNextOutput();B.enqueue(p.outChunk),h.resetOutputBuffer(),p.finished&&(h.dispose(),G._contextMutex.release(),B.close())}catch(p){throw h&&h.dispose(),G._contextMutex.release(),p}},cancel(){try{return h&&h.dispose(),y.cancel()}finally{G._contextMutex.release()}}})}};Vt(g,"_moduleInstancePromise"),Vt(g,"_moduleInstance"),Vt(g,"_contextMutex",new u);let I=g})(),a})())})(ur)),ur.exports}var ws=bs();class ti extends Error{}class Ce extends Error{}class M extends ti{}class Bs extends ti{}const bo=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],ri=new Array(256);for(let t=0;t<256;t++)ri[t]=`${bo[t>>>4&15]}${bo[t&15]}`;function Es(t){let e="";for(let r=0,o=t.length;r<o;r++)e+=ri[t[r]];return e}const wo=[0,1,3,7,15,31,63,127,255];class _s{constructor(e){this.stream=e,this.bitOffset=0,this.curByte=0,this.hasByte=!1}_ensureByte(){this.hasByte||(this.curByte=this.stream.readByte(),this.hasByte=!0)}read(e){let r=0;for(;e>0;){this._ensureByte();const o=8-this.bitOffset;if(e>=o)r<<=o,r|=wo[o]&this.curByte,this.hasByte=!1,this.bitOffset=0,e-=o;else{r<<=e;const n=o-e;r|=(this.curByte&wo[e]<<n)>>n,this.bitOffset+=e,e=0}}return r}seek(e){const r=e%8,o=(e-r)/8;this.bitOffset=r,this.stream.seek(o),this.hasByte=!1}pi(){const e=new Uint8Array(6);for(let r=0;r<e.length;r++)e[r]=this.read(8);return Es(e)}}const Bo=new Uint32Array([0,79764919,159529838,222504665,319059676,398814059,445009330,507990021,638119352,583659535,797628118,726387553,890018660,835552979,1015980042,944750013,1276238704,1221641927,1167319070,1095957929,1595256236,1540665371,1452775106,1381403509,1780037320,1859660671,1671105958,1733955601,2031960084,2111593891,1889500026,1952343757,2552477408,2632100695,2443283854,2506133561,2334638140,2414271883,2191915858,2254759653,3190512472,3135915759,3081330742,3009969537,2905550212,2850959411,2762807018,2691435357,3560074640,3505614887,3719321342,3648080713,3342211916,3287746299,3467911202,3396681109,4063920168,4143685023,4223187782,4286162673,3779000052,3858754371,3904687514,3967668269,881225847,809987520,1023691545,969234094,662832811,591600412,771767749,717299826,311336399,374308984,453813921,533576470,25881363,88864420,134795389,214552010,2023205639,2086057648,1897238633,1976864222,1804852699,1867694188,1645340341,1724971778,1587496639,1516133128,1461550545,1406951526,1302016099,1230646740,1142491917,1087903418,2896545431,2825181984,2770861561,2716262478,3215044683,3143675388,3055782693,3001194130,2326604591,2389456536,2200899649,2280525302,2578013683,2640855108,2418763421,2498394922,3769900519,3832873040,3912640137,3992402750,4088425275,4151408268,4197601365,4277358050,3334271071,3263032808,3476998961,3422541446,3585640067,3514407732,3694837229,3640369242,1762451694,1842216281,1619975040,1682949687,2047383090,2127137669,1938468188,2001449195,1325665622,1271206113,1183200824,1111960463,1543535498,1489069629,1434599652,1363369299,622672798,568075817,748617968,677256519,907627842,853037301,1067152940,995781531,51762726,131386257,177728840,240578815,269590778,349224269,429104020,491947555,4046411278,4126034873,4172115296,4234965207,3794477266,3874110821,3953728444,4016571915,3609705398,3555108353,3735388376,3664026991,3290680682,3236090077,3449943556,3378572211,3174993278,3120533705,3032266256,2961025959,2923101090,2868635157,2813903052,2742672763,2604032198,2683796849,2461293480,2524268063,2284983834,2364738477,2175806836,2238787779,1569362073,1498123566,1409854455,1355396672,1317987909,1246755826,1192025387,1137557660,2072149281,2135122070,1912620623,1992383480,1753615357,1816598090,1627664531,1707420964,295390185,358241886,404320391,483945776,43990325,106832002,186451547,266083308,932423249,861060070,1041341759,986742920,613929101,542559546,756411363,701822548,3316196985,3244833742,3425377559,3370778784,3601682597,3530312978,3744426955,3689838204,3819031489,3881883254,3928223919,4007849240,4037393693,4100235434,4180117107,4259748804,2310601993,2373574846,2151335527,2231098320,2596047829,2659030626,2470359227,2550115596,2947551409,2876312838,2788305887,2733848168,3165939309,3094707162,3040238851,2985771188]);class Qs{constructor(){this.crc=4294967295}getCRC(){return~this.crc>>>0}updateCRC(e){this.crc=this.crc<<8^Bo[(this.crc>>>24^e)&255]}updateCRCRun(e,r){for(;r-- >0;)this.crc=this.crc<<8^Bo[(this.crc>>>24^e)&255]}}class oi{readByte(){throw new Error("abstract method readByte() not implemented")}read(e,r,o){let n=0;for(;n<o;){const i=this.readByte();if(i<0)return n===0?-1:n;e[r++]=i,n++}return n}writeByte(e){throw new Error("abstract method readByte() not implemented")}seek(e){throw new Error("abstract method seek() not implemented")}write(e,r,o){let n;for(n=0;n<o;n++)this.writeByte(e[r++]);return o}flush(){}}const yt=20,Eo=258,_o=0,Ss=1,Rs=2,vs=6,Ds=50,ks="314159265359",qs="177245385090",Qo=function(t,e){const r=t[e];for(let o=e;o>0;o--)t[o]=t[o-1];return t[0]=r,r},O={LAST_BLOCK:-1,NOT_BZIP_DATA:-2,UNEXPECTED_INPUT_EOF:-3,UNEXPECTED_OUTPUT_EOF:-4,DATA_ERROR:-5,OUT_OF_MEMORY:-6,OBSOLETE_INPUT:-7},me={};me[O.LAST_BLOCK]="Bad file checksum";me[O.NOT_BZIP_DATA]="Not bzip data";me[O.UNEXPECTED_INPUT_EOF]="Unexpected input EOF";me[O.UNEXPECTED_OUTPUT_EOF]="Unexpected output EOF";me[O.DATA_ERROR]="Data error";me[O.OUT_OF_MEMORY]="Out of memory";me[O.OBSOLETE_INPUT]="Obsolete (pre 0.9.5) bzip format not supported.";const H=function(t,e){let r=me[t]||"unknown error";e&&(r+=": "+e);const o=new TypeError(r);throw o.errorCode=t,o};class Ns{constructor(e,r){this.writePos=this.writeCurrent=this.writeCount=0,this._start_bunzip(e,r)}_init_block(){return this._get_next_block()?(this.blockCRC=new Qs,!0):(this.writeCount=-1,!1)}_start_bunzip(e,r){const o=new Uint8Array(4);(e.read(o,0,4)!==4||String.fromCharCode(o[0],o[1],o[2])!=="BZh")&&H(O.NOT_BZIP_DATA,"bad magic");const n=o[3]-48;(n<1||n>9)&&H(O.NOT_BZIP_DATA,"level out of range"),this.reader=new _s(e),this.dbufSize=1e5*n,this.nextoutput=0,this.outputStream=r,this.streamCRC=0}_get_next_block(){let e,r,o;const n=this.reader,i=n.pi();if(i===qs)return!1;i!==ks&&H(O.NOT_BZIP_DATA),this.targetBlockCRC=n.read(32)>>>0,this.streamCRC=(this.targetBlockCRC^(this.streamCRC<<1|this.streamCRC>>>31))>>>0,n.read(1)&&H(O.OBSOLETE_INPUT);const a=n.read(24);a>this.dbufSize&&H(O.DATA_ERROR,"initial position out of bounds");let s=n.read(16),c=new Uint8Array(256),l=0;for(e=0;e<16;e++)if(s&1<<15-e){const b=e*16;for(o=n.read(16),r=0;r<16;r++)o&1<<15-r&&(c[l++]=b+r)}const A=n.read(3);(A<Rs||A>vs)&&H(O.DATA_ERROR);const d=n.read(15);d===0&&H(O.DATA_ERROR);const u=new Uint8Array(256);for(e=0;e<A;e++)u[e]=e;const g=new Uint8Array(d);for(e=0;e<d;e++){for(r=0;n.read(1);r++)r>=A&&H(O.DATA_ERROR);g[e]=Qo(u,r)}let I=l+2,m=[],f;for(r=0;r<A;r++){const b=new Uint8Array(I),k=new Uint16Array(yt+1);for(s=n.read(5),e=0;e<I;e++){for(;(s<1||s>yt)&&H(O.DATA_ERROR),!!n.read(1);)n.read(1)?s--:s++;b[e]=s}var h,C;for(h=C=b[0],e=1;e<I;e++)b[e]>C?C=b[e]:b[e]<h&&(h=b[e]);f={},m.push(f),f.permute=new Uint16Array(Eo),f.limit=new Uint32Array(yt+2),f.base=new Uint32Array(yt+1),f.minLen=h,f.maxLen=C;let T=0;for(e=h;e<=C;e++)for(k[e]=f.limit[e]=0,s=0;s<I;s++)b[s]===e&&(f.permute[T++]=s);for(e=0;e<I;e++)k[b[e]]++;for(T=s=0,e=h;e<C;e++)T+=k[e],f.limit[e]=T-1,T<<=1,s+=k[e],f.base[e+1]=T-s;f.limit[C+1]=Number.MAX_VALUE,f.limit[C]=T+k[C]-1,f.base[h]=0}const y=new Uint32Array(256);for(e=0;e<256;e++)u[e]=e;let B=0,p=0,v=0,E;const _=this.dbuf=new Uint32Array(this.dbufSize);for(I=0;;){for(I--||(I=Ds-1,v>=d&&H(O.DATA_ERROR),f=m[g[v++]]),e=f.minLen,r=n.read(e);e>f.maxLen&&H(O.DATA_ERROR),!(r<=f.limit[e]);e++)r=r<<1|n.read(1);r-=f.base[e],(r<0||r>=Eo)&&H(O.DATA_ERROR);const b=f.permute[r];if(b===_o||b===Ss){B||(B=1,s=0),s+=b===_o?B:2*B,B<<=1;continue}if(B)for(B=0,p+s>this.dbufSize&&H(O.DATA_ERROR),E=c[u[0]],y[E]+=s;s--;)_[p++]=E;if(b>l)break;p>=this.dbufSize&&H(O.DATA_ERROR),e=b-1,E=Qo(u,e),E=c[E],y[E]++,_[p++]=E}for((a<0||a>=p)&&H(O.DATA_ERROR),r=0,e=0;e<256;e++)o=r+y[e],y[e]=r,r=o;for(e=0;e<p;e++)E=_[e]&255,_[y[E]]|=e<<8,y[E]++;let Q=0,q=0,D=0;return p&&(Q=_[a],q=Q&255,Q>>=8,D=-1),this.writePos=Q,this.writeCurrent=q,this.writeCount=p,this.writeRun=D,!0}_read_bunzip(e,r){let o,n,i;if(this.writeCount<0)return 0;let a=this.dbuf,s=this.writePos,c=this.writeCurrent,l=this.writeCount;this.outputsize;let A=this.writeRun;for(;l;){for(l--,n=c,s=a[s],c=s&255,s>>=8,A++===3?(o=c,i=n,c=-1):(o=1,i=c),this.blockCRC.updateCRCRun(i,o);o--;)this.outputStream.writeByte(i),this.nextoutput++;c!=n&&(A=0)}return this.writeCount=l,this.blockCRC.getCRC()!==this.targetBlockCRC&&H(O.DATA_ERROR,"Bad block CRC (got "+this.blockCRC.getCRC().toString(16)+" expected "+this.targetBlockCRC.toString(16)+")"),this.nextoutput}}const Fs=function(t){if("readByte"in t)return t;const e=new oi;return e.pos=0,e.readByte=function(){return t[this.pos++]},e.seek=function(r){this.pos=r},e.eof=function(){return this.pos>=t.length},e},Ts=function(t){const e=new oi;return e.buffer=new Uint8Array(16384),e.pos=0,e.writeByte=function(r){if(this.pos>=this.buffer.length){const o=new Uint8Array(this.buffer.length*2);o.set(this.buffer),this.buffer=o}this.buffer[this.pos++]=r},e.getBuffer=function(){if(this.pos!==this.buffer.length){const r=new Uint8Array(this.pos);r.set(this.buffer.slice(0,this.pos)),this.buffer=r}return this.buffer},e._coerced=!0,e};function ni(t,e,r){const o=Fs(t),n=Ts(),i=new Ns(o,n);for(;!("eof"in o&&o.eof());)if(i._init_block())i._read_bunzip();else{const a=i.reader.read(32)>>>0;a!==i.streamCRC&&H(O.DATA_ERROR,"Bad stream CRC (got "+i.streamCRC.toString(16)+" expected "+a.toString(16)+")");break}if("getBuffer"in n)return n.getBuffer()}class Ze{constructor(e){this.low=0,this.range=4294967295,this.code=0,this.FFnum=0,this.carry=0,this.cache=0}RangeStartDecode(e){for(let r=0;r<5;r++)this.code=(this.code<<8)+e.ReadByte();this.code&=4294967295,this.code>>>=0}RangeGetFrequency(e){return this.range=Math.floor(this.range/e),Math.floor(this.code/this.range)}RangeDecode(e,r,o,n){for(this.code-=r*this.range,this.range*=o;this.range<1<<24;)this.range*=256,this.code=this.code*256+e.ReadByte()}RangeShiftLow(e){if(this.low<4278190080|this.carry){for(e.WriteByte(this.cache+this.carry);this.FFnum;)e.WriteByte(this.carry-1),this.FFnum--;this.cache=this.low>>>24,this.carry=0}else this.FFnum++;this.low<<=8,this.low>>>=0}RangeEncode(e,r,o,n){const i=this.low;for(this.range=Math.floor(this.range/n),this.low+=r*this.range,this.low>>>=0,this.range*=o,this.low<i&&(this.carry!=0&&console.log("ERROR: Multiple carry"),this.carry=1);this.range<1<<24;)this.range*=256,this.RangeShiftLow(e)}RangeFinishEncode(e){for(let r=0;r<5;r++)this.RangeShiftLow(e)}}const So=65519,bt=16;class V{constructor(e=256){this.total_freq=e,this.max_sym=e-1,this.S=[],this.F=[];for(let r=0;r<=this.max_sym;r++)this.S[r]=r,this.F[r]=1}ModelDecode(e,r){const o=r.RangeGetFrequency(this.total_freq);let n=0,i=0;for(;n+this.F[i]<=o;)n+=this.F[i++];r.RangeDecode(e,n,this.F[i],this.total_freq),this.F[i]+=bt,this.total_freq+=bt,this.total_freq>So&&this.ModelRenormalise();const a=this.S[i];if(i>0&&this.F[i]>this.F[i-1]){let s=this.F[i];this.F[i]=this.F[i-1],this.F[i-1]=s,s=this.S[i],this.S[i]=this.S[i-1],this.S[i-1]=s}return a}ModelRenormalise(){this.total_freq=0;for(let e=0;e<=this.max_sym;e++)this.F[e]-=Math.floor(this.F[e]/2),this.total_freq+=this.F[e]}ModelEncode(e,r,a){let n=0;for(var i=0;this.S[i]!=a;i++)n+=this.F[i];r.RangeEncode(e,n,this.F[i],this.total_freq),this.F[i]+=bt,this.total_freq+=bt,this.total_freq>So&&this.ModelRenormalise();var a=this.S[i];if(i>0&&this.F[i]>this.F[i-1]){let s=this.F[i];this.F[i]=this.F[i-1],this.F[i-1]=s,s=this.S[i],this.S[i]=this.S[i-1],this.S[i-1]=s}}}class z{constructor(e,r=0,o=0){o!==0?(this.buf=new Uint8Array(o),this.length=o):(this.buf=e,this.length=e.length),this.dataView=new DataView(this.buf.buffer),this.pos=r}EOF(){return this.pos>=this.length}ReadData(e){const r=this.buf.slice(this.pos,this.pos+e);return this.pos+=e,r}ReadByte(){const e=this.buf[this.pos];return this.pos++,e}ReadChar(){const e=this.buf[this.pos];return this.pos++,String.fromCharCode(e)}ReadUint16(){let e=this.ReadByte();return e|=this.ReadByte()<<8,e}ReadUint32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}ReadString(){let e="",r;do r=this.buf[this.pos++],r&&(e+=String.fromCharCode(r));while(r);return e}ReadUint7(){let e=0,r;do r=this.ReadByte(),e=e<<7|r&127;while(r&128);return e}ReadITF8(){let e=this.buf[this.pos];return this.pos++,e>=240?(e=(e&15)<<28,e+=(this.buf[this.pos+0]<<20)+(this.buf[this.pos+1]<<12)+(this.buf[this.pos+2]<<4)+(this.buf[this.pos+3]>>4),this.pos+=4):e>=224?(e=(e&15)<<24,e+=(this.buf[this.pos+0]<<16)+(this.buf[this.pos+1]<<8)+(this.buf[this.pos+2]<<0),this.pos+=3):e>=192?(e=(e&31)<<16,e+=(this.buf[this.pos+0]<<8)+(this.buf[this.pos+1]<<0),this.pos+=2):e>=128&&(e=(e&63)<<8,e+=this.buf[this.pos],this.pos++),e}}const Ps=1,Ms=4,Ls=8,Os=16,xs=32,Us=64,Ro=128;class ii{decode(e){return this.stream=new z(e),this.decodeStream(this.stream)}decodeStream(e,r=0){const o=this.stream.ReadByte();o&Os||(r=this.stream.ReadUint7());let n=r;const i=o&Ps;if(o&Ls)return this.decodeStripe(this.stream,r);if(o&Ro){var a;[a,n]=this.decodePackMeta(this.stream)}if(o&xs)var s=this.decodeCat(this.stream,n);else if(o&Ms)var s=this.decodeExt(this.stream,n);else if(o&Us)var s=i?this.decodeRLE1(this.stream,n):this.decodeRLE0(this.stream,n);else var s=i?this.decode1(this.stream,n):this.decode0(this.stream,n);return o&Ro&&(s=this.decodePack(s,a,r)),s}decode0(e,r){const o=new Uint8Array(r);let n=e.ReadByte();n==0&&(n=256);const i=new V(n),a=new Ze(e);a.RangeStartDecode(e);for(let s=0;s<r;s++)o[s]=i.ModelDecode(e,a);return o}decode1(e,r){const o=new Uint8Array(r);let n=e.ReadByte();n==0&&(n=256);const i=new Array(n);for(var a=0;a<n;a++)i[a]=new V(n);const s=new Ze(e);s.RangeStartDecode(e);let c=0;for(var a=0;a<r;a++)o[a]=i[c].ModelDecode(e,s),c=o[a];return o}decodeExt(e,r){return ni(e.buf.slice(e.pos))}decodeRLE0(e,r){const o=new Uint8Array(r);let n=e.ReadByte();n==0&&(n=256);const i=new V(n),a=new Array(258);for(var s=0;s<=257;s++)a[s]=new V(4);const c=new Ze(e);c.RangeStartDecode(e);for(var s=0;s<r;){o[s]=i.ModelDecode(e,c);let A=a[o[s]].ModelDecode(e,c),d=A,u=256;for(;A==3;)A=a[u].ModelDecode(e,c),u=257,d+=A;for(let g=1;g<=d;g++)o[s+g]=o[s];s+=d+1}return o}decodeRLE1(e,r){const o=new Uint8Array(r);let n=e.ReadByte();n==0&&(n=256);const i=new Array(n);for(var a=0;a<n;a++)i[a]=new V(n);const s=new Array(258);for(var a=0;a<=257;a++)s[a]=new V(4);const c=new Ze(e);c.RangeStartDecode(e);let l=0;for(var a=0;a<r;){o[a]=i[l].ModelDecode(e,c),l=o[a];let d=s[o[a]].ModelDecode(e,c),u=d,g=256;for(;d==3;)d=s[g].ModelDecode(e,c),g=257,u+=d;for(let I=1;I<=u;I++)o[a+I]=o[a];a+=u+1}return o}decodePackMeta(e){this.nsym=e.ReadByte();const r=new Array(this.nsym);for(let n=0;n<this.nsym;n++)r[n]=e.ReadByte();const o=e.ReadUint7();return[r,o]}decodePack(e,r,o){const n=new Uint8Array(o);if(this.nsym<=1)for(var i=0;i<o;i++)n[i]=r[0];else if(this.nsym<=2)for(var i=0,a=0;i<o;i++){if(i%8==0)var s=e[a++];n[i]=r[s&1],s>>=1}else if(this.nsym<=4)for(var i=0,a=0;i<o;i++){if(i%4==0)var s=e[a++];n[i]=r[s&3],s>>=2}else if(this.nsym<=16)for(var i=0,a=0;i<o;i++){if(i%2==0)var s=e[a++];n[i]=r[s&15],s>>=4}else return e;return n}packMeta(e){const r=new z("",0,1024),o=new Array(256);for(var n=0;n<e.length;n++)o[e[n]]=1;for(var i=0,n=0;n<256;n++)o[n]&&(o[n]=++i);r.WriteByte(i);for(var n=0;n<256;n++)o[n]&&(r.WriteByte(n),o[n]--);return[r,o,i]}decodeStripe(e,r){const o=e.ReadByte(),n=new Array(o),i=new Array(o);for(var a=0;a<o;a++)n[a]=e.ReadUint7();const s=new Array(o);for(var a=0;a<o;a++)i[a]=Math.floor(r/o)+(r%o>a),s[a]=this.decodeStream(e,i[a]);const c=new Uint8Array(r);for(var a=0;a<o;a++)for(let A=0;A<i[a];A++)c[A*o+a]=s[a][A];return c}decodeCat(e,r){const o=new Uint8Array(r);for(let n=0;n<r;n++)o[n]=e.ReadByte();return o}}function vt(t,e,r){let o=0,n=0,i=-1;const a=new Array(1024);for(;n<r;){const l=t.ReadByte();if(a[o++]=l,n+=l,l==i){let A=t.ReadByte();for(n+=l*A;A--;)a[o++]=l}i=l}let s=0;for(o=0,n=0;n<r;){let l=0;do{var c=a[o++];l+=c}while(c==255);for(;l--;)e[n++]=s;s++}}const si=2,Hs=4,Ys=8,vo=16,Do=32,ko=64,qo=128,Js=1,zs=2,Gs=4;function js(t,e,r){let o=t.context;return e.qctx=(e.qctx<<t.qshift)+t.qtab[r],o+=(e.qctx&(1<<t.qbits)-1)<<t.qloc,t.do_pos&&(o+=t.ptab[Math.min(e.p,1023)]<<t.ploc),t.do_delta&&(o+=t.dtab[Math.min(e.delta,255)]<<t.dloc,e.delta+=e.prevq!=r?1:0,e.prevq=r),t.do_sel&&(o+=e.s<<t.sloc),e.p--,o&65535}function Ws(t){const e={};e.context=t.ReadUint16(),e.pflags=t.ReadByte(),e.do_dedup=e.pflags&si,e.fixed_len=e.pflags&Hs,e.do_sel=e.pflags&Ys,e.do_qmap=e.pflags&vo,e.do_pos=e.pflags&Do,e.do_delta=e.pflags&ko,e.do_qtab=e.pflags&qo,e.max_sym=t.ReadByte();let r=t.ReadByte();if(e.qbits=r>>4,e.qshift=r&15,r=t.ReadByte(),e.qloc=r>>4,e.sloc=r&15,r=t.ReadByte(),e.ploc=r>>4,e.dloc=r&15,e.qmap=new Array(256),e.pflags&vo)for(var o=0;o<e.max_sym;o++)e.qmap[o]=t.ReadByte();else for(var o=0;o<256;o++)e.qmap[o]=o;if(e.qtab=new Array(1024),e.qbits>0&&e.pflags&qo)vt(t,e.qtab,256);else for(var o=0;o<256;o++)e.qtab[o]=o;return e.ptab=new Array(1024),e.pflags&Do&&vt(t,e.ptab,1024),e.dtab=new Array(256),e.pflags&ko&&vt(t,e.dtab,256),e}function Ks(t){const e={max_sym:0};if(t.ReadByte()!=5){console.error("Invalid FQZComp version number");return}const r=t.ReadByte(),o=r&Js?t.ReadByte():1;let n=r.nparam>1?r.nparam-1:0;const i=new Array(256);if(r&zs)n=t.ReadByte(),vt(t,i,256);else{for(var a=0;a<o;a++)i[a]=a;for(;a<256;a++)i[a]=o-1}e.do_rev=r&Gs,e.stab=i,e.max_sel=n,e.params=new Array(e.nparam);for(let s=0;s<o;s++)e.params[s]=Ws(t),e.max_sym<e.params[s].max_sym&&(e.max_sym=e.params[s].max_sym);return e}function $s(t){const e={};e.qual=new Array(65536);for(var r=0;r<65536;r++)e.qual[r]=new V(t.max_sym+1);e.len=new Array(4);for(var r=0;r<4;r++)e.len[r]=new V(256);return e.rev=new V(2),e.dup=new V(2),t.max_sel>0&&(e.sel=new V(t.max_sel+1)),e}function Vs(t,e,r,o,n,i){n.s=r.max_sel>0?o.sel.ModelDecode(t,e):0,n.x=r.stab[n.s];const a=r.params[n.x];if(a.fixed_len>=0){var s=o.len[0].ModelDecode(t,e);s|=o.len[1].ModelDecode(t,e)<<8,s|=o.len[2].ModelDecode(t,e)<<16,s|=o.len[3].ModelDecode(t,e)<<24,a.fixed_len>0&&(a.fixed_len=-s)}else s=-a.fixed_len;n.len=s,r.do_rev&&(i[n.rec]=o.rev.ModelDecode(t,e)),n.is_dup=0,a.pflags&si&&o.dup.ModelDecode(t,e)&&(n.is_dup=1),n.p=s,n.delta=0,n.qctx=0,n.prevq=0,n.rec++}function Xs(t,e){const r=t.ReadUint7(),o=Ks(t);if(!o)return;var n=o.params;const i=new Array(e.length),a=$s(o),s=new Ze(t);s.RangeStartDecode(t);const c=new Uint8Array(r),l={qctx:0,prevq:0,delta:0,p:0,s:0,x:0,len:0,is_dup:0,rec:0};let A=0;for(;A<r;){if(l.p==0){if(Vs(t,s,o,a,l,i),l.is_dup>0&&a.dup.ModelDecode(t,s)){for(let I=0;I<len;I++)c[A+I]=c[A+I-l.len];A+=l.len,l.p=0;continue}e.push(l.len);var n=o.params[l.x],d=n.context}const u=a.qual[d].ModelDecode(t,s);c[A++]=n.qmap[u],d=js(n,l,u)}return o.do_rev&&Zs(c,r,i,e),c}function Zs(t,e,r,o){let n=0,i=0;for(;i<e;){if(r[n]){let a=0,s=o[n]-1;for(;a<s;){const c=t[i+a];t[i+a]=t[i+s],t[i+s]=c,a++,s--}}i+=o[n++]}}function ea(t,e){const r=new z(t);return Xs(r,e)}function br(t,e){return t&(1<<e)-1}function ta(t,e){let r=0;for(;e>=t[r+1];)r++;return r}function ai(t,e){const r=1<<e,o=new Array(r);let n=0;for(let i=0;i<r;i++){for(;i>=t[n+1];)n++;o[i]=n}return o}function wr(t,e,r,o){return r*(t>>o)+(t&(1<<o)-1)-e}function Br(t,e){return e<32768&&(e=(e<<16)+t.ReadUint16()),e}function ra(t,e){const r=t.ReadUint7(),o=t.ReadUint7();if(r&1)var n=t.ReadData((r-1)/2);else{const s=t.ReadUint7();var n=t.ReadData(s);n=$r(new z(n),r/2,e)}var n=new z(n);const i=new Array(256);let a=n.ReadByte();a==0&&(a=256);for(let s=0;s<a;s++)i[n.ReadByte()]=1;return[i,n,o]}function oa(t,e,r,o){new z(t);const n=new Uint8Array(o);let i=0;for(let a=0;i<o;a++){const s=t[a];if(e[s]){const c=r.ReadUint7();for(let l=0;l<=c;l++)n[i++]=s}else n[i++]=s}return n}function na(t){const e=t.ReadByte(),r=new Array(e);for(let n=0;n<e;n++)r[n]=t.ReadByte();const o=t.ReadUint7();return[r,e,o]}function ia(t,e,r,o){const n=new Uint8Array(o);let i=0;if(r<=1)for(var a=0;a<o;a++)n[a]=e[0];else if(r<=2)for(a=0;a<o;a++){if(a%8==0)var s=t[i++];n[a]=e[s&1],s>>=1}else if(r<=4)for(a=0;a<o;a++){if(a%4==0)var s=t[i++];n[a]=e[s&3],s>>=2}else if(r<=16)for(a=0;a<o;a++){if(a%2==0)var s=t[i++];n[a]=e[s&15],s>>=4}return n}function sa(t,e){const r=t.ReadByte(),o=new Array(r),n=new Array(r);for(var i=0;i<r;i++)o[i]=t.ReadUint7();const a=new Array(r);for(var i=0;i<r;i++)n[i]=Math.floor(e/r)+(e%r>i),a[i]=li(t,n[i]);const s=new Uint8Array(e);for(var i=0;i<r;i++)for(let l=0;l<n[i];l++)s[l*r+i]=a[i][l];return s}function Ai(t){const e=new z(t);return li(e,0)}function li(t,h){const r=t.ReadByte(),o=r&1,n=r&4,i=r&8,a=r&16,s=r&32,c=r&64,l=r&128,A=n?32:4;if(a||(h=t.ReadUint7()),i)return sa(t,h);if(l)var d=h,[u,g,h]=na(t);if(c)var I=h,[m,f,h]=ra(t,A);if(s)var C=t.ReadData(h);else if(o==0)var C=$r(t,h,A);else var C=la(t,h,A);return c&&(C=oa(C,m,f,I)),l&&(C=ia(C,u,g,d)),C}function ci(t){const e=new Array(256);for(let i=0;i<256;i++)e[i]=0;let r=0,o=t.ReadByte(),n=o;do e[o]=1,r>0?(r--,o++):(o=t.ReadByte(),o==n+1&&(r=t.ReadByte())),n=o;while(o!=0);return e}function aa(t,e,r){for(var o=0;o<256;o++)e[o]=0;const n=ci(t);for(var o=0;o<256;o++)n[o]>0&&(e[o]=t.ReadUint7());ui(e,12),r[0]=0;for(var o=0;o<=255;o++)r[o+1]=r[o]+e[o]}function $r(t,e,r){const o=new Array(256),n=new Array(256);aa(t,o,n);const i=ai(n,12),a=new Array(r);for(var s=0;s<r;s++)a[s]=t.ReadUint32();const c=new Uint8Array(e);for(var s=0;s<e;s++){const A=s&r-1,d=br(a[A],12),u=i[d];c[s]=u,a[A]=wr(a[A],n[u],o[u],12),a[A]=Br(t,a[A])}return c}function ui(t,e){let r=0;for(var o=0;o<256;o++)r+=t[o];if(r==0||r==1<<e)return;let n=0;for(;r<1<<e;)r*=2,n++;for(var o=0;o<256;o++)t[o]<<=n}function Aa(t,e,r,o){for(var n=0;n<256;n++){e[n]=new Array(256),r[n]=new Array(256);for(var i=0;i<256;i++)e[n][i]=0}const a=ci(t);for(var n=0;n<256;n++){if(!a[n])continue;let c=0;for(var i=0;i<256;i++)a[i]&&(c>0?c--:(e[n][i]=t.ReadUint7(),e[n][i]==0&&(c=t.ReadByte())));ui(e[n],o),r[n][0]=0;for(var i=0;i<256;i++)r[n][i+1]=r[n][i]+e[n][i]}}function la(t,e,r){var o=t.ReadByte();const n=o>>4;var i=t;if(o&1){const h=t.ReadUint7(),C=t.ReadUint7();var o=new z(t.ReadData(C)),i=new z($r(o,h,4))}const a=new Array(256),s=new Array(256);Aa(i,a,s,n);const c=new Array(256);for(var l=0;l<256;l++)c[l]=ai(s[l],n);const A=new Array(r),d=new Array(r);for(var u=0;u<r;u++)A[u]=t.ReadUint32(),d[u]=0;const g=new Uint8Array(e),I=Math.floor(e/r);for(var l=0;l<I;l++)for(var u=0;u<r;u++){var m=br(A[u],n),f=c[d[u]][m];g[l+u*I]=f,A[u]=wr(A[u],s[d[u]][f],a[d[u]][f],n),A[u]=Br(t,A[u]),d[u]=f}for(l=r*l;l<e;){var m=br(A[r-1],n),f=ta(s[d[r-1]],m);g[l++]=f,A[r-1]=wr(A[r-1],s[d[r-1]][f],a[d[r-1]][f],n),A[r-1]=Br(t,A[r-1]),d[r-1]=f}return g}function ca(t){let e=0;for(const r of t)e+=r.length;return e}function ua(t){const e=new Uint8Array(ca(t));let r=0;for(const o of t)e.set(o,r),r+=o.length;return e}const da=new ii,xt=0,No=1,Fo=2,To=3,ga=4,fa=5,Po=7,Mo=8,Lo=9,di=10,ha=12;function Ca(t,e,r,o){let n=-1;const i=new Array(256);for(;!t.EOF();){const a=t.ReadByte(),s=a&128,c=a&64,l=a&63;if(s&&(n++,i[n]=new Array(13)),l!=xt&&s){const A=new Array(o-1).fill(di);i[n][xt]=new z(ua([new Uint8Array(l),A]))}if(c){const A=t.ReadByte(),d=t.ReadByte();i[n][l]=new z(i[A][d].buf)}else{const A=t.ReadUint7(),d=t.ReadData(A);i[n][l]=r?da.decode(d):Ai(d),i[n][l]=new z(i[n][l])}}return i}function Oo(t,e){let r=t+"";for(;r.length<e;)r="0"+r;return r}function Ia(t,e,r,o){let n=t[0][xt].ReadByte();const i=t[0][n].ReadUint32(),a=o-i;if(n==fa)return e[o]=e[a],r[o]=r[a],e[o];let s=1;e[o]="",r[o]=new Array(256);do{switch(n=t[s][xt].ReadByte(),n){case Fo:r[o][s]=t[s][Fo].ReadChar();break;case No:r[o][s]=t[s][No].ReadString();break;case Po:r[o][s]=t[s][Po].ReadUint32();break;case To:var c=t[s][To].ReadUint32(),l=t[s][ga].ReadByte();r[o][s]=Oo(c,l);break;case Mo:r[o][s]=(r[a][s]>>0)+t[s][Mo].ReadByte();break;case Lo:var c=(r[a][s]>>0)+t[s][Lo].ReadByte(),l=r[a][s].length;r[o][s]=Oo(c,l);break;case di:r[o][s]=r[a][s];break;default:r[o][s]="";break}e[o]+=r[o][s++]}while(n!=ha);return e[o]}function ma(o,e,r){var o=new z(o);o.ReadUint32();const n=o.ReadUint32(),i=o.ReadByte(),a=Ca(o,e,i,n),s=new Array(n),c=new Array(n);let l="";for(let A=0;A<n;A++)l+=Ia(a,s,c,A)+r;return l}function pa(t){return Ai(t)}function ya(t){return new ii().decode(t)}function ba(t){return ea(t,[])}function wa(t){const e=ma(t,0,"\0");return Uint8Array.from(Array.from(e).map(r=>r.charCodeAt(0)))}function gi(t,e,r){if(r)return r;if(t)return new Qi(t);if(e)return new vi(e);throw new Error("no url, path, or filehandle provided, cannot open")}const P=12,tt=1<<P,Ut=1<<23;class fi{constructor(){this.F=void 0,this.C=void 0}}class Ba{constructor(){this.fc=new Array(256);for(let e=0;e<this.fc.length;e+=1)this.fc[e]=new fi;this.R=null}}class Ea{constructor(){this.start=void 0,this.freq=void 0}}function _a(t,e,r){if(!(e<=65536))throw new M("assertion failed: start <= 1<<16");if(!(r<=65536-e))throw new M("assertion failed: freq <= 1<<16");t.start=e,t.freq=r}function hi(t,e,r,o){const n=(1<<o)-1;return r*(t>>o)+(t&n)-e}function Qa(t,e,r){return hi(t,e.start,e.freq,r)}function Sa(t,e){return t&(1<<e)-1}function Ra(t,e,r,o,n){const i=(1<<n)-1;if(t=o*(t>>n)+(t&i)-r,t<Ut)do{const a=255&e.get();t=t<<8|a}while(t<Ut);return t}function va(t,e,r,o){return Ra(t,e,r.start,r.freq,o)}function Da(t,e){if(t<Ut)do t=t<<8|255&e.get();while(t<Ut);return t}const R={FC:fi,AriDecoder:Ba,DecodingSymbol:Ea,symbolInit:_a,advanceStep:hi,advanceSymbolStep:Qa,get:Sa,advanceSymbol:va,renormalize:Da};function ka(t,e,r,o){let n=t.getInt(),i=t.getInt(),a=t.getInt(),s=t.getInt();const c=o.remaining(),l=c&-4;for(let d=0;d<l;d+=4){const u=e.R[R.get(n,P)],g=e.R[R.get(i,P)],I=e.R[R.get(a,P)],m=e.R[R.get(s,P)];o.putAt(d,u),o.putAt(d+1,g),o.putAt(d+2,I),o.putAt(d+3,m),n=R.advanceSymbolStep(n,r[255&u],P),i=R.advanceSymbolStep(i,r[255&g],P),a=R.advanceSymbolStep(a,r[255&I],P),s=R.advanceSymbolStep(s,r[255&m],P),n=R.renormalize(n,t),i=R.renormalize(i,t),a=R.renormalize(a,t),s=R.renormalize(s,t)}o.setPosition(l);let A;switch(c&3){case 0:break;case 1:A=e.R[R.get(n,P)],R.advanceSymbol(n,t,r[255&A],P),o.put(A);break;case 2:A=e.R[R.get(n,P)],R.advanceSymbol(n,t,r[255&A],P),o.put(A),A=e.R[R.get(i,P)],R.advanceSymbol(i,t,r[255&A],P),o.put(A);break;case 3:A=e.R[R.get(n,P)],R.advanceSymbol(n,t,r[255&A],P),o.put(A),A=e.R[R.get(i,P)],R.advanceSymbol(i,t,r[255&A],P),o.put(A),A=e.R[R.get(a,P)],R.advanceSymbol(a,t,r[255&A],P),o.put(A);break;default:throw new M("invalid output size encountered during rANS decoding")}o.setPosition(0)}function qa(t,e,r,o){const n=e.remaining();let i=t.getInt(),a=t.getInt(),s=t.getInt(),c=t.getInt();const l=n>>2;let A=0,d=l,u=2*l,g=3*l,I=0,m=0,f=0,h=0;for(;A<l;A+=1,d+=1,u+=1,g+=1){const C=255&r[I].R[R.get(i,P)],y=255&r[m].R[R.get(a,P)],B=255&r[f].R[R.get(s,P)],p=255&r[h].R[R.get(c,P)];e.putAt(A,C),e.putAt(d,y),e.putAt(u,B),e.putAt(g,p),i=R.advanceSymbolStep(i,o[I][C],P),a=R.advanceSymbolStep(a,o[m][y],P),s=R.advanceSymbolStep(s,o[f][B],P),c=R.advanceSymbolStep(c,o[h][p],P),i=R.renormalize(i,t),a=R.renormalize(a,t),s=R.renormalize(s,t),c=R.renormalize(c,t),I=C,m=y,f=B,h=p}for(;g<n;g+=1){const C=255&r[h].R[R.get(c,P)];e.putAt(g,C),c=R.advanceSymbol(c,t,o[h][C],P),h=C}}function Ci(t){if(!t)throw new M("assertion failed")}function Na(t,e,r){let o=0,n=0,i=t.get()&255;do e.fc[i]==null&&(e.fc[i]=new R.FC),e.fc[i].F=t.get()&255,e.fc[i].F>=128&&(e.fc[i].F&=-129,e.fc[i].F=(e.fc[i].F&127)<<8|t.get()&255),e.fc[i].C=n,R.symbolInit(r[i],e.fc[i].C,e.fc[i].F),e.R||(e.R=new Array(tt)),e.R.fill(i,n,n+e.fc[i].F),n+=e.fc[i].F,o===0&&i+1===(255&t.getByteAt(t.position()))?(i=t.get()&255,o=t.get()&255):o!==0?(o-=1,i+=1):i=t.get()&255;while(i!==0);Ci(n<tt)}function Fa(t,e,r){let o=0,n=255&t.get();do{let i=0,a=0,s=255&t.get();e[n]==null&&(e[n]=new R.AriDecoder);do e[n].fc[s]==null&&(e[n].fc[s]=new R.FC),e[n].fc[s].F=255&t.get(),e[n].fc[s].F>=128&&(e[n].fc[s].F&=-129,e[n].fc[s].F=(e[n].fc[s].F&127)<<8|255&t.get()),e[n].fc[s].C=a,e[n].fc[s].F===0&&(e[n].fc[s].F=tt),r[n][s]==null&&(r[n][s]=new R.RansDecSymbol),R.symbolInit(r[n][s],e[n].fc[s].C,e[n].fc[s].F),e[n].R==null&&(e[n].R=new Array(tt)),e[n].R.fill(s,a,a+e[n].fc[s].F),a+=e[n].fc[s].F,Ci(a<=tt),i===0&&s+1===(255&t.getByteAt(t.position()))?(s=255&t.get(),i=255&t.get()):i!==0?(i-=1,s+=1):s=255&t.get();while(s!==0);o===0&&n+1===(255&t.getByteAt(t.position()))?(n=255&t.get(),o=255&t.get()):o!==0?(o-=1,n+=1):n=255&t.get()}while(n!==0)}const Ta=4;function Pa(t,e){const r=new R.AriDecoder,o=new Array(256);for(let n=0;n<o.length;n+=1)o[n]=new R.DecodingSymbol;return Na(t,r,o),ka(t,r,o,e),e}function Ma(t,e){const r=new Array(256);for(let n=0;n<r.length;n+=1)r[n]=new R.AriDecoder;const o=new Array(256);for(let n=0;n<o.length;n+=1){o[n]=new Array(256);for(let i=0;i<o[n].length;i+=1)o[n][i]=new R.DecodingSymbol}return Fa(t,r,o),qa(t,e,r,o),e}class xo{constructor(e,r=0){this._buffer=e,this._dataView=new DataView(e.buffer),this._position=r,this.length=e.length}get(){const e=this._buffer[this._position];return this._position+=1,e}getByte(){return this.get()}getByteAt(e){return this._buffer[e]}position(){return this._position}put(e){return this._buffer[this._position]=e,this._position+=1,e}putAt(e,r){return this._buffer[e]=r,r}setPosition(e){return this._position=e,e}getInt(){const e=this._dataView.getInt32(this._position,!0);return this._position+=4,e}remaining(){return this._buffer.length-this._position}}function La(t,e,r=0){if(t.length===0)return e.fill(0),e;const o=new xo(t,r),n=o.get();if(n!==0&&n!==1)throw new M(`Invalid rANS order ${n}`);if(o.getInt()!==o.remaining()-Ta)throw new M("Incorrect input length.");const i=o.getInt(),a=new xo(e||new Uint8Array(i));if(a.length<i)throw new M(`Output buffer too small to fit ${i} bytes.`);switch(n){case 0:return Pa(o,a);case 1:return Ma(o,a);default:throw new M(`Invalid rANS order: ${n}`)}}function Oa(t){const e=t.split(/\r?\n/),r=[];for(const o of e){const[n,...i]=o.split(/\t/);n&&r.push({tag:n.slice(1),data:i.map(a=>{const s=a.indexOf(":");return s!==-1?{tag:a.slice(0,s),value:a.slice(s+1)}:{tag:a,value:""}})})}return r}const{inflate:xa}=Di;function Ii(t){return xa(t)}class Wt extends Error{}function ve(t,e,r){let o=0;if(e.bytePosition+(7-e.bitPosition+r)/8>t.length)throw new Wt("read error during decoding. the file seems to be truncated.");for(let n=r;n;n--)o<<=1,o|=t[e.bytePosition]>>e.bitPosition&1,e.bitPosition-=1,e.bitPosition<0&&(e.bytePosition+=1),e.bitPosition&=7;return o}var Uo={exports:{}},Ho={exports:{}},Yo;function Ua(){return Yo||(Yo=1,(function(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e={rotl:function(r,o){return r<<o|r>>>32-o},rotr:function(r,o){return r<<32-o|r>>>o},endian:function(r){if(r.constructor==Number)return e.rotl(r,8)&16711935|e.rotl(r,24)&4278255360;for(var o=0;o<r.length;o++)r[o]=e.endian(r[o]);return r},randomBytes:function(r){for(var o=[];r>0;r--)o.push(Math.floor(Math.random()*256));return o},bytesToWords:function(r){for(var o=[],n=0,i=0;n<r.length;n++,i+=8)o[i>>>5]|=r[n]<<24-i%32;return o},wordsToBytes:function(r){for(var o=[],n=0;n<r.length*32;n+=8)o.push(r[n>>>5]>>>24-n%32&255);return o},bytesToHex:function(r){for(var o=[],n=0;n<r.length;n++)o.push((r[n]>>>4).toString(16)),o.push((r[n]&15).toString(16));return o.join("")},hexToBytes:function(r){for(var o=[],n=0;n<r.length;n+=2)o.push(parseInt(r.substr(n,2),16));return o},bytesToBase64:function(r){for(var o=[],n=0;n<r.length;n+=3)for(var i=r[n]<<16|r[n+1]<<8|r[n+2],a=0;a<4;a++)n*8+a*6<=r.length*8?o.push(t.charAt(i>>>6*(3-a)&63)):o.push("=");return o.join("")},base64ToBytes:function(r){r=r.replace(/[^A-Z0-9+\/]/ig,"");for(var o=[],n=0,i=0;n<r.length;i=++n%4)i!=0&&o.push((t.indexOf(r.charAt(n-1))&Math.pow(2,-2*i+8)-1)<<i*2|t.indexOf(r.charAt(n))>>>6-i*2);return o}};Ho.exports=e})()),Ho.exports}var Ar,Jo;function zo(){if(Jo)return Ar;Jo=1;var t={utf8:{stringToBytes:function(e){return t.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(t.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var r=[],o=0;o<e.length;o++)r.push(e.charCodeAt(o)&255);return r},bytesToString:function(e){for(var r=[],o=0;o<e.length;o++)r.push(String.fromCharCode(e[o]));return r.join("")}}};return Ar=t,Ar}/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var lr,Go;function Ha(){if(Go)return lr;Go=1,lr=function(r){return r!=null&&(t(r)||e(r)||!!r._isBuffer)};function t(r){return!!r.constructor&&typeof r.constructor.isBuffer=="function"&&r.constructor.isBuffer(r)}function e(r){return typeof r.readFloatLE=="function"&&typeof r.slice=="function"&&t(r.slice(0,0))}return lr}var jo;function Ya(){return jo||(jo=1,(function(){var t=Ua(),e=zo().utf8,r=Ha(),o=zo().bin,n=function(i,a){i.constructor==String?a&&a.encoding==="binary"?i=o.stringToBytes(i):i=e.stringToBytes(i):r(i)?i=Array.prototype.slice.call(i,0):!Array.isArray(i)&&i.constructor!==Uint8Array&&(i=i.toString());for(var s=t.bytesToWords(i),c=i.length*8,l=1732584193,A=-271733879,d=-1732584194,u=271733878,g=0;g<s.length;g++)s[g]=(s[g]<<8|s[g]>>>24)&16711935|(s[g]<<24|s[g]>>>8)&4278255360;s[c>>>5]|=128<<c%32,s[(c+64>>>9<<4)+14]=c;for(var I=n._ff,m=n._gg,f=n._hh,h=n._ii,g=0;g<s.length;g+=16){var C=l,y=A,B=d,p=u;l=I(l,A,d,u,s[g+0],7,-680876936),u=I(u,l,A,d,s[g+1],12,-389564586),d=I(d,u,l,A,s[g+2],17,606105819),A=I(A,d,u,l,s[g+3],22,-1044525330),l=I(l,A,d,u,s[g+4],7,-176418897),u=I(u,l,A,d,s[g+5],12,1200080426),d=I(d,u,l,A,s[g+6],17,-1473231341),A=I(A,d,u,l,s[g+7],22,-45705983),l=I(l,A,d,u,s[g+8],7,1770035416),u=I(u,l,A,d,s[g+9],12,-1958414417),d=I(d,u,l,A,s[g+10],17,-42063),A=I(A,d,u,l,s[g+11],22,-1990404162),l=I(l,A,d,u,s[g+12],7,1804603682),u=I(u,l,A,d,s[g+13],12,-40341101),d=I(d,u,l,A,s[g+14],17,-1502002290),A=I(A,d,u,l,s[g+15],22,1236535329),l=m(l,A,d,u,s[g+1],5,-165796510),u=m(u,l,A,d,s[g+6],9,-1069501632),d=m(d,u,l,A,s[g+11],14,643717713),A=m(A,d,u,l,s[g+0],20,-373897302),l=m(l,A,d,u,s[g+5],5,-701558691),u=m(u,l,A,d,s[g+10],9,38016083),d=m(d,u,l,A,s[g+15],14,-660478335),A=m(A,d,u,l,s[g+4],20,-405537848),l=m(l,A,d,u,s[g+9],5,568446438),u=m(u,l,A,d,s[g+14],9,-1019803690),d=m(d,u,l,A,s[g+3],14,-187363961),A=m(A,d,u,l,s[g+8],20,1163531501),l=m(l,A,d,u,s[g+13],5,-1444681467),u=m(u,l,A,d,s[g+2],9,-51403784),d=m(d,u,l,A,s[g+7],14,1735328473),A=m(A,d,u,l,s[g+12],20,-1926607734),l=f(l,A,d,u,s[g+5],4,-378558),u=f(u,l,A,d,s[g+8],11,-2022574463),d=f(d,u,l,A,s[g+11],16,1839030562),A=f(A,d,u,l,s[g+14],23,-35309556),l=f(l,A,d,u,s[g+1],4,-1530992060),u=f(u,l,A,d,s[g+4],11,1272893353),d=f(d,u,l,A,s[g+7],16,-155497632),A=f(A,d,u,l,s[g+10],23,-1094730640),l=f(l,A,d,u,s[g+13],4,681279174),u=f(u,l,A,d,s[g+0],11,-358537222),d=f(d,u,l,A,s[g+3],16,-722521979),A=f(A,d,u,l,s[g+6],23,76029189),l=f(l,A,d,u,s[g+9],4,-640364487),u=f(u,l,A,d,s[g+12],11,-421815835),d=f(d,u,l,A,s[g+15],16,530742520),A=f(A,d,u,l,s[g+2],23,-995338651),l=h(l,A,d,u,s[g+0],6,-198630844),u=h(u,l,A,d,s[g+7],10,1126891415),d=h(d,u,l,A,s[g+14],15,-1416354905),A=h(A,d,u,l,s[g+5],21,-57434055),l=h(l,A,d,u,s[g+12],6,1700485571),u=h(u,l,A,d,s[g+3],10,-1894986606),d=h(d,u,l,A,s[g+10],15,-1051523),A=h(A,d,u,l,s[g+1],21,-2054922799),l=h(l,A,d,u,s[g+8],6,1873313359),u=h(u,l,A,d,s[g+15],10,-30611744),d=h(d,u,l,A,s[g+6],15,-1560198380),A=h(A,d,u,l,s[g+13],21,1309151649),l=h(l,A,d,u,s[g+4],6,-145523070),u=h(u,l,A,d,s[g+11],10,-1120210379),d=h(d,u,l,A,s[g+2],15,718787259),A=h(A,d,u,l,s[g+9],21,-343485551),l=l+C>>>0,A=A+y>>>0,d=d+B>>>0,u=u+p>>>0}return t.endian([l,A,d,u])};n._ff=function(i,a,s,c,l,A,d){var u=i+(a&s|~a&c)+(l>>>0)+d;return(u<<A|u>>>32-A)+a},n._gg=function(i,a,s,c,l,A,d){var u=i+(a&c|s&~c)+(l>>>0)+d;return(u<<A|u>>>32-A)+a},n._hh=function(i,a,s,c,l,A,d){var u=i+(a^s^c)+(l>>>0)+d;return(u<<A|u>>>32-A)+a},n._ii=function(i,a,s,c,l,A,d){var u=i+(s^(a|~c))+(l>>>0)+d;return(u<<A|u>>>32-A)+a},n._blocksize=16,n._digestsize=16,Uo.exports=function(i,a){if(i==null)throw new Error("Illegal argument "+i);var s=t.wordsToBytes(n(i,a));return a&&a.asBytes?s:a&&a.asString?o.bytesToString(s):t.bytesToHex(s)}})()),Uo.exports}var Ja=Ya();const za=Ri(Ja),Wo=65536,Le=Wo*Wo,Ga=1<<24,ja=Ga*Le;function Wa(t){return t&-128?t&-16384?t&-2097152?t&-268435456?5:4:3:2:1}function S(t,e){let r=e;const o=t[r];let n;return o<128?(n=o,r+=1):o<192?(n=(o&63)<<8|t[r+1],r+=2):o<224?(n=(o&31)<<16|t[r+1]<<8|t[r+2],r+=3):o<240?(n=(o&15)<<24|t[r+1]<<16|t[r+2]<<8|t[r+3],r+=4):(n=(o&15)<<28|t[r+1]<<20|t[r+2]<<12|t[r+3]<<4|t[r+4]&15,r+=5),[n,r-e]}function Ht(t,e){let r=e;const o=t[r];let n;return o<128?(n=o,r+=1):o<192?(n=(o<<8|t[r+1])&16383,r+=2):o<224?(n=(o&63)<<16|t[r+1]<<8|t[r+2],r+=3):o<240?(n=(o&31)<<24|t[r+1]<<16|t[r+2]<<8|t[r+3],r+=4):o<248?(n=(t[r]&15)*Le+(t[r+1]<<24|t[r+2]<<16|t[r+3]<<8|t[r+4]),r+=5):o<252?(n=((t[r]&7)<<8|t[r+1])*Le+(t[r+2]<<24|t[r+3]<<16|t[r+4]<<8|t[r+5]),r+=6):o<254?(n=((t[r]&3)<<16|t[r+1]<<8|t[r+2])*Le+(t[r+3]<<24|t[r+4]<<16|t[r+5]<<8|t[r+6]),r+=7):o<255?(n=(t[r+1]<<24|t[r+2]<<16|t[r+3]<<8|t[r+4])*Le+(t[r+5]<<24|t[r+6]<<16|t[r+7]<<8|t[r+8]),r+=8):(n=t[r+1]*ja+(t[r+2]<<24|t[r+3]<<16|t[r+4]<<8|t[r+5])*Le+(t[r+6]<<24|t[r+7]<<16|t[r+8]<<8|t[r+9]),r+=9),[n,r-e]}function De(t,e,r=0,o=0){const{offset:n,value:i}=e(t,r);return{...i,_endPosition:n+o,_size:n-r}}function Kt(t,e){const r=t.prototype[e],o=`_memo_${e}`;t.prototype[e]=function(){if(!(o in this)){const n=r.call(this);this[o]=n,Promise.resolve(n).catch(()=>{delete this[o]})}return this[o]}}function Ka(t){return za(t.toUpperCase().replaceAll(/[^\u0021-\u007e]/g,""))}function mi(){return{parser:(t,e=0)=>{const r=new DataView(t.buffer,t.byteOffset,t.length),o=new TextDecoder("utf8");let n=0;const i=o.decode(t.subarray(n,n+4));n+=4;const a=r.getUint8(n);n+=1;const s=r.getUint8(n);n+=1;const c=o.decode(t.subarray(n,n+20)).replaceAll("\0","");return n+=20,{value:{magic:i,majorVersion:a,minorVersion:s,fileId:c},offset:n}},maxLength:26}}function $a(){return{parser:(t,e=0)=>{const r=t,o=new DataView(r.buffer,r.byteOffset,r.length);let n=0;const i=o.getUint8(n),a=["raw","gzip","bzip2","lzma","rans","rans4x16","arith","fqzcomp","tok3"][i];if(!a)throw new Error(`compression method number ${i} not implemented`);n+=1;const s=o.getUint8(n),c=["FILE_HEADER","COMPRESSION_HEADER","MAPPED_SLICE_HEADER","UNMAPPED_SLICE_HEADER","EXTERNAL_DATA","CORE_DATA"][s];if(!c)throw new Error(`invalid block content type id ${s}`);n+=1;const[l,A]=S(t,n);n+=A;const[d,u]=S(t,n);n+=u;const[g,I]=S(t,n);return n+=I,{offset:n,value:{uncompressedSize:g,compressedSize:d,contentId:l,contentType:c,compressionMethod:a}}},maxLength:17}}function Va(){return{parser:(t,e)=>{const r=t,o=new DataView(r.buffer,r.byteOffset,r.length).getUint32(e,!0);return e+=4,{offset:e,value:{crc32:o}}},maxLength:4}}function Ko(t,e,r){const o=new TextDecoder("utf8").decode(t.subarray(e,r)),n=[];for(let i=0;i<o.length;i+=3)n.push(o.slice(i,i+3));return n}function Xa(){return{parser:(t,e)=>{const[r,o]=S(t,e);e+=o;const n=t.subarray(e,e+r);e+=r;const i=[];let a=0,s=0;for(;s<n.length;s++)n[s]||(i.push(Ko(n,a,s)),a=s+1);return s>a&&i.push(Ko(n,a,s)),{value:{size:r,ents:i},offset:e}}}}function Za(){return{parser:(t,e)=>{const r=t,o=new DataView(r.buffer,r.byteOffset,r.length),[n,i]=S(t,e);e+=i;const[a,s]=S(t,e);e+=s;const c=[];for(let l=0;l<a;l++){const A=String.fromCharCode(t[e])+String.fromCharCode(t[e+1]);if(e+=2,A==="MI"||A==="UI"||A==="PI"||A==="RN"||A==="AP"||A==="RR")c.push({key:A,value:!!o.getUint8(e)}),e+=1;else if(A==="SM")c.push({key:A,value:[o.getUint8(e),o.getUint8(e+1),o.getUint8(e+2),o.getUint8(e+3),o.getUint8(e+4)]}),e+=5;else if(A==="TD"){const{offset:d,value:u}=Xa().parser(t,e);c.push({key:A,value:u.ents}),e=d}else throw new Error(`unknown key ${A}`)}return{value:{mapSize:n,mapCount:a,ents:c},offset:e}}}}function cr(t){const e={};for(const{key:r,value:o}of t.ents)e[r]&&console.warn(`duplicate key ${r} in map`),e[r]=o;return e}function et(t){return typeof t.refSeqId=="number"}function eA(t){let e=0;return e+=5,e+=9,e+=10,e+=16,{parser:(r,o)=>{const[n,i]=S(r,o);o+=i;let a=0;if(t>=3){const[g,I]=Ht(r,o);o+=I,a=g}else if(t===2){const[g,I]=S(r,o);o+=I,a=g}else console.warn("recordCounter=0");const[s,c]=S(r,o);o+=c;const[l,A]=S(r,o);o+=A;const d=[];for(let g=0;g<l;g++){const[I,m]=S(r,o);o+=m,d.push(I)}let u;return t>=2&&(u=[...r.subarray(o,o+16)],o+=16),{value:{recordCounter:a,md5:u,contentIds:d,numContentIds:l,numBlocks:s,numRecords:n},offset:o}},maxLength:r=>e+r*5}}function tA(t){let e=0;return e+=20,e+=9,e+=15,e+=16,{parser:(r,o)=>{const[n,i]=S(r,o);o+=i;const[a,s]=S(r,o);o+=s;const[c,l]=S(r,o);o+=l;const[A,d]=S(r,o);o+=d;let u=0;if(t>=3){const[p,v]=Ht(r,o);o+=v,u=p}else if(t===2){const[p,v]=S(r,o);o+=v,u=p}else console.warn("majorVersion is <2, recordCounter set to 0");const[g,I]=S(r,o);o+=I;const[m,f]=S(r,o);o+=f;const h=[];for(let p=0;p<m;p++){const[v,E]=S(r,o);o+=E,h.push(v)}const[C,y]=S(r,o);o+=y;let B;return t>=2&&(B=[...r.subarray(o,o+16)],o+=16),{value:{md5:B,numBlocks:g,numRecords:A,numContentIds:m,refSeqSpan:c,refSeqId:n,refSeqStart:a,recordCounter:u,refBaseBlockId:C,contentIds:h},offset:o}},maxLength:r=>e+r*5}}function rA(){return{parser:(t,e)=>At(t,e)}}function At(t,e){const r=t,o=new DataView(r.buffer,r.byteOffset,r.length),[n,i]=S(t,e);e+=i;const[a,s]=S(t,e);e+=s;const c={};if(n!==0)if(n===1){const[l,A]=S(t,e);c.blockContentId=l,e+=A}else if(n===2){const[l,A]=S(t,e);c.offset=l,e+=A;const[d,u]=S(t,e);c.M=d,e+=u}else if(n===3){const l=S(t,e),A=l[0];e+=l[1];const d=[];for(let m=0;m<A;m++){const f=S(t,e);d.push(f[0]),e+=f[1]}c.symbols=d;const u=S(t,e),g=l[0];c.numLengths=g,c.numCodes=A,c.numLengths=g,e+=u[1];const I=[];for(let m=0;m<g;m++){const f=S(t,e);e+=f[1],I.push(f[0])}c.bitLengths=I}else if(n===4){const{value:l,offset:A}=At(t,e);c.lengthsEncoding=l,e=A;const{value:d,offset:u}=At(t,e);c.valuesEncoding=d,e=u}else if(n===5){c.stopByte=o.getUint8(e),e+=1;const[l,A]=S(t,e);c.blockContentId=l,e+=A}else if(n===6){const[l,A]=S(t,e);c.offset=l,e+=A;const[d,u]=S(t,e);c.length=d,e+=u}else if(n===7){const[l,A]=S(t,e);c.offset=l,e+=A;const[d,u]=S(t,e);c.K=d,e+=u}else if(n===8){const[l,A]=S(t,e);c.offset=l,e+=A;const[d,u]=S(t,e);c.log2m=d,e+=u}else if(n===9){const[l,A]=S(t,e);c.offset=l,e+=A}else throw new Error(`unknown codecId ${n}`);return{value:{codecId:n,parametersBytes:a,parameters:c},offset:e}}function pi(){return{parser:(t,e)=>{const[r,o]=S(t,e);e+=o;const[n,i]=S(t,e);e+=i;const a=[];for(let s=0;s<n;s++){const c=String.fromCharCode(t[e])+String.fromCharCode(t[e+1]);e+=2;const{value:l,offset:A}=At(t,e);e=A,a.push({key:c,value:l})}return{value:{mapSize:r,ents:a,mapCount:n},offset:e}}}}function yi(){return{parser:(t,e)=>{const[r,o]=S(t,e);e+=o;const[n,i]=S(t,e);e+=i;const a=[];for(let s=0;s<n;s++){const[c,l]=S(t,e);e+=l;const A=String.fromCharCode(c>>16&255)+String.fromCharCode(c>>8&255)+String.fromCharCode(c&255),{value:d,offset:u}=At(t,e);e=u,a.push({key:A,value:d})}return{value:{mapSize:r,ents:a,mapCount:n},offset:e}}}}function oA(){return{parser:(t,e)=>{const{value:r,offset:o}=Za().parser(t,e);e=o;const{value:n,offset:i}=pi().parser(t,e);e=i;const{value:a,offset:s}=yi().parser(t,e);return e=s,{value:{dataSeriesEncoding:cr(n),preservation:cr(r),tagEncoding:cr(a)},offset:e}}}}function nA(t){let e=4;return e+=20,e+=9,e+=9,e+=10,{maxLength:e,parser:(r,o)=>{const n=r,i=new DataView(n.buffer,n.byteOffset,n.length).getInt32(o,!0);o+=4;const[a,s]=S(r,o);o+=s;const[c,l]=S(r,o);o+=l;const[A,d]=S(r,o);o+=d;const[u,g]=S(r,o);o+=g;let I=0;if(t>=3){const[B,p]=Ht(r,o);I=B,o+=p}else if(t===2){const[B,p]=S(r,o);I=B,o+=p}else console.warn("setting recordCounter=0");let m;if(t>1){const[B,p]=Ht(r,o);m=B,o+=p}const[f,h]=S(r,o);o+=h;const[C,y]=S(r,o);return o+=y,{value:{length:i,refSeqId:a,refSeqStart:c,alignmentSpan:A,numBlocks:f,numLandmarks:C,numBases:m,recordCounter:I,numRecords:u},offset:o}}}}function iA(t){return{parser:(e,r)=>{const o=e,n=new DataView(o.buffer,o.byteOffset,o.length),[i,a]=S(e,r);r+=a;const s=[];for(let l=0;l<i;l++){const[A,d]=S(e,r);r+=d,s.push(A)}let c;return t>=3&&(c=n.getUint32(r,!0),r+=4),{value:{...c===void 0?{}:{crc32:c},numLandmarks:i,landmarks:s},offset:r}},maxLength:e=>5+5*e+4}}function Se(t){return{cramFileDefinition:mi(),cramBlockHeader:$a(),cramBlockCrc32:Va(),cramDataSeriesEncodingMap:pi(),cramTagEncodingMap:yi(),cramCompressionHeader:oA(),cramEncoding:rA(),cramUnmappedSliceHeader:eA(t),cramMappedSliceHeader:tA(t),cramContainerHeader1:nA(t),cramContainerHeader2:iA(t)}}function Yt(t){let e="";for(let r=0;r<t.length&&t[r]!==0;r++)e+=String.fromCharCode(t[r]);return e}function sA(t){const e=String.fromCharCode(t[0]),r=new DataView(t.buffer).getUint32(1,!0),o=new Array(r);if(t=t.slice(5),e==="c"){const n=new Int8Array(t.buffer);for(let i=0;i<r;i++)o[i]=n[i]}else if(e==="C"){const n=new Uint8Array(t.buffer);for(let i=0;i<r;i++)o[i]=n[i]}else if(e==="s"){const n=new Int16Array(t.buffer);for(let i=0;i<r;i++)o[i]=n[i]}else if(e==="S"){const n=new Uint16Array(t.buffer);for(let i=0;i<r;i++)o[i]=n[i]}else if(e==="i"){const n=new Int32Array(t.buffer);for(let i=0;i<r;i++)o[i]=n[i]}else if(e==="I"){const n=new Uint32Array(t.buffer);for(let i=0;i<r;i++)o[i]=n[i]}else if(e==="f"){const n=new Float32Array(t.buffer);for(let i=0;i<r;i++)o[i]=n[i]}else throw new Error(`unknown type: ${e}`);return o}function aA(t,e){if(t==="Z")return Yt(e);if(t==="A")return String.fromCharCode(e[0]);if(t==="I")return new Uint32Array(e.buffer)[0];if(t==="i")return new Int32Array(e.buffer)[0];if(t==="s")return new Int16Array(e.buffer)[0];if(t==="S")return new Uint16Array(e.buffer)[0];if(t==="c")return new Int8Array(e.buffer)[0];if(t==="C")return e[0];if(t==="f")return new Float32Array(e.buffer)[0];if(t==="H")return Number.parseInt(Yt(e).replace(/^0x/,""),16);if(t==="B")return sA(e);throw new M(`Unrecognized tag type ${t}`)}function AA(t,e,r,o,n){let i=0,a=t-1;const s=new Array(e);function c([l,A]){const d=r(A);if(l==="character")return String.fromCharCode(d);if(l==="string"){let u="";for(let g=0;g<d.byteLength;g++)u+=String.fromCharCode(d[g]);return u}else if(l==="numArray")return Array.from(d);return d}for(let l=0;l<e;l++){const A=String.fromCharCode(r("FC")),d=r("FP"),u={B:["character","BA"],S:["string",n>1?"SC":"IN"],X:["number","BS"],D:["number","DL"],I:["string","IN"],i:["character","BA"],b:["string","BB"],q:["numArray","QQ"],Q:["number","QS"],H:["number","HC"],P:["number","PD"],N:["number","RS"]}[A];if(!u)throw new M(`invalid read feature code "${A}"`);let g=c(u);const I={B:["number","QS"]}[A];I&&(g=[g,c(I)]),i+=d;const m=i;a+=d;const f=a;A==="D"||A==="N"?a+=g:A==="I"||A==="S"?a-=g.length:A==="i"&&(a-=1),s[l]={code:A,pos:m,refPos:f,data:g}}return s}function lA(t,e,r,o,n,i,a,s,c){let l=e("BF");const A=e("CF");if(!et(o.parsedContent))throw new Error("slice header not mapped");const d=s>1&&o.parsedContent.refSeqId===-2?e("RI"):o.parsedContent.refSeqId,u=e("RL");let g=e("AP");r.APdelta&&(g=g+a.lastAlignmentStart),a.lastAlignmentStart=g;const I=e("RG");let m;r.readNamesIncluded&&(m=Yt(e("RN")));let f,h,C;if(je.isDetached(A)){const b=e("MF");let k;r.readNamesIncluded||(k=Yt(e("RN")),m=k);const T=e("NS"),pe=e("NP");(b||T>-1)&&(f={mateFlags:b,mateSequenceId:T,mateAlignmentStart:pe,mateReadName:k}),h=e("TS"),Zr.isUnmapped(b)&&(l=Xt.setMateUnmapped(l)),Zr.isOnNegativeStrand(b)&&(l=Xt.setMateReverseComplemented(l))}else je.isWithMateDownstream(A)&&(C=e("NF")+c+1);const y=e("TL");if(y<0)throw new M("invalid TL index");const B={},p=r.getTagNames(y),v=p.length;for(let b=0;b<v;b++){const k=p[b],T=k.slice(0,2),pe=k.slice(2,3),ut=r.getCodecForTag(k).decode(t,n,i,a);B[T]=ut===void 0?void 0:typeof ut=="number"?ut:aA(pe,ut)}let E,_,Q,q,D;if(Xt.isSegmentUnmapped(l))if(je.isDecodeSequenceAsStar(A))D=null,q=null;else{const b=new Array(u);for(let k=0;k<b.length;k++)b[k]=e("BA");if(D=String.fromCharCode(...b),je.isPreservingQualityScores(A)){q=new Array(u);for(let k=0;k<b.length;k++)q[k]=e("QS")}}else{const b=e("FN");if(b&&(E=AA(g,b,e,r,s)),_=u,E)for(const{code:k,data:T}of E)k==="D"||k==="N"?_+=T:k==="I"||k==="S"?_=_-T.length:k==="i"&&(_=_-1);if(Number.isNaN(_)&&(console.warn(`${m||`${d}:${g}`} record has invalid read features`),_=u),Q=e("MQ"),je.isPreservingQualityScores(A)){q=new Array(u);for(let k=0;k<q.length;k++)q[k]=e("QS")}}return{readLength:u,sequenceId:d,cramFlags:A,flags:l,alignmentStart:g,readGroupId:I,readName:m,mateToUse:f,templateSize:h,mateRecordNumber:C,readFeatures:E,lengthOnRef:_,mappingQuality:Q,qualityScores:q,readBases:D,tags:B}}function cA(t,e,r){function o(c){const l=[c];if(c.mateRecordNumber!==void 0&&c.mateRecordNumber>=0){const A=t[c.mateRecordNumber];if(!A)throw new M("intra-slice mate record not found, this file seems malformed");l.push(...o(A))}return l}const n=o(r),i=n.map(c=>c.alignmentStart),a=n.map(c=>c.alignmentStart+c.readLength-1),s=Math.max(...a)-Math.min(...i)+1;s>=0&&n.forEach(c=>{if(c.templateLength!==void 0)throw new M("mate pair group has some members that have template lengths already, this file seems malformed");c.templateLength=s})}function uA(t,e){const r=Math.min(t.alignmentStart,e.alignmentStart),o=Math.max(t.alignmentStart+t.readLength-1,e.alignmentStart+e.readLength-1)-r+1;t.templateLength=o,e.templateLength=o}function dA(t,e,r,o){const n=!!(o.mate||o.mateRecordNumber!==void 0&&o.mateRecordNumber!==e);r.readName||(r.readName=String(r.uniqueId),o.readName=r.readName),r.mate={sequenceId:o.sequenceId,alignmentStart:o.alignmentStart,uniqueId:o.uniqueId},o.readName&&(r.mate.readName=o.readName),!o.mate&&o.mateRecordNumber===void 0&&(o.mate={sequenceId:r.sequenceId,alignmentStart:r.alignmentStart,uniqueId:r.uniqueId},r.readName&&(o.mate.readName=r.readName)),r.flags|=L.BAM_FPAIRED,o.flags&L.BAM_FUNMAP&&(r.flags|=L.BAM_FMUNMAP),r.flags&L.BAM_FUNMAP&&(o.flags|=L.BAM_FMUNMAP),o.flags&L.BAM_FREVERSE&&(r.flags|=L.BAM_FMREVERSE),r.flags&L.BAM_FREVERSE&&(o.flags|=L.BAM_FMREVERSE),r.templateLength===void 0&&(n?cA(t,e,r):uA(r,o)),r.mateRecordNumber=void 0}class bi{constructor(e,r,o){this.container=e,this.containerPosition=r,this.sliceSize=o,this.file=e.file}async getHeader(){const{majorVersion:e}=await this.file.getDefinition(),r=Se(e),o=await this.container.getHeader(),n=await this.file.readBlock(o._endPosition+this.containerPosition);if(n.contentType==="MAPPED_SLICE_HEADER"){const i=De(n.content,r.cramMappedSliceHeader.parser,0,o._endPosition);return{...n,parsedContent:i}}else if(n.contentType==="UNMAPPED_SLICE_HEADER"){const i=De(n.content,r.cramUnmappedSliceHeader.parser,0,o._endPosition);return{...n,parsedContent:i}}else throw new M(`error reading slice header block, invalid content type ${n.contentType}`)}async getBlocks(){const e=await this.getHeader();let r=e._endPosition;const o=new Array(e.parsedContent.numBlocks);for(let n=0;n<o.length;n++){const i=await this.file.readBlock(r);o[n]=i,r=o[n]._endPosition}return o}async getCoreDataBlock(){return(await this.getBlocks())[0]}async _getBlocksContentIdIndex(){const e=await this.getBlocks(),r={};return e.forEach(o=>{o.contentType==="EXTERNAL_DATA"&&(r[o.contentId]=o)}),r}async getBlockByContentId(e){return(await this._getBlocksContentIdIndex())[e]}async getReferenceRegion(){const e=new TextDecoder("utf8"),r=(await this.getHeader()).parsedContent;if(!et(r))throw new Error("slice header not mapped");if(r.refSeqId<0)return;const o=await this.container.getCompressionScheme();if(o===void 0)throw new Error("compression scheme undefined");if(r.refBaseBlockId>=0){const n=await this.getBlockByContentId(r.refBaseBlockId);if(!n)throw new M("embedded reference specified, but reference block does not exist");return{seq:e.decode(n.data),start:r.refSeqStart,end:r.refSeqStart+r.refSeqSpan-1,span:r.refSeqSpan}}if(o.referenceRequired||this.file.fetchReferenceSequenceCallback){if(!this.file.fetchReferenceSequenceCallback)throw new Error("reference sequence not embedded, and seqFetch callback not provided, cannot fetch reference sequence");const n=await this.file.fetchReferenceSequenceCallback(r.refSeqId,r.refSeqStart,r.refSeqStart+r.refSeqSpan-1);if(n.length!==r.refSeqSpan)throw new Bs("seqFetch callback returned a reference sequence of the wrong length");return{seq:n,start:r.refSeqStart,end:r.refSeqStart+r.refSeqSpan-1,span:r.refSeqSpan}}}getAllRecords(){return this.getRecords(()=>!0)}async _fetchRecords(){var e,r;const{majorVersion:o}=await this.file.getDefinition(),n=await this.container.getCompressionScheme();if(n===void 0)throw new Error("compression scheme undefined");const i=await this.getHeader(),a=await this._getBlocksContentIdIndex();if(o>1&&this.file.options.checkSequenceMD5&&et(i.parsedContent)&&i.parsedContent.refSeqId>=0&&((e=i.parsedContent.md5)==null?void 0:e.join(""))!=="0000000000000000"){const d=await this.getReferenceRegion();if(d){const{seq:u,start:g,end:I}=d,m=Ka(u),f=(r=i.parsedContent.md5)==null?void 0:r.map(h=>(h<16?"0":"")+h.toString(16)).join("");if(m!==f)throw new M(`MD5 checksum reference mismatch for ref ${i.parsedContent.refSeqId} pos ${g}..${I}. recorded MD5: ${f}, calculated MD5: ${m}`)}}const s=await this.getCoreDataBlock(),c={lastAlignmentStart:et(i.parsedContent)?i.parsedContent.refSeqStart:0,coreBlock:{bitPosition:7,bytePosition:0},externalBlocks:{map:new Map,getCursor(d){let u=this.map.get(d);return u===void 0&&(u={bitPosition:7,bytePosition:0},this.map.set(d,u)),u}}},l=d=>{const u=n.getCodecForDataSeries(d);if(!u)throw new M(`no codec defined for ${d} data series`);return u.decode(this,s,a,c)},A=new Array(i.parsedContent.numRecords);for(let d=0;d<A.length;d+=1)try{const u=lA(this,l,n,i,s,a,c,o,d);A[d]=new ji({...u,uniqueId:i.contentPosition+i.parsedContent.recordCounter+d+1})}catch(u){if(u instanceof Wt){console.warn("read attempted beyond end of buffer, file seems truncated.");break}else throw u}for(let d=0;d<A.length;d+=1){const u=A[d];if(u){const{mateRecordNumber:g}=u;g!==void 0&&g>=0&&A[g]&&dA(A,d,u,A[g])}}return A}async getRecords(e){const r=this.container.filePosition+this.containerPosition;let o=this.file.featureCache.get(r.toString());o||(o=this._fetchRecords(),this.file.featureCache.set(r.toString(),o));const n=(await o).filter(e);if(n.length&&this.file.fetchReferenceSequenceCallback){const i=await this.getHeader();if(et(i.parsedContent)&&(i.parsedContent.refSeqId>=0||i.parsedContent.refSeqId===-2)){const a=i.parsedContent.refSeqId>=0?i.parsedContent.refSeqId:void 0,s=await this.container.getCompressionScheme();if(s===void 0)throw new Error("compression scheme undefined");const c={};for(const l of n){const A=a!==void 0?a:l.sequenceId;let d=c[A];d||(d={id:A,start:l.alignmentStart,end:Number.NEGATIVE_INFINITY,seq:null},c[A]=d);const u=l.alignmentStart+(l.lengthOnRef||l.readLength)-1;u>d.end&&(d.end=u),l.alignmentStart<d.start&&(d.start=l.alignmentStart)}await Promise.all(Object.values(c).map(async l=>{l.id!==-1&&l.start<=l.end&&this.file.fetchReferenceSequenceCallback&&(l.seq=await this.file.fetchReferenceSequenceCallback(l.id,l.start,l.end))}));for(const l of n){const A=a!==void 0?a:l.sequenceId,d=c[A];if(d!=null&&d.seq){const u=d.seq;l.addReferenceSequence({...d,seq:u},s)}}}}return n}}"getHeader getBlocks _getBlocksContentIdIndex".split(" ").forEach(t=>{Kt(bi,t)});class Pe{constructor(e,r){this.parameters=e,this.dataType=r}}class gA extends Pe{constructor(e,r){if(super(e,r),this.dataType!=="int")throw new Ce(`${this.dataType} decoding not yet implemented by BETA codec`)}decode(e,r,o,n){return ve(r.content,n.coreBlock,this.parameters.length)-this.parameters.offset}}let wi=class extends Pe{constructor(t,e,r){super(t,e),this.instantiateCodec=r}decode(t,e,r,o){const n=this._getLengthCodec().decode(t,e,r,o)||0,i=this._getDataCodec(),a=new Uint8Array(n);for(let s=0;s<n;s+=1)a[s]=i.decode(t,e,r,o)||0;return a}_getLengthCodec(){const t=this.parameters.lengthsEncoding;return this.instantiateCodec(t,"int")}_getDataCodec(){const t=this.parameters.valuesEncoding;return this.instantiateCodec(t,"byte")}};"_getLengthCodec _getDataCodec".split(" ").forEach(t=>{Kt(wi,t)});class fA extends Pe{decode(e,r,o,n){const{blockContentId:i}=this.parameters,a=o[i];if(!a)throw new M(`no block found with content ID ${i}`);const s=n.externalBlocks.getCursor(i);return this._decodeByteArray(a,s)}_decodeByteArray(e,r){const o=e.content,{stopByte:n}=this.parameters,i=r.bytePosition;let a=r.bytePosition;for(;o[a]!==n&&a<o.length;){if(a===o.length)throw new Wt("byteArrayStop reading beyond length of data buffer?");a=a+1}return r.bytePosition=a+1,o.subarray(i,a)}}class hA extends Pe{constructor(e,r){if(super(e,r),this.dataType==="int")this._decodeData=this._decodeInt;else if(this.dataType==="byte")this._decodeData=this._decodeByte;else throw new Ce(`${this.dataType} decoding not yet implemented by EXTERNAL codec`)}decode(e,r,o,n){const{blockContentId:i}=this.parameters,a=o[i];return a?this._decodeData(a,n.externalBlocks.getCursor(i)):void 0}_decodeInt(e,r){const[o,n]=S(e.content,r.bytePosition);return r.bytePosition=r.bytePosition+n,o}_decodeByte(e,r){if(r.bytePosition>=e.content.length)throw new Wt("attempted to read beyond end of block. this file seems truncated.");return e.content[r.bytePosition++]}}class CA extends Pe{constructor(e,r){if(super(e,r),this.dataType!=="int")throw new Ce(`${this.dataType} decoding not yet implemented by GAMMA codec`)}decode(e,r,o,n){let i=1;for(;ve(r.content,n.coreBlock,1)===0;)i=i+1;return(ve(r.content,n.coreBlock,i-1)|1<<i-1)-this.parameters.offset}}function IA(t){let e=t-(t>>1)&1431655765;return e=(e&858993459)+(e>>2&858993459),(e+(e>>4)&252645135)*16843009>>24}class mA extends Pe{constructor(e,r){if(super(e,r),this.codes={},this.codeBook={},this.sortedCodes=[],this.sortedValuesByBitCode=[],this.sortedBitCodes=[],this.sortedBitLengthsByBitCode=[],this.bitCodeToValue=[],!["byte","int"].includes(this.dataType))throw new TypeError(`${this.dataType} decoding not yet implemented by HUFFMAN_INT codec`);this.buildCodeBook(),this.buildCodes(),this.buildCaches(),this.sortedCodes[0].bitLength===0&&(this._decode=this._decodeZeroLengthCode)}buildCodeBook(){let e=new Array(this.parameters.numCodes);for(let r=0;r<this.parameters.numCodes;r++)e[r]={symbol:this.parameters.symbols[r],bitLength:this.parameters.bitLengths[r]};e=e.sort((r,o)=>r.bitLength-o.bitLength||r.symbol-o.symbol),this.codeBook={},e.forEach(r=>{this.codeBook[r.bitLength]||(this.codeBook[r.bitLength]=[]),this.codeBook[r.bitLength].push(r.symbol)})}buildCodes(){this.codes={};let e=0,r=-1;Object.entries(this.codeBook).forEach(([o,n])=>{const i=Number.parseInt(o,10);n.forEach(a=>{const s={bitLength:i,value:a,bitCode:0};r=r+1;const c=i-e;if(r=r<<c,s.bitCode=r,e=e+c,IA(r)>i)throw new M("Symbol out of range");this.codes[a]=s})})}buildCaches(){this.sortedCodes=Object.values(this.codes).sort((r,o)=>r.bitLength-o.bitLength||r.bitCode-o.bitCode),this.sortedValuesByBitCode=this.sortedCodes.map(r=>r.value),this.sortedBitCodes=this.sortedCodes.map(r=>r.bitCode),this.sortedBitLengthsByBitCode=this.sortedCodes.map(r=>r.bitLength);const e=Math.max(...this.sortedBitCodes);this.bitCodeToValue=new Array(e+1).fill(-1);for(let r=0;r<this.sortedBitCodes.length;r+=1)this.bitCodeToValue[this.sortedCodes[r].bitCode]=r}decode(e,r,o,n){return this._decode(e,r,n.coreBlock)}_decodeZeroLengthCode(){return this.sortedCodes[0].value}_decode(e,r,o){const n=r.content;let i=0,a=0;for(let s=0;s<this.sortedCodes.length;s+=1){const c=this.sortedCodes[s].bitLength;a<<=c-i,a|=ve(n,o,c-i),i=c;{const l=this.bitCodeToValue[a];if(l>-1&&this.sortedBitLengthsByBitCode[l]===c)return this.sortedValuesByBitCode[l];for(let A=s;this.sortedCodes[A+1].bitLength===c&&A<this.sortedCodes.length;A+=1)s+=1}}throw new M("Huffman symbol not found.")}}class pA extends Pe{constructor(e,r){if(super(e,r),this.dataType!=="int")throw new Ce(`${this.dataType} decoding not yet implemented by SUBEXP codec`)}decode(e,r,o,n){let i=0;for(;ve(r.content,n.coreBlock,1);)i=i+1;let a,s;if(i===0)a=this.parameters.K,s=ve(r.content,n.coreBlock,a);else{a=i+this.parameters.K-1;const c=ve(r.content,n.coreBlock,a);s=1<<a|c}return s-this.parameters.offset}}const yA={1:hA,3:mA,4:wi,5:fA,6:gA,7:pA,9:CA};function bA(t){return yA[t]}function Er(t,e){const r=bA(e==="ignore"?0:t.codecId);if(!r)throw new Ce(`no codec implemented for codec ID ${t.codecId}`);return new r(t.parameters,e,Er)}const wA={BF:"int",CF:"int",RI:"int",RL:"int",AP:"int",RG:"int",MF:"int",NS:"int",NP:"int",TS:"int",NF:"int",TC:"byte",TN:"int",FN:"int",FC:"byte",FP:"int",BS:"byte",IN:"byteArray",SC:"byteArray",DL:"int",BA:"byte",BB:"byteArray",RS:"int",PD:"int",HC:"int",MQ:"int",RN:"byteArray",QS:"byte",QQ:"byteArray",TL:"int"};function BA(t){const e=new Array(5);for(let r=0;r<5;r+=1)e[r]=new Array(4);return e[0][t[0]>>6&3]="C",e[0][t[0]>>4&3]="G",e[0][t[0]>>2&3]="T",e[0][t[0]>>0&3]="N",e[1][t[1]>>6&3]="A",e[1][t[1]>>4&3]="G",e[1][t[1]>>2&3]="T",e[1][t[1]>>0&3]="N",e[2][t[2]>>6&3]="A",e[2][t[2]>>4&3]="C",e[2][t[2]>>2&3]="T",e[2][t[2]>>0&3]="N",e[3][t[3]>>6&3]="A",e[3][t[3]>>4&3]="C",e[3][t[3]>>2&3]="G",e[3][t[3]>>0&3]="N",e[4][t[4]>>6&3]="A",e[4][t[4]>>4&3]="C",e[4][t[4]>>2&3]="G",e[4][t[4]>>0&3]="T",e}class EA{constructor(e){this.dataSeriesCodecCache={},this.tagCodecCache={},this.tagEncoding={},this.readNamesIncluded=e.preservation.RN,this.APdelta=e.preservation.AP,this.referenceRequired=!!e.preservation.RR,this.tagIdsDictionary=e.preservation.TD,this.substitutionMatrix=BA(e.preservation.SM),this.dataSeriesEncoding=e.dataSeriesEncoding,this.tagEncoding=e.tagEncoding}getCodecForTag(e){const r=this.tagCodecCache[e];if(r)return r;{const o=this.tagEncoding[e];if(!o)throw new Error("Error, no tag encoding");const n=Er(o,"byteArray");return this.tagCodecCache[e]=n,n}}getTagNames(e){return this.tagIdsDictionary[e]}getCodecForDataSeries(e){let r=this.dataSeriesCodecCache[e];if(r===void 0){const o=this.dataSeriesEncoding[e];if(o){const n=wA[e];if(!n)throw new M(`data series name ${e} not defined in file compression header`);r=Er(o,n),this.dataSeriesCodecCache[e]=r}}return r}toJSON(){const e={};return Object.keys(this).forEach(r=>{r.endsWith("Cache")||(e[r]=this[r])}),e}}class Bi{constructor(e,r){this.file=e,this.filePosition=r}getHeader(){return this._readContainerHeader(this.filePosition)}async getCompressionHeaderBlock(){if(!(await this.getHeader()).numRecords)return null;const{majorVersion:e}=await this.file.getDefinition(),r=Se(e),o=await this.getFirstBlock();if(o.contentType!=="COMPRESSION_HEADER")throw new M(`invalid content type ${o.contentType} in compression header block`);const n=De(o.content,r.cramCompressionHeader.parser,0,o.contentPosition);return{...o,parsedContent:n}}async getFirstBlock(){const e=await this.getHeader();return this.file.readBlock(e._endPosition)}async getCompressionScheme(){const e=await this.getCompressionHeaderBlock();if(e)return new EA(e.parsedContent)}getSlice(e,r){return new bi(this,e,r)}async _readContainerHeader(e){const{majorVersion:r}=await this.file.getDefinition(),o=Se(r),{cramContainerHeader1:n,cramContainerHeader2:i}=o,a=await this.file.read(n.maxLength,e),s=De(a,n.parser),c=Wa(s.numLandmarks),l=await this.file.read(i.maxLength(s.numLandmarks),e+s._size-c),A=De(l,i.parser);return this.file.validateChecksums&&A.crc32!==void 0&&await this.file.checkCrc32(e,s._size+A._size-c-4,A.crc32,`container header beginning at position ${e}`),{...s,...A,_size:s._size+A._size-c,_endPosition:s._size+A._size-c+e}}}"getHeader getCompressionHeaderBlock getCompressionScheme".split(" ").forEach(t=>{Kt(Bi,t)});function _A(t){return new ReadableStream({start(e){e.enqueue(t),e.close()}})}function QA(){const t=new Uint32Array([287454020]),e=new Uint8Array(t.buffer);return e[0]===68?0:e[0]===17?1:2}class _r{constructor(e){if(this.file=gi(e.url,e.path,e.filehandle),this.validateChecksums=!0,this.fetchReferenceSequenceCallback=e.seqFetch,this.options={checkSequenceMD5:e.checkSequenceMD5,cacheSize:e.cacheSize??2e4},this.featureCache=new _i({maxSize:this.options.cacheSize}),QA()>0)throw new Error("Detected big-endian machine, may be unable to run")}read(e,r){return this.file.read(e,r)}async getDefinition(){const{maxLength:e,parser:r}=mi(),o=await this.file.read(e,0),n=r(o).value;if(n.magic!=="CRAM")throw new Error("Not a CRAM file, does not match magic string");if(n.majorVersion!==2&&n.majorVersion!==3)throw new Ce(`CRAM version ${n.majorVersion} not supported`);return n}async getSamHeader(){const e=await this.getContainerById(0);if(!e)throw new M("file contains no containers");const r=(await e.getFirstBlock()).content,o=new DataView(r.buffer).getInt32(0,!0),n=4,i=new TextDecoder("utf8").decode(r.subarray(n,n+o));return this.header=i,Oa(i)}async getHeaderText(){return await this.getSamHeader(),this.header}async getContainerById(e){const{majorVersion:r}=await this.getDefinition();let o=Se(r).cramFileDefinition.maxLength,n;for(let i=0;i<=e;i++){n=this.getContainerAtPosition(o);const a=await n.getHeader();if(i===0){o=a._endPosition;for(let s=0;s<a.numBlocks;s++)o=(await this.readBlock(o))._endPosition}else o+=a._size+a.length}return n}async checkCrc32(e,r,o,n){const i=await this.file.read(r,e),a=Ei(i)>>>0;if(a!==o)throw new M(`crc mismatch in ${n}: recorded CRC32 = ${o}, but calculated CRC32 = ${a}`)}async containerCount(){const{majorVersion:e}=await this.getDefinition(),r=Se(e);let o=0,n=r.cramFileDefinition.maxLength;try{for(;;){const i=await this.getContainerAtPosition(n).getHeader();if(o===0){n=i._endPosition;for(let a=0;a<i.numBlocks;a++)n=(await this.readBlock(n))._endPosition}else n+=i._size+i.length;o+=1}}catch{o--}return o}getContainerAtPosition(e){return new Bi(this,e)}async readBlockHeader(e){const{majorVersion:r}=await this.getDefinition(),o=Se(r),{cramBlockHeader:n}=o,i=await this.file.read(n.maxLength,e);return De(i,n.parser,0,e)}async _parseSection(e,r,o=e.maxLength,n){const i=n??await this.file.read(o,r),a=De(i,e.parser,0,r);if(a._size!==o)throw new M(`section read error: requested size ${o} does not equal parsed size ${a._size}`);return a}async _uncompressPre(e,r,o){if(e==="gzip")return Ii(r);if(e==="bzip2")return ni(r);if(e==="lzma"){const n=new Response(new ws.XzReadableStream(_A(r)));return new Uint8Array(await n.arrayBuffer())}else if(e==="rans"){const n=new Uint8Array(o);return La(r,n),n}else{if(e==="rans4x16")return pa(r);if(e==="arith")return ya(r);if(e==="fqzcomp")return ba(r);if(e==="tok3")return wa(r);throw new Ce(`${e} decompression not yet implemented`)}}async _uncompress(e,r,o){const n=await this._uncompressPre(e,r,o);if(n.length!==o){const i=new Uint8Array(o);return i.set(n,0),i}return n}async readBlock(e){const{majorVersion:r}=await this.getDefinition(),o=Se(r),n=await this.readBlockHeader(e),i=n._endPosition,a=await this.file.read(n.compressedSize,i),s=n.compressionMethod!=="raw"?await this._uncompress(n.compressionMethod,a,n.uncompressedSize):a,c={...n,_endPosition:i,contentPosition:i,content:s};if(r>=3){const l=await this._parseSection(o.cramBlockCrc32,i+n.compressedSize);c.crc32=l.crc32,this.validateChecksums&&await this.checkCrc32(e,n._size+n.compressedSize,l.crc32,"block data"),c._endPosition=l._endPosition,c._size=c.compressedSize+o.cramBlockCrc32.maxLength}else c._endPosition=i+c.compressedSize,c._size=c.compressedSize;return c}}"getDefinition getSectionParsers getSamHeader".split(" ").forEach(t=>{Kt(_r,t)});const SA=21578050;function $o(t,e){const[r,o,n,i,a,s]=e,c=r;t[c]||(t[c]=[]),t[c].push({start:o,span:n,containerStart:i,sliceStart:a,sliceBytes:s})}function RA(t){return t[0]===31&&t[1]===139?Ii(t):t}class vA{constructor(e){this.filehandle=gi(e.url,e.path,e.filehandle)}async parseIndex(){const e={},r=RA(await this.filehandle.readFile()),o=new DataView(r.buffer);if(r.length>4&&o.getUint32(0,!0)===SA)throw new M("invalid .crai index file. note: file appears to be a .bai index. this is technically legal but please open a github issue if you need support");let n=[],i="";for(const a of r)if(a>=48&&a<=57||!i&&a===45)i+=String.fromCharCode(a);else if(a===9)n.push(Number.parseInt(i,10)),i="";else if(a===10)n.push(Number.parseInt(i,10)),i="",$o(e,n),n=[];else if(a!==13&&a!==32)throw new M("invalid .crai index file");return i&&n.push(Number.parseInt(i,10)),n.length===6&&$o(e,n),Object.entries(e).forEach(([a,s])=>{const c=s;e[a]=c.sort((l,A)=>l.start-A.start||l.span-A.span)}),e}getIndex(){return this.parseIndexP||(this.parseIndexP=this.parseIndex().catch(e=>{throw this.parseIndexP=void 0,e})),this.parseIndexP}async hasDataForReferenceSequence(e){return!!(await this.getIndex())[e]}async getEntriesForRange(e,r,o){const n=(await this.getIndex())[e];if(!n)return[];const i=s=>{const c=s.start,l=s.start+s.span;return c>o?-1:l<=r?1:0},a=[];for(const s of n)i(s)===0&&a.push(s);return a}}class DA{constructor(e){if(this.cram=e.cram??new _r({url:e.cramUrl,path:e.cramPath,filehandle:e.cramFilehandle,seqFetch:e.seqFetch,checkSequenceMD5:e.checkSequenceMD5,cacheSize:e.cacheSize}),!(this.cram instanceof _r))throw new Error("invalid arguments: no cramfile");this.index=e.index}async getRecordsForRange(e,r,o,n={}){if(n.viewAsPairs=n.viewAsPairs||!1,n.pairAcrossChr=n.pairAcrossChr||!1,n.maxInsertSize=n.maxInsertSize||2e5,typeof e=="string")throw new Ce("string sequence names not yet supported");const i=e,a=await this.index.getEntriesForRange(i,r,o),s=await Promise.all(a.map(l=>this.getRecordsInSlice(l,A=>A.sequenceId===e&&A.alignmentStart<=o&&A.lengthOnRef!==void 0&&A.alignmentStart+A.lengthOnRef-1>=r)));let c=Array.prototype.concat(...s);if(n.viewAsPairs){const l={},A={};for(const h of c){const C=h.readName;if(C===void 0)throw new Error("readName undefined");const y=h.uniqueId;l[C]||(l[C]=0),l[C]+=1,A[y]=1}const d={};Object.entries(l).forEach(([h,C])=>{C===1&&(d[h]=!0)});const u=[];for(const h of c){const C=h.readName;if(C===void 0)throw new Error("readName undefined");if(d[C]&&h.mate&&(h.mate.sequenceId===i||n.pairAcrossChr)&&Math.abs(h.alignmentStart-h.mate.alignmentStart)<n.maxInsertSize){const y=this.index.getEntriesForRange(h.mate.sequenceId,h.mate.alignmentStart,h.mate.alignmentStart+1);u.push(y)}}const g=await Promise.all(u);let I=[];for(const h of g)I.push(...h);I=I.sort((h,C)=>h.toString().localeCompare(C.toString())).filter((h,C,y)=>!C||h.toString()!==y[C-1].toString());const m=[];for(const h of I){let C=this.cram.featureCache.get(h.toString());C||(C=this.getRecordsInSlice(h,()=>!0),this.cram.featureCache.set(h.toString(),C));const y=C.then(B=>{const p=[];for(const v of B){if(v.readName===void 0)throw new Error("readName undefined");d[v.readName]&&!A[v.uniqueId]&&p.push(v)}return p});m.push(y)}const f=await Promise.all(m);if(f.length){const h=f.reduce((C,y)=>C.concat(y));c=c.concat(h)}}return c}getRecordsInSlice({containerStart:e,sliceStart:r,sliceBytes:o},n){return this.cram.getContainerAtPosition(e).getSlice(r,o).getRecords(n)}hasDataForReferenceSequence(e){return this.index.hasDataForReferenceSequence(e)}}function kA(t,e,r){if(!t)return[];const o=new Array(t.length);let n=0,i=0,a=0,s=0,c=e;for(const{refPos:l,code:A,pos:d,data:u,sub:g,ref:I}of t)if(s=a-c,c=a,s&&i>0&&(o[n++]={start:a,type:"insertion",base:`${i}`,length:0},i=0),a=l-1-e,A==="X")o[n++]={start:a,length:1,base:g,qual:r==null?void 0:r[d-1],altbase:I==null?void 0:I.toUpperCase(),type:"mismatch"};else if(A==="I")o[n++]={start:a,type:"insertion",base:`${u.length}`,length:0};else if(A==="N")o[n++]={type:"skip",length:u,start:a,base:"N"};else if(A==="S"){const m=u.length;o[n++]={start:a,type:"softclip",base:`S${m}`,cliplen:m,length:1}}else if(A!=="P")if(A==="H"){const m=u;o[n++]={start:a,type:"hardclip",base:`H${m}`,cliplen:m,length:1}}else A==="D"?o[n++]={type:"deletion",length:u,start:a,base:"*"}:A==="b"||A==="q"||A==="B"||A==="i"&&i++;return s&&i>0&&(o[n++]={start:a,type:"insertion",base:`${i}`,length:0},i=0),o.slice(0,n)}function qA(t,e,r,o){let n="",i="",a="M",s=0;if(!o)return"";const c=o.seq,l=o.start;let A=e,d=0,u=0;if(t!==void 0)for(const{code:g,refPos:I,sub:m,data:f}of t)if(d=I-A,n+=c.slice(A-l,I-l),A=I,u>0&&d&&(i+=`${u}I`,u=0),s&&a!=="M"&&(i+=`${s}${a}`,s=0),d&&(a="M",s+=d),g==="b"){const h=f.split(","),C=String.fromCharCode(...h);n+=C,A+=C.length,s+=C.length}else g==="B"||g==="X"?(n+=m,A++,s++):g==="D"||g==="N"?(A+=f,s&&(i+=`${s}${a}`),i+=f+g,s=0):g==="I"||g==="S"?(n+=f,s&&(i+=`${s}${a}`),i+=f.length+g,s=0):g==="i"?(s&&(i+=`${s}${a}`),u++,n+=f,s=0):g==="P"?(s&&(i+=`${s}${a}`),i+=`${f}P`):g==="H"&&(s&&(i+=`${s}${a}`),i+=`${f}H`,s=0);else d=r-n.length;return n.length!==r&&(d=r-n.length,n+=c.slice(A-l,A-l+d),s&&a!=="M"&&(i+=`${s}${a}`,s=0),a="M",s+=d),d&&u>0&&(i+=`${u}I`),s&&(i+=`${s}${a}`),i}class $t{constructor(e,r){this.record=e,this._store=r}get name(){return this.record.readName}get start(){return this.record.alignmentStart-1}get end(){var e;return this.start+((e=this.record.lengthOnRef)!==null&&e!==void 0?e:1)}get score(){return this.record.mappingQuality}get flags(){return this.record.flags}get strand(){return this.record.isReverseComplemented()?-1:1}get qual(){return(this.record.qualityScores||[]).join(" ")}get qualRaw(){return this.record.qualityScores}get refName(){return this._store.refIdToName(this.record.sequenceId)}get pair_orientation(){return this.record.isPaired()?this.record.getPairOrientation():void 0}get template_length(){return this.record.templateLength||this.record.templateSize}get next_ref(){return this.record.mate?this._store.refIdToName(this.record.mate.sequenceId):void 0}get next_segment_position(){return this.record.mate?`${this._store.refIdToName(this.record.mate.sequenceId)}:${this.record.mate.alignmentStart}`:void 0}get is_paired(){return!!this.record.mate}get next_pos(){var e;return(e=this.record.mate)===null||e===void 0?void 0:e.alignmentStart}get tags(){var e;const r=(e=this._store.samHeader.readGroups)===null||e===void 0?void 0:e[this.record.readGroupId];return r!==void 0?{...this.record.tags,RG:r}:this.record.tags}get seq(){return this.record.getReadBases()}get CIGAR(){return qA(this.record.readFeatures,this.record.alignmentStart,this.record.readLength,this.record._refRegion)}id(){return`${this._store.id}-${this.record.uniqueId}`}get(e){return e==="mismatches"?this.mismatches:e==="qual"?this.qual:e==="CIGAR"?this.CIGAR:this.fields[e]}parent(){}children(){}get mismatches(){return kA(this.record.readFeatures,this.start,this.qualRaw)}get fields(){return{start:this.start,name:this.name,end:this.end,score:this.score,strand:this.strand,template_length:this.template_length,flags:this.flags,tags:this.tags,refName:this.refName,seq:this.seq,type:"match",pair_orientation:this.pair_orientation,next_ref:this.next_ref,next_pos:this.next_pos,next_segment_position:this.next_segment_position,uniqueId:this.id()}}toJSON(){return{...this.fields,CIGAR:this.CIGAR,qual:this.qual}}}Qr($t,"fields");Qr($t,"CIGAR");Qr($t,"mismatches");class YA extends ki.BaseFeatureDataAdapter{constructor(){super(...arguments),this.samHeader={},this.ultraLongFeatureCache=new Mi({maxSize:500}),this.seqIdToOriginalRefName=[]}async configurePre(){const e=this.getConf("cramLocation"),r=this.getConf("craiLocation"),o=this.pluginManager,n=new DA({cramFilehandle:Xr.openLocation(e,o),index:new vA({filehandle:Xr.openLocation(r,o)}),seqFetch:(...s)=>this.seqFetch(...s),checkSequenceMD5:!1});if(!this.getSubAdapter)throw new Error("Error getting subadapter");const i=this.getConf("sequenceAdapter");if(!i)throw new Error("no sequenceAdapter supplied to CramAdapter config");const a=await this.getSubAdapter(i);return{cram:n,sequenceAdapter:a.dataAdapter}}async configure(){return this.configureP||(this.configureP=this.configurePre().catch(e=>{throw this.configureP=void 0,e})),this.configureP}async getHeader(e){const{cram:r}=await this.configure();return r.cram.getHeaderText()}async seqFetch(e,r,o){r-=1;const{sequenceAdapter:n}=await this.configure(),i=this.refIdToOriginalName(e)||this.refIdToName(e);if(!i)throw new Error("unknown");const a=(await qi(n.getFeatures({refName:i,start:r,end:o,assemblyName:""}).pipe(Ni()))).sort((c,l)=>c.get("start")-l.get("start")).map(c=>{const l=c.get("start"),A=c.get("end"),d=Math.max(r-l,0),u=Math.min(o-l,A-l)-d;return(c.get("seq")||c.get("residues")).slice(d,d+u)}).join(""),s=o-r;if(a.length!==s)throw new Error(`fetching ${i}:${ye.toLocale(r-1)}-${ye.toLocale(o)} returned ${ye.toLocale(a.length)} bases, should have returned ${ye.toLocale(s)}`);return a}async setupPre(e){const r=await this.configure(),{cram:o}=r,n=await o.cram.getSamHeader(),i=[],a={};for(const[l,A]of n.filter(d=>d.tag==="SQ").entries()){const d=A.data.find(u=>u.tag==="SN");if(d){const u=d.value;a[u]=l,i[l]=u}}const s=n.filter(l=>l.tag==="RG").map(l=>{var A;return(A=l.data.find(d=>d.tag==="ID"))===null||A===void 0?void 0:A.value}),c={idToName:i,nameToId:a,readGroups:s};return this.samHeader=c,{samHeader:c,...r}}async setupPre2(e){return this.setupP||(this.setupP=this.setupPre(e).catch(r=>{throw this.setupP=void 0,r})),this.setupP}async setup(e){const{statusCallback:r=()=>{}}=e||{};return ye.updateStatus("Downloading index",r,()=>this.setupPre2(e))}async getRefNames(e){const{samHeader:r}=await this.setup(e);if(!r.idToName)throw new Error("CRAM file has no header lines");return r.idToName}refNameToId(e){if(this.samHeader.nameToId)return this.samHeader.nameToId[e];if(this.seqIdToRefName)return this.seqIdToRefName.indexOf(e)}refIdToName(e){var r,o;return((r=this.samHeader.idToName)===null||r===void 0?void 0:r[e])||((o=this.seqIdToRefName)===null||o===void 0?void 0:o[e])}refIdToOriginalName(e){return this.seqIdToOriginalRefName[e]}getFeatures(e,r){const{stopToken:o,filterBy:n,statusCallback:i=()=>{}}=r||{},{refName:a,start:s,end:c,originalRefName:l}=e;return Li.ObservableCreate(async A=>{const{cram:d,samHeader:u}=await this.setup(r),g=this.refNameToId(a);if(g===void 0){console.warn("Unknown refName",a),A.complete();return}l&&(this.seqIdToOriginalRefName[g]=l);const I=await ye.updateStatus("Downloading alignments",i,()=>d.getRecordsForRange(g,s,c));Fi.checkStopToken(o),await ye.updateStatus("Processing alignments",i,()=>{var m;const{flagInclude:f=0,flagExclude:h=0,tagFilter:C,readName:y}=n||{};for(const B of I){if(Ti(B.flags,f,h)||C&&Pi(C.tag==="RG"?(m=u.readGroups)===null||m===void 0?void 0:m[B.readGroupId]:B.tags[C.tag],C.value)||y&&B.readName!==y)continue;const p=this.ultraLongFeatureCache.get(`${B.uniqueId}`);if(p)A.next(p);else{const v=this.cramRecordToFeature(B);this.ultraLongFeatureCache.set(`${B.uniqueId}`,v),A.next(v)}}A.complete()})},o)}cramRecordToFeature(e){return new $t(e,this)}async getMultiRegionFeatureDensityStats(e,r){const o=await this.bytesForRegions(e,r),n=this.getConf("fetchSizeLimit");return{bytes:o,fetchSizeLimit:n}}async bytesForRegions(e,r){const{cram:o}=await this.configure();return(await Promise.all(e.map(n=>{const{refName:i,start:a,end:s}=n,c=this.refNameToId(i);return c!==void 0?o.index.getEntriesForRange(c,a,s):[{sliceBytes:0}]}))).flat().reduce((n,i)=>n+i.sliceBytes,0)}}export{YA as default};
