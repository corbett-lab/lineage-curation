import{u as R,l as E,q as X}from"./JBrowsePanel-CjeUdi3D-Dhrr89W5.js";import{p as G,u as H,d as J}from"./color-DgYUvRvM-B_LK-3Mw.js";import"./index-Bwk-R6QR.js";import"./taxonium-component.es-D8UFPkMd.js";function i(n){return Math.random()*2*n-n}function A(n,t,C,g){n.strokeStyle=g,n.beginPath(),n.moveTo(t,0),n.lineTo(t,C),n.stroke()}function tt(n,t,C,g){const{chainData:P,colorBy:$,drawInter:_,drawLongRange:I,lineWidthSetting:V,jitterVal:a}=n;if(!P)return;const m=R.getContainingView(n),{assemblyManager:W}=R.getSession(n),{chains:j,stats:w}=P,p=E(P),y=W.get(m.assemblyNames[0]),l=($==null?void 0:$.type)||"insertSizeAndOrientation";if(!y)return;t.lineWidth=V;function k(r,e,o,s){var f,u,b;const x=r.strand,N=e.strand,q=x===-1,O=N===-1,D=q?r.start:r.end,F=p?O?e.start:e.end:O?e.end:e.start,L=o.getCanonicalRefName(r.refName)||r.refName,Y=o.getCanonicalRefName(e.refName)||e.refName,h=(f=m.bpToPx({refName:L,coord:D}))===null||f===void 0?void 0:f.offsetPx,T=(u=m.bpToPx({refName:Y,coord:F}))===null||u===void 0?void 0:u.offsetPx;if(h!==void 0&&T!==void 0){const M=(T-h)/2,c=Math.abs(M),d=h-m.offsetPx,B=T-m.offsetPx,z=c>1e4;s&&z?(t.moveTo(d,0),t.beginPath()):(t.beginPath(),t.moveTo(d,0)),s&&z?t.strokeStyle="red":p?l==="insertSizeAndOrientation"?t.strokeStyle=G(r,e,w)[0]:l==="orientation"?t.strokeStyle=H(r)[0]:l==="insertSize"?t.strokeStyle=((b=J(r,e,w))===null||b===void 0?void 0:b[0])||"grey":l==="gradient"&&(t.strokeStyle=`hsl(${Math.log10(c)*10},50%,50%)`):l==="orientation"||l==="insertSizeAndOrientation"?x===-1&&N===1?t.strokeStyle="navy":x===1&&N===-1?t.strokeStyle="green":t.strokeStyle="grey":l==="gradient"&&(t.strokeStyle=`hsl(${Math.log10(c)*10},50%,50%)`);const S=d+M*2,v=Math.min(g+i(a),c);s?c>1e5?(A(t,d+i(a),g,"red"),A(t,B+i(a),g,"red")):z?(t.arc(d+M+i(a),0,c,0,Math.PI),t.stroke()):(t.bezierCurveTo(d+i(a),v,S,v,S+i(a),0),t.stroke()):(t.bezierCurveTo(d+i(a),v,S,v,S+i(a),0),t.stroke())}else h&&_&&A(t,h-m.offsetPx,g,"purple")}for(const r of j)if(r.length===1&&I){const e=r[0];if(p&&!(e.flags&8)){const o={refName:e.next_ref||"",start:e.next_pos||0,end:e.next_pos||0,strand:e.strand};k(e,o,y,!0)}else{const o=[e,...X(e.SA,e.id,e.strand,e.name)].sort((s,f)=>s.clipPos-f.clipPos);for(let s=0;s<o.length-1;s++){const f=o[s],u=o[s+1];k(f,u,y,!0)}}}else{const e=p?r.filter(o=>!(o.flags&2048)&&!(o.flags&8)):r.sort((o,s)=>o.clipPos-s.clipPos).filter(o=>!(o.flags&256));for(let o=0;o<e.length-1;o++)k(e[o],e[o+1],y,!1)}}export{tt as drawFeats};
