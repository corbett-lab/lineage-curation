import{a1 as G,u as Q}from"./JBrowsePanel-CjeUdi3D-Dhrr89W5.js";import{Q as M}from"./taxonium-component.es-D8UFPkMd.js";import"./index-Bwk-R6QR.js";/*!
 * isobject <https://github.com/jonschlinkert/isobject>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var T,_;function W(){return _||(_=1,T=function(e){return e!=null&&typeof e=="object"&&Array.isArray(e)===!1}),T}/*!
 * get-value <https://github.com/jonschlinkert/get-value>
 *
 * Copyright (c) 2014-2018, Jon Schlinkert.
 * Released under the MIT License.
 */var F,E;function Y(){if(E)return F;E=1;const e=W();F=function(s,f,c){if(e(c)||(c={default:c}),!n(s))return typeof c.default<"u"?c.default:s;typeof f=="number"&&(f=String(f));const d=Array.isArray(f),p=typeof f=="string",w=c.separator||".",b=c.joinChar||(typeof w=="string"?w:".");if(!p&&!d)return s;if(p&&f in s)return o(f,s,c)?s[f]:c.default;let l=d?f:r(f,w,c),i=l.length,a=0;do{let u=l[a];for(typeof u=="number"&&(u=String(u));u&&u.slice(-1)==="\\";)u=t([u.slice(0,-1),l[++a]||""],b,c);if(u in s){if(!o(u,s,c))return c.default;s=s[u]}else{let h=!1,y=a+1;for(;y<i;)if(u=t([u,l[y++]],b,c),h=u in s){if(!o(u,s,c))return c.default;s=s[u],a=y-1;break}if(!h)return c.default}}while(++a<i&&n(s));return a===i?s:c.default};function t(s,f,c){return typeof c.join=="function"?c.join(s):s[0]+f+s[1]}function r(s,f,c){return typeof c.split=="function"?c.split(s):s.split(f)}function o(s,f,c){return typeof c.isValid=="function"?c.isValid(s,f):!0}function n(s){return e(s)||Array.isArray(s)||typeof s=="function"}return F}var H=Y();const N=M(H);/*!
 * is-primitive <https://github.com/jonschlinkert/is-primitive>
 *
 * Copyright (c) 2014-present, Jon Schlinkert.
 * Released under the MIT License.
 */var R,C;function X(){return C||(C=1,R=function(e){return typeof e=="object"?e===null:typeof e!="function"}),R}/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var J,L;function Z(){if(L)return J;L=1;var e=W();function t(r){return e(r)===!0&&Object.prototype.toString.call(r)==="[object Object]"}return J=function(r){var o,n;return!(t(r)===!1||(o=r.constructor,typeof o!="function")||(n=o.prototype,t(n)===!1)||n.hasOwnProperty("isPrototypeOf")===!1)},J}/*!
 * set-value <https://github.com/jonschlinkert/set-value>
 *
 * Copyright (c) Jon Schlinkert (https://github.com/jonschlinkert).
 * Released under the MIT License.
 */var A,O;function K(){if(O)return A;O=1;const{deleteProperty:e}=Reflect,t=X(),r=Z(),o=i=>typeof i=="object"&&i!==null||typeof i=="function",n=i=>i==="__proto__"||i==="constructor"||i==="prototype",s=i=>{if(!t(i))throw new TypeError("Object keys must be strings or symbols");if(n(i))throw new Error(`Cannot set unsafe key: "${i}"`)},f=i=>Array.isArray(i)?i.flat().map(String).join(","):i,c=(i,a)=>{if(typeof i!="string"||!a)return i;let u=i+";";return a.arrays!==void 0&&(u+=`arrays=${a.arrays};`),a.separator!==void 0&&(u+=`separator=${a.separator};`),a.split!==void 0&&(u+=`split=${a.split};`),a.merge!==void 0&&(u+=`merge=${a.merge};`),a.preservePaths!==void 0&&(u+=`preservePaths=${a.preservePaths};`),u},d=(i,a,u)=>{const h=f(a?c(i,a):i);s(h);const y=l.cache.get(h)||u();return l.cache.set(h,y),y},p=(i,a={})=>{const u=a.separator||".",h=u==="/"?!1:a.preservePaths;if(typeof i=="string"&&h!==!1&&/\//.test(i))return[i];const y=[];let m="";const v=g=>{let S;g.trim()!==""&&Number.isInteger(S=Number(g))?y.push(S):y.push(g)};for(let g=0;g<i.length;g++){const S=i[g];if(S==="\\"){m+=i[++g];continue}if(S===u){v(m),m="";continue}m+=S}return m&&v(m),y},w=(i,a)=>a&&typeof a.split=="function"?a.split(i):typeof i=="symbol"?[i]:Array.isArray(i)?i:d(i,a,()=>p(i,a)),b=(i,a,u,h)=>{if(s(a),u===void 0)e(i,a);else if(h&&h.merge){const y=h.merge==="function"?h.merge:Object.assign;y&&r(i[a])&&r(u)?i[a]=y(i[a],u):i[a]=u}else i[a]=u;return i},l=(i,a,u,h)=>{if(!a||!o(i))return i;const y=w(a,h);let m=i;for(let v=0;v<y.length;v++){const g=y[v],S=y[v+1];if(s(g),S===void 0){b(m,g,u,h);break}if(typeof S=="number"&&!Array.isArray(m[g])){m=m[g]=[];continue}o(m[g])||(m[g]={}),m=m[g]}return i};return l.split=w,l.cache=new Map,l.clear=()=>{l.cache=new Map},A=l,A}var ee=K();const re=M(ee);function P(e){return(e==null?void 0:e.label)&&typeof e.label=="string"}function te(e){return(e==null?void 0:e.url)&&typeof e.url=="string"}function x(e,t){for(const r of Object.keys(t))r in e&&typeof t[r]=="object"&&typeof e[r]=="object"?x(e[r],t[r]):(e[r]===void 0||t[r]!==void 0)&&(e[r]=t[r]);return e}function oe(e,t){return e.replaceAll(/{([\s\w.]+)}/g,(r,o)=>{o=o.replaceAll(/\s+/g,"");const n=N(t,o);if(n!==void 0)return typeof n=="function"?n(o):n;if(t.callback){const s=t.callback.call(this,o);if(s!==void 0)return s}return r})}function se(e,t){if(typeof e=="string"){let r;try{r=JSON.parse(e)}catch(o){throw new Error(`${o} when parsing configuration.`)}return $(r,t)}return $(e,t)}function ne(e,t){let r;try{r=ae(e,t)}catch(o){throw new Error(`${o} when parsing configuration.`)}return $(r,t)}function ie(e){return e==="include"}function ae(e,t){let r=[],o,n,s;const f={tracks:{}};let c;function d(){if(s!==void 0){let p;try{const w=/^json:(.+)/i.exec(s);if(w?p=JSON.parse(w[1]):/^[+-]?[\d.,]+([eE][-+]?\d+)?$/.test(s)?p=Number.parseFloat(s.replaceAll(",","")):p=s,!o)throw new Error(`Error parsing in section ${r.join(" - ")}`);const b=[...r,...o].join(".");if(n==="+="){let l=N(f,b);l?Array.isArray(l)||(l=[l]):l=[],l.push(p),p=l}p==="true"&&(p=!0),p==="false"&&(p=!1),re(f,b,p)}catch{throw new Error(`syntax error${t?` in ${t}`:""}${c?` at line ${c-1}`:""}`)}}}for(const[p,w]of e.split(/\n|\r\n|\r/).entries()){c=p+1;const b=w.replace(/^\s*#.+/,"");let l;if(l=/^\s*\[([^\]]+)/.exec(b))d(),o=void 0,s=void 0,r=l[1].trim().split(/\s*\.\s*/),r.length===1&&r[0].toLowerCase()==="general"&&(r=[]);else if(l=b.match(s===void 0?/^([^+=]+)(\+?=)(.*)/:/^(\S[^+=]+)(\+?=)(.*)/))d(),o=l[1].trim().split(/\s*\.\s*/),[,,n]=l,ie([...r,...o].join("."))&&(n="+="),s=l[3].trim();else if(o!==void 0&&(l=/^\s{0,4}\+\s*(.+)/.exec(b)))d(),n="+=",s=l[1].trim();else if(s!==void 0&&(l=/^\s+(\S.*)/.exec(b))){const i=l[1];s+=s.length?` ${i.trim()}`:i.trim()}else d(),o=void 0,s=void 0}return d(),f}function $(e,t){if(e.tracks&&!Array.isArray(e.tracks))if(P(e.tracks))e.tracks=[e.tracks];else{const o=[];for(const n of Object.keys(e.tracks)){const s=e.tracks[n];P(s)?o.push(s):o.push({label:n,...s})}e.tracks=o}const r=e.trackMetadata;if(r!=null&&r.sources){if(typeof r.sources=="string"&&(r.sources=[r.sources]),te(r.sources)&&(r.sources=[r.sources]),!Array.isArray(r.sources)){const o=[];for(const n of Object.keys(r.sources)){const s=r.sources[n];"name"in s||(s.name=n),o.push(s)}r.sources=o}r.sources=r.sources.map(o=>{if(typeof o=="string"){const n={url:o},s=/\.(\w+)$/.exec(o);return s&&(n.type=s[1].toLowerCase()),n}return o})}if(e.sourceUrl=e.sourceUrl||t,e.sourceUrl.startsWith("/")&&(e.sourceUrl=new URL(e.sourceUrl,window.location.href).href),e.baseUrl=e.baseUrl||new URL(".",e.sourceUrl).href,e.baseUrl.length&&!e.baseUrl.endsWith("/")&&(e.baseUrl+="/"),e.sourceUrl){const o=[];e.tracks&&o.push(...e.tracks),e.stores&&o.push(...Object.values(e.stores)),e.names&&o.push(e.names);for(const n of o)n.baseUrl||(n.baseUrl=e.baseUrl||"/");e.refSeqs&&typeof e.refSeqs=="string"&&(e.refSeqs=new URL(e.refSeqs,e.sourceUrl).href),e.nameUrl&&(e.nameUrl=new URL(e.nameUrl,e.sourceUrl).href)}e.stores=e.stores||{};for(let o of e.tracks||[]){if(o.config){const s=o.config;o.config=void 0,o={...s,...o}}if(o.store)continue;let n;o.type==="FeatureTrack"?n="JBrowse/View/Track/HTMLFeatures":o.type==="ImageTrack"?n="JBrowse/View/Track/FixedImage":o.type==="ImageTrack.Wiggle"?n="JBrowse/View/Track/FixedImage/Wiggle":o.type==="SequenceTrack"?n="JBrowse/View/Track/Sequence":n=z("JBrowse/View/Track",o.type),o.type=n,I(e,o),o.histograms&&(o.histograms.baseUrl||(o.histograms.baseUrl=o.baseUrl),I(e,o.histograms))}return e}function z(e,t){return t?(t.includes("/")||(t=`${e}/${t}`),t=t.replace(/^\//,""),t):""}function ce(e,t){var r,o;return e?!((r=e.type)===null||r===void 0)&&r.includes("/FixedImage")?`JBrowse/Store/TiledImage/Fixed${e.backendVersion===0?"_v0":""}`:/\.jsonz?$/i.test(t)?`JBrowse/Store/SeqFeature/NCList${e.backendVersion===0?"_v0":""}`:/\.bam$/i.test(t)?"JBrowse/Store/SeqFeature/BAM":/\.cram$/i.test(t)?"JBrowse/Store/SeqFeature/CRAM":/\.gff3?$/i.test(t)?"JBrowse/Store/SeqFeature/GFF3":/\.bed$/i.test(t)?"JBrowse/Store/SeqFeature/BED":/\.vcf.b?gz$/i.test(t)?"JBrowse/Store/SeqFeature/VCFTabix":/\.gff3?.b?gz$/i.test(t)?"JBrowse/Store/SeqFeature/GFF3Tabix":/\.bed.b?gz$/i.test(t)?"JBrowse/Store/SeqFeature/BEDTabix":/\.(bw|bigwig)$/i.test(t)?"JBrowse/Store/SeqFeature/BigWig":/\.(bb|bigbed)$/i.test(t)?"JBrowse/Store/SeqFeature/BigBed":/\.(fa|fasta)$/i.test(t)?"JBrowse/Store/SeqFeature/IndexedFasta":/\.(fa|fasta)\.b?gz$/i.test(t)?"JBrowse/Store/SeqFeature/BgzipIndexedFasta":/\.2bit$/i.test(t)?"JBrowse/Store/SeqFeature/TwoBit":!((o=e.type)===null||o===void 0)&&o.endsWith("/Sequence")?"JBrowse/Store/Sequence/StaticChunked":"":""}function I(e,t){var r;const{urlTemplate:o=""}=t,n=t.storeClass?z("JBrowse/Store",t.storeClass):ce(t,o);if(!n){console.warn(`Unable to determine an appropriate data store to use with track '${t.label}', please explicitly specify a storeClass in the configuration.`);return}const s={...t,type:n};s.name=(n==="JBrowse/Store/Sequence/StaticChunked"||n==="JBrowse/Store/Sequence/IndexedFasta"||n==="JBrowse/Store/SeqFeature/IndexedFasta"||n==="JBrowse/Store/SeqFeature/BgzipIndexedFasta"||n==="JBrowse/Store/SeqFeature/TwoBit"||n==="JBrowse/Store/Sequence/TwoBit"||t.useAsRefSeqStore)&&!(!((r=e.stores)===null||r===void 0)&&r.refseqs)?"refseqs":`store${Q.objectHash(s)}`,e.stores||(e.stores={}),e.stores[s.name]=s,t.store=s.name}function j(e){return e.uri!==void 0}function B(e){return e.localPath!==void 0}async function be(e={uri:"",locationType:"UriLocation"},t={include:["{dataRoot}/trackList.json","{dataRoot}/tracks.conf"]},r={uri:"",locationType:"UriLocation"}){const o="uri"in e?"uri":"localPath",n=JSON.parse(JSON.stringify(e));let s="";if(j(e)&&(s=e.uri),B(e)&&(s=e.localPath),s.endsWith("/")&&(n[o]=s.slice(0,-1)),j(r)&&r.uri||B(r)&&r.localPath){const c="uri"in r?"uri":"localPath";let d="";j(r)&&(d=r.uri),B(r)&&(d=r.localPath),d.endsWith("/")&&(d=d.slice(0,-1));let p={};for(const w of["jbrowse.conf","jbrowse_conf.json"]){let b=null;try{b=await D({[c]:`${d}/${w}`})}catch{console.error(`tried to access ${d}/${w}, but failed`)}p=k(p,b)||{}}return n[o]&&(p.dataRoot=n[o]),V(p)}const f=$(t,window.location.href);return n[o]&&(f.dataRoot=n[o]),V(f)}async function V(e,t=de){const r=x(structuredClone(t),e);let o=await le(r);return o=k(o,e)||o,U(o,o),ye(o),o}async function D(e){const t=await G.openLocation(e).readFile("utf8");return j(e)?q(t,e.uri):B(e)?q(t,e.localPath):q(t)}function q(e,t=""){return e.trim().startsWith("{")?se(e,t):ne(e,t)}function k(e,t){if(t===null)return null;e===null&&(e={});for(const r of Object.keys(t))if(r==="tracks"&&r in e){const o=e[r]||[],n=t[r]||[];if(Array.isArray(o)&&Array.isArray(n))e[r]=ue(o,n);else throw new Error(`Track config has not been properly regularized: ${o} ${n}`)}else!pe(r)&&r in e&&typeof t[r]=="object"&&typeof e[r]=="object"?e[r]=x(e[r],t[r]):r==="dataRoot"?(e[r]===void 0||e[r]==="data"&&t[r]!==void 0)&&(e[r]=t[r]):(e[r]===void 0||t[r]!==void 0)&&(e[r]=t[r]);return e}function ue(e,t){if(!t.length)return e;const r={};for(const[o,n]of e.entries())n.index=o,r[n.label]=n;for(const o of t){const n=r[o.label];n?k(n,o):e.push(o)}return e}async function le(e){e=structuredClone(e);async function t(r,o){const n=r.sourceUrl||r.baseUrl;if(!n)throw new Error(`Could not determine source URL: ${JSON.stringify(r)}`);const s=k(structuredClone(o),r);if(!s)throw new Error("Problem merging configs");const f=U(fe(r.include||[]),s);r.include=void 0;const c=f.map(async p=>{p.cacheBuster=e.cacheBuster;const w=await D({uri:new URL(p.url,n).href,locationType:"UriLocation"});return t(w,s)}),d=await Promise.all(c);for(const p of d)r=k(r,p)||r;return r}return t(e,{})}function fe(e){return e?(Array.isArray(e)||(e=[e]),e.map(t=>(typeof t=="string"&&(t={url:t}),"format"in t||(t.format=t.url.endsWith(".conf")?"conf":"JB_json"),t.format==="JB_json"&&!("version"in t)&&(t.version=1),t))):[]}function U(e,t){if(!e)return e;if(Array.isArray(e))for(let r=0;r<e.length;r+=1)e[r]=U(e[r],t);else if(typeof e=="object"){const r=e;for(const o of Object.keys(r))r[o]=U(r[o],t)}else if(typeof e=="string")return oe(e,t);return e}function pe(e){return e==="datasets"}const de={tracks:[],containerID:"GenomeBrowser",dataRoot:"data",show_tracklist:!0,show_nav:!0,show_menu:!0,show_overview:!0,show_fullviewlink:!0,update_browser_title:!0,updateBrowserURL:!0,refSeqs:"{dataRoot}/seq/refSeqs.json",include:["jbrowse.conf","jbrowse_conf.json"],nameUrl:"{dataRoot}/names/root.json",datasets:{_DEFAULT_EXAMPLES:!0,volvox:{url:"?data=sample_data/json/volvox",name:"Volvox Example"},modencode:{url:"?data=sample_data/json/modencode",name:"MODEncode Example"},yeast:{url:"?data=sample_data/json/yeast",name:"Yeast Example"}},highlightSearchedRegions:!1,highResolutionMode:"auto"};function ye(e){if(e.tracks||(e.tracks=[]),!e.baseUrl)throw new Error("Must provide a `baseUrl` in configuration")}export{V as createFinalConfig,D as fetchConfigFile,be as fetchJb1,q as parseJb1};
