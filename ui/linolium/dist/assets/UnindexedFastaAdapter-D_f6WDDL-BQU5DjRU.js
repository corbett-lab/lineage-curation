import{a1 as p,s as c,u as f}from"./JBrowsePanel-CjeUdi3D-Dhrr89W5.js";import{e as m}from"./index-Bp4pXTEU-Cipcrd2k.js";import{o as l}from"./rxjs-euq-mp90-DvajfGj-.js";import"./index-Bwk-R6QR.js";import"./taxonium-component.es-D8UFPkMd.js";function h(i){return new Map(i.split(">").filter(e=>/\S/.test(e)).map(e=>{const[t,...s]=e.split(`
`),[a,...n]=t.split(" "),r=s.join("").replace(/\s/g,"");return[a,{description:n.join(" "),sequence:r}]}))}class P extends m.BaseSequenceAdapter{async getRefNames(e){const{fasta:t}=await this.setup(e);return[...t.keys()]}async getRegions(e){const{fasta:t}=await this.setup(e);return[...t.entries()].map(([s,a])=>({refName:s,start:0,end:a.sequence.length}))}async setupPre(e){const t=this.getConf("fastaLocation"),s=h(await p.openLocation(t,this.pluginManager).readFile("utf8"));return{fasta:new Map([...s.entries()].map(([a,n])=>[c.readConfObject(this.config,"rewriteRefNames",{refName:a})||a,n]))}}async getHeader(){const e=this.getConf("metadataLocation");return e.uri===""||e.uri==="/path/to/fa.metadata.yaml"?null:p.openLocation(e,this.pluginManager).readFile("utf8")}async setup(e){return this.setupP||(this.setupP=this.setupPre(e).catch(t=>{throw this.setupP=void 0,t})),this.setupP}getFeatures(e,t){const{refName:s,start:a,end:n}=e;return l.ObservableCreate(async r=>{const{fasta:u}=await this.setup(t),o=u.get(s);o&&r.next(new f.SimpleFeature({id:`${s}-${a}-${n}`,data:{refName:s,start:a,end:n,seq:o.sequence.slice(a,n)}})),r.complete()})}}export{P as default};
