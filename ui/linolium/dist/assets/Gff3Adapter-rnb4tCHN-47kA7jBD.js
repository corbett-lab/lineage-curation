import{f as h}from"./main-D1zX1xg0-CI_PM91Q.js";import{e as m}from"./index-Bp4pXTEU-Cipcrd2k.js";import{u as g,a1 as v}from"./JBrowsePanel-CjeUdi3D-Dhrr89W5.js";import{o as M}from"./rxjs-euq-mp90-DvajfGj-.js";import{m as b}from"./simpleFeature-CxppDrI6-CpRiIJat.js";import{L as y,q as F}from"./featureData-Bm8gwGZK-C5GIydBc.js";import{x as T}from"./parseLineByLine-Be3SOOi9-j_LJE5Tt.js";import"./index-Bwk-R6QR.js";import"./taxonium-component.es-D8UFPkMd.js";function w(f,a=()=>{}){const t=[],r={};return T.parseLineByLine(f,e=>{if(e.startsWith("#"))t.push(e);else{if(e.startsWith(">"))return!1;{const s=e.indexOf("	"),n=e.slice(0,s);r[n]||(r[n]=""),r[n]+=`${e}
`}}return!0},a),{header:t.join(`
`),featureMap:r}}class P extends m.BaseFeatureDataAdapter{constructor(){super(...arguments),this.calculatedIntervalTreeMap={}}async loadDataP(a){const{statusCallback:t=()=>{}}=a||{},r=await g.fetchAndMaybeUnzip(v.openLocation(this.getConf("gffLocation"),this.pluginManager),a),{header:e,featureMap:s}=w(r,t),n=Object.fromEntries(Object.entries(s).map(([i,o])=>[i,c=>{if(!this.calculatedIntervalTreeMap[i]){c==null||c("Parsing GFF data");const u=new h;for(const l of y(o).flat().map((p,d)=>new b({data:F(p),id:`${this.id}-${i}-${d}`})))u.insert([l.get("start"),l.get("end")],l);this.calculatedIntervalTreeMap[i]=u}return this.calculatedIntervalTreeMap[i]}]));return{header:e,intervalTreeMap:n}}async loadData(a){return this.gffFeatures||(this.gffFeatures=this.loadDataP(a).catch(t=>{throw this.gffFeatures=void 0,t})),this.gffFeatures}async getRefNames(a={}){const{intervalTreeMap:t}=await this.loadData(a);return Object.keys(t)}async getHeader(a={}){const{header:t}=await this.loadData(a);return t}getFeatures(a,t={}){return M.ObservableCreate(async r=>{var e;try{const{start:s,end:n,refName:i}=a,{intervalTreeMap:o}=await this.loadData(t);for(const c of((e=o[i])===null||e===void 0?void 0:e.call(o,t.statusCallback).search([s,n]))||[])r.next(c);r.complete()}catch(s){r.error(s)}},t.stopToken)}}export{P as default};
