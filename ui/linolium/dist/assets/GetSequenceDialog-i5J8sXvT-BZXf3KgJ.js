import{r as i,j as e}from"./index-Bwk-R6QR.js";import{o as k,m as O,u as S,a as y,D as L,c as T,F as X,T as _,d as z,B as C,bu as D,aN as I,U as P,aM as B,s as G}from"./JBrowsePanel-CjeUdi3D-Dhrr89W5.js";import{F as E}from"./FormControlLabel-t1db3bCW-BhUWxcLA.js";import{X as $}from"./Checkbox-DRfuV2d3-Bnouab3n.js";import"./taxonium-component.es-D8UFPkMd.js";var m={},M;function H(){if(M)return m;M=1,Object.defineProperty(m,"__esModule",{value:!0}),m.formatFastaLines=s,m.formatSeqFasta=n;function s(a){return a.replaceAll(/(.{1,80})/g,`$1
`).trimEnd()}function n(a){return a.map(r=>`>${r.header}
${s(r.seq)}`).join(`
`)}return m}var J=H();const K=P(e.jsx("path",{d:"M19 9h-4V3H9v6H5l7 7zM5 18v2h14v-2z"}),"GetApp");async function Q(s,n){const a=S.getSession(s),{leftOffset:r,rightOffset:h}=s;if(!r||!h)throw new Error("no offsets on model to use for range");if(new Set(n.map(f=>f.assemblyName)).size>1)throw new Error("not able to fetch sequences from multiple assemblies currently");const{rpcManager:c,assemblyManager:p}=a,l=r.assemblyName||h.assemblyName||"",g=p.get(l);if(!g)throw new Error(`assembly ${l} not found`);const x=G.getConf(g,["sequence","adapter"]),u="getSequence";return c.call(u,"CoreGetFeatures",{adapterConfig:x,regions:n,sessionId:u})}const U=O()({dialogContent:{width:"80em"},textAreaFont:{fontFamily:"Courier New"},ml:{marginLeft:10}}),te=k(function({model:s,handleClose:n}){const{classes:a}=U(),[r,h]=i.useState(),[c,p]=i.useState(),[l,g]=i.useState(!1),[x,u]=i.useState(!1),[f,N]=i.useState(!1),{leftOffset:q,rightOffset:F}=s,b=c===void 0;i.useEffect(()=>{const o=new AbortController;return(async()=>{try{const t=s.getSelectedRegions(q,F);if(t.length===0)throw new Error("Selected region is out of bounds");p(await Q(s,t))}catch(t){console.error(t),h(t)}})(),()=>{o.abort()}},[s,q,F]);const d=c?J.formatSeqFasta(c.map(o=>{let t=o.get("seq");const R=o.get("refName"),v=o.get("start")+1,w=o.get("end"),A=`${R}:${v}-${w}`;if((t==null?void 0:t.length)!==w-v+1)throw new Error(`${A} returned ${t.length.toLocaleString()} bases, but should have returned ${(w-v).toLocaleString()}`);return l&&(t=S.reverse(t)),f&&(t=S.complement(t)),{header:A+(l?"-rev":"")+(f?"-comp":""),seq:t}})):"",j=d?d.length>1e6:!1;return e.jsxs(y.Dialog,{maxWidth:"xl",open:!0,onClose:()=>{n(),s.setOffsets()},title:"Reference sequence",children:[e.jsxs(L,{children:[r?e.jsx(y.ErrorMessage,{error:r}):b?e.jsx(y.LoadingEllipses,{message:"Retrieving sequences"}):null,e.jsx(T,{"data-testid":"rubberband-sequence",variant:"outlined",multiline:!0,minRows:5,maxRows:10,disabled:j,className:a.dialogContent,fullWidth:!0,value:j?"Reference sequence too large to display, use the download FASTA button":d,slotProps:{input:{readOnly:!0,classes:{input:a.textAreaFont}}}}),e.jsxs(X,{children:[e.jsx(E,{control:e.jsx($,{value:l,onChange:o=>{g(o.target.checked)}}),label:"Reverse sequence"}),e.jsx(E,{control:e.jsx($,{value:f,onChange:o=>{N(o.target.checked)}}),label:"Complement sequence"})]}),e.jsx(_,{style:{margin:10},children:'Note: Check both boxes for the "reverse complement"'})]}),e.jsxs(z,{children:[e.jsx(C,{onClick:()=>{I(d),u(!0),setTimeout(()=>{u(!1)},500)},disabled:b||!!r||j,color:"primary",startIcon:e.jsx(D,{}),children:x?"Copied":"Copy to clipboard"}),e.jsx(C,{onClick:()=>{B.saveAs(new Blob([d||""],{type:"text/x-fasta;charset=utf-8"}),"jbrowse_ref_seq.fa")},disabled:b||!!r,color:"primary",startIcon:e.jsx(K,{}),children:"Download FASTA"}),e.jsx(C,{onClick:n,variant:"contained",children:"Close"})]})]})});export{te as default};
