import{o as C,a as O,D as P,d as R,B as g,e as V,u as y,c as M,m as T,aG as E}from"./JBrowsePanel-CjeUdi3D-Dhrr89W5.js";import{r as v,j as m}from"./index-Bwk-R6QR.js";import{F as L}from"./FormControlLabel-t1db3bCW-BhUWxcLA.js";import{X as D}from"./Checkbox-DRfuV2d3-Bnouab3n.js";const A=T()({block:{display:"block"}});function N({checked:a,disabled:c,label:e,onChange:n}){const{classes:o}=A();return m.jsx(L,{disabled:c,className:o.block,control:m.jsx(D,{checked:a,onChange:n}),label:e})}function S({feature:a,assembly:c}){var e;const n=(e=a.get("ALT"))===null||e===void 0?void 0:e[0],o=n?E(n):void 0,s=a.get("start"),l=a.get("refName"),r=t=>c.getCanonicalRefName(t)||t;if(n==="<TRA>"){const t=a.get("INFO");return{pos:s,refName:r(l),mateRefName:r(t.CHR2[0]),matePos:t.END[0]-1}}else if(o!=null&&o.MatePosition){const t=o.MatePosition.split(":");return{pos:s,refName:r(l),mateRefName:r(t[0]),matePos:+t[1]-1}}else if(a.get("mate")){const t=a.get("mate");return{pos:s,refName:r(l),mateRefName:r(t.refName),matePos:t.start}}else return{pos:s,refName:r(l),mateRefName:r(l),matePos:a.get("end")}}function x(a){return a.map(({id:c,displays:e,...n})=>({...n,displays:e.map(({id:o,...s})=>s)}))}function h(a){return`${a.get("name")||a.get("id")||"breakend"} split detail`}async function F({stableViewId:a,feature:c,assemblyName:e,session:n,mirror:o,tracks:s=[]}){const{assemblyManager:l}=n,r=await l.waitForAssembly(e);if(!r)throw new Error(`assembly ${e} not found`);const{refName:t,pos:f,mateRefName:d,matePos:u}=S({feature:c,assembly:r});let i=n.views.find(p=>p.id===a);i||(i=n.addView("BreakpointSplitView",{id:a,type:"BreakpointSplitView",displayName:h(c),views:[{type:"LinearGenomeView",hideHeader:!0,tracks:x(s)},{type:"LinearGenomeView",hideHeader:!0,tracks:x(o?[...s].reverse():s)}]})),i.setDisplayName(h(c));const b=r.regions.find(p=>p.refName===t),w=r.regions.find(p=>p.refName===d);if(!b||!w)throw new Error("can't find regions");await Promise.all([i.views[0].navToLocations([{refName:t,start:b.start,end:f,assemblyName:e},{refName:t,start:f+1,end:b.end,assemblyName:e}]),i.views[1].navToLocations([{refName:d,start:w.start,end:u,assemblyName:e},{refName:d,start:u+1,end:w.end,assemblyName:e}])]),await y.when(()=>i.views[1].initialized&&i.views[0].initialized),i.views[1].zoomTo(10),i.views[0].zoomTo(10),i.views[1].centerAt(u,d),i.views[0].centerAt(f,t)}const _=C(function({session:a,handleClose:c,feature:e,assemblyName:n,stableViewId:o,view:s}){const[l,r]=v.useState(!0),[t,f]=v.useState(!0);return m.jsxs(O.Dialog,{open:!0,onClose:c,title:"Multi-level breakpoint split view options",children:[m.jsxs(P,{children:[m.jsx("div",{children:"Launch multi-level breakpoint split view"}),s?m.jsxs(m.Fragment,{children:[m.jsx(N,{checked:l,label:"Copy tracks into the new view",onChange:d=>{r(d.target.checked)}}),l?m.jsx(N,{checked:t,disabled:!l,label:"Mirror the copied tracks (only available if copying tracks and using two level)",onChange:d=>{f(d.target.checked)}}):null]}):null]}),m.jsxs(R,{children:[m.jsx(g,{onClick:()=>{(async()=>{try{await F({stableViewId:o,session:a,tracks:l&&s?V(s.tracks):[],mirror:t,feature:e,assemblyName:n})}catch(d){console.error(d),a.notifyError(`${d}`,d)}})(),c()},variant:"contained",color:"primary",autoFocus:!0,children:"OK"}),m.jsx(g,{color:"secondary",variant:"contained",onClick:()=>{c()},children:"Cancel"})]})]})});function $({feature:a,session:c,assemblyName:e,windowSize:n=0}){const{assemblyManager:o}=c,s=o.get(e);if(!s)throw new Error(`assembly ${e} not found`);if(!s.regions)throw new Error(`assembly ${e} regions not loaded`);const l=S({feature:a,assembly:s}),{refName:r,mateRefName:t}=l,f=s.regions.find(u=>u.refName===r),d=s.regions.find(u=>u.refName===t);return{coverage:l,snap:{type:"BreakpointSplitView",views:[{type:"LinearGenomeView",displayedRegions:y.gatherOverlaps([{...f,end:l.pos+n,assemblyName:e},{...d,start:l.matePos-n,assemblyName:e}])}],displayName:h(a)}}}function I({feature:a,session:c,assemblyName:e}){const{assemblyManager:n}=c,o=n.get(e);if(!o)throw new Error(`assembly ${e} not found`);if(!o.regions)throw new Error(`assembly ${e} regions not loaded`);const s=S({feature:a,assembly:o}),{refName:l,mateRefName:r}=s,t=o.regions.find(d=>d.refName===l),f=o.regions.find(d=>d.refName===r);return{coverage:s,snap:{type:"BreakpointSplitView",views:[{type:"LinearGenomeView",displayedRegions:y.gatherOverlaps([{...t,assemblyName:e},{...f,assemblyName:e}])}],displayName:h(a)}}}async function G({stableViewId:a,feature:c,assemblyName:e,session:n,tracks:o,windowSize:s=0,focusOnBreakends:l}){var r;const{snap:t,coverage:f}=l?$({feature:c,assemblyName:e,session:n,windowSize:s}):I({feature:c,assemblyName:e,session:n}),{refName:d,pos:u,mateRefName:i,matePos:b}=f;let w=n.views.find(z=>z.id===a);w?((r=w.views[0])===null||r===void 0||r.setDisplayedRegions(t.views[0].displayedRegions),w.setDisplayName(t.displayName)):w=n.addView("BreakpointSplitView",{...t,views:[{...t.views[0],tracks:o?x(V(o)):[]}]});const p=w.views[0];await y.when(()=>p.initialized);const k=p.bpToPx({coord:Math.max(0,u-s),refName:d}),j=p.bpToPx({coord:b+s,refName:i});k&&j?p.moveTo({...k,offset:k.offsetPx},{...j,offset:j.offsetPx}):y.getSession(p).notify("Unable to navigate to breakpoint")}const B=C(function({session:a,handleClose:c,feature:e,stableViewId:n,assemblyName:o,view:s}){const[l,r]=v.useState(!0),[t,f]=v.useState(!0),[d,u]=y.useLocalStorage("breakpointWindowSize","5000");return m.jsxs(O.Dialog,{open:!0,onClose:c,title:"Single-level breakpoint split view options",children:[m.jsxs(P,{children:[s?m.jsx(N,{checked:l,label:"Copy tracks into the new view",onChange:i=>{r(i.target.checked)}}):null,m.jsx(N,{checked:l,label:"Focus on breakends",onChange:i=>{f(i.target.checked)}}),m.jsx(M,{label:"Window size (bp)",value:d,onChange:i=>{u(i.target.value)}})]}),m.jsxs(R,{children:[m.jsx(g,{onClick:()=>{(async()=>{try{const{assemblyManager:i}=a;if(!await i.waitForAssembly(o))throw new Error(`assembly ${o} not found`);await G({feature:e,assemblyName:o,focusOnBreakends:t,session:a,stableViewId:n,tracks:s==null?void 0:s.tracks,windowSize:+d||0})}catch(i){console.error(i),a.notifyError(`${i}`,i)}})(),c()},variant:"contained",color:"primary",autoFocus:!0,children:"OK"}),m.jsx(g,{color:"secondary",variant:"contained",onClick:()=>{c()},children:"Cancel"})]})]})}),W=Object.freeze(Object.defineProperty({__proto__:null,default:_},Symbol.toStringTag,{value:"Module"})),X=Object.freeze(Object.defineProperty({__proto__:null,default:B},Symbol.toStringTag,{value:"Module"})),Z=Object.freeze(Object.defineProperty({__proto__:null,default:_},Symbol.toStringTag,{value:"Module"})),U=Object.freeze(Object.defineProperty({__proto__:null,default:B},Symbol.toStringTag,{value:"Module"}));export{W as B,X as a,Z as b,U as c};
