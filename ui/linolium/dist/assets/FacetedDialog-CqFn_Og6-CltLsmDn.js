import{j as e,r as y}from"./index-Bwk-R6QR.js";import{o as k,a as M,D as I,m as W,c as O,bG as E,a4 as S,bH as R,u as b,bE as z,bF as L,bD as $,bC as H,bb as D,T as G,bA as K,a3 as F,bB as A,bp as U}from"./JBrowsePanel-CjeUdi3D-Dhrr89W5.js";import{e as T}from"./SanitizedHTML-BuU69Ctr-BSE6rulZ.js";import{e as N}from"./Clear-Bq9BgXq5-zru5vVp-.js";import{H as Y}from"./DataGrid-CtzhbUAR-B5avypAp.js";import{T as Q,S as V}from"./HierarchicalTrackSelector-l9rGRahj-ZsRtSBXi.js";import{W as X}from"./Grid-C8gEqkWK-DXtd0Rrk.js";import"./taxonium-component.es-D8UFPkMd.js";import"./getThemeProps-VQY9obTE-DyGMZP3D.js";import"./FormControlLabel-t1db3bCW-BhUWxcLA.js";import"./MenuItem-bcu4bG3--CNW0nWZm.js";import"./dividerClasses-CVTzPOoo-DLNaoCl0.js";import"./Divider-DzCbFD9M-BaKdmFVz.js";import"./Badge-DesLZhxI-BI0lVxgb.js";import"./TableCell-mfS6Ut2J-N_4-_qc3.js";import"./Checkbox-DRfuV2d3-Bnouab3n.js";const B=W()(s=>({facet:{margin:0,marginLeft:s.spacing(2)},select:{marginBottom:s.spacing(2)}}));function P({onClick:s}){return e.jsx(F,{title:"Clear selection on this facet filter",children:e.jsx(S,{onClick:()=>{s()},size:"small",children:e.jsx(N,{})})})}function J({visible:s,onClick:n}){return e.jsx(F,{title:"Minimize/expand this facet filter",children:e.jsx(S,{onClick:()=>{n()},size:"small",children:s?e.jsx(A,{}):e.jsx(U,{})})})}const Z=k(function({column:s,vals:n,model:p}){const{classes:d}=B(),[r,x]=y.useState(!0),{faceted:o}=p,{filters:m}=o,{field:a}=s;return e.jsxs(D,{className:d.facet,fullWidth:!0,children:[e.jsxs("div",{children:[e.jsx(G,{component:"span",children:a}),e.jsx(P,{onClick:()=>{o.setFilter(a,[])}}),e.jsx(J,{visible:r,onClick:()=>{x(!r)}})]}),r?e.jsx(K,{multiple:!0,native:!0,className:d.select,value:m.get(s.field)||[],onChange:c=>{o.setFilter(s.field,[...c.target.options].filter(h=>h.selected).map(h=>h.value))},children:n.sort((c,h)=>c[0].localeCompare(h[0])).map(([c,h])=>e.jsxs("option",{value:c,children:[b.coarseStripHTML(c)," (",h,")"]},c))}):null]})}),q=k(function({rows:s,columns:n,model:p}){var d,r;const{faceted:x}=p,{filters:o}=x,m=n.slice(1),a=new Map(n.slice(1).map(t=>[t.field,new Map])),c=x.filters.keys(),h=m.map(t=>t.field),i=new Set;for(const t of c)!((d=o.get(t))===null||d===void 0)&&d.length&&i.add(t);for(const t of h)i.add(t);let w=s;for(const t of i){const u=a.get(t);if(u)for(const l of w){const f=H(t,l),j=u.get(f);f&&(j===void 0?u.set(f,1):u.set(f,j+1))}const v=!((r=o.get(t))===null||r===void 0)&&r.length?new Set(o.get(t)):void 0;w=w.filter(l=>v!==void 0?v.has(H(t,l)):!0)}return e.jsx("div",{children:m.map(t=>e.jsx(Z,{vals:[...a.get(t.field)],column:t,model:p},t.field))})}),_=k(function({model:s,columns:n,shownTrackIds:p,selection:d}){const{pluginManager:r}=b.getEnv(s),{view:x,faceted:o}=s,{rows:m,useShoppingCart:a,showOptions:c,filteredRows:h,filteredNonMetadataKeys:i,filteredMetadataKeys:w,visible:t}=o,[u,v]=y.useState({name:b.measureGridWidth(m.map(l=>l.name),{maxWidth:500,stripHTML:!0})+15,...Object.fromEntries(i.filter(l=>t[l]).map(l=>[l,b.measureGridWidth(m.map(f=>f[l]),{maxWidth:400,stripHTML:!0})])),...Object.fromEntries(w.filter(l=>t[`metadata.${l}`]).map(l=>[`metadata.${l}`,b.measureGridWidth(m.map(f=>f.metadata[l]),{maxWidth:400,stripHTML:!0})]))});return e.jsx(Y,{rowHeight:25,columnHeaderHeight:35,checkboxSelection:!0,disableRowSelectionOnClick:!0,keepNonExistentRowsSelected:!0,rows:h,columnVisibilityModel:t,showToolbar:c,onColumnWidthChange:l=>{v({...u,[l.colDef.field]:l.width})},onColumnVisibilityModelChange:l=>{s.faceted.setVisible(l)},onRowSelectionModelChange:l=>{if(a){const f=z(s),j=r.pluggableConfigSchemaType("track");s.setSelection([...l.ids].map(g=>L(j,f,g)))}else{const f=p,j=l.ids;$(()=>{[...f].filter(g=>!j.has(g)).map(g=>x.hideTrack(g)),[...j].filter(g=>!f.has(g)).map(g=>{x.showTrack(g),s.addToRecentlyUsed(g)})})}},rowSelectionModel:{type:"include",ids:new Set(a?d.map(l=>l.trackId):[...p])},columns:n.map(l=>({...l,width:u[l.field]}))})});function ee({model:s}){const{faceted:n}=s,[p,d]=y.useState(null),{showOptions:r,showFilters:x,showSparse:o,useShoppingCart:m}=n;return e.jsxs(e.Fragment,{children:[e.jsxs(X,{container:!0,spacing:4,alignItems:"center",children:[e.jsx(O,{label:"Search...",value:n.filterText,onChange:a=>{n.setFilterText(a.target.value)},slotProps:{input:{endAdornment:e.jsx(E,{position:"end",children:e.jsx(S,{onClick:()=>{n.setFilterText("")},children:e.jsx(N,{})})})}}}),e.jsx(S,{onClick:a=>{d(a.currentTarget)},children:e.jsx(R,{})}),e.jsx(V,{model:s})]}),e.jsx(M.Menu,{anchorEl:p,open:!!p,onClose:()=>{d(null)},onMenuItemClick:(a,c)=>{c(),d(null)},menuItems:[{label:"Add tracks to selection instead of turning them on/off",onClick:()=>{n.setUseShoppingCart(!m)},type:"checkbox",checked:m},{label:"Show sparse metadata columns",onClick:()=>{n.setShowSparse(!o)},checked:o,type:"checkbox"},{label:"Show facet filters",onClick:()=>{n.setShowFilters(!x)},checked:x,type:"checkbox"},{label:"Show extra table options",onClick:()=>{n.setShowOptions(!r)},checked:r,type:"checkbox"}]})]})}const te=W()({cell:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},resizeHandle:{marginLeft:5,background:"grey",width:5}}),C=.75,se=k(function({model:s}){const{classes:n}=te(),{selection:p,shownTrackIds:d,faceted:r}=s,{rows:x,panelWidth:o,showFilters:m,filteredNonMetadataKeys:a,filteredMetadataKeys:c}=r,h=[{field:"name",hideable:!1,renderCell:i=>{const{value:w,row:t}=i,{id:u,conf:v}=t;return e.jsxs("div",{className:n.cell,children:[e.jsx(T,{html:w}),e.jsx(Q,{id:u,conf:v,trackId:u,model:s})]})}},...a.map(i=>({field:i,renderCell:w=>{const t=w.value;return t?e.jsx(T,{className:n.cell,html:t}):""}})),...c.map(i=>({field:`metadata.${i}`,headerName:["name",...a].includes(i)?`${i} (from metadata)`:i,valueGetter:(w,t)=>{var u;return`${(u=t.metadata[i])!==null&&u!==void 0?u:""}`},renderCell:w=>{const t=w.value;return t?e.jsx(T,{className:n.cell,html:t}):""}}))];return e.jsxs(e.Fragment,{children:[e.jsx(ee,{model:s}),e.jsxs("div",{style:{display:"flex",overflow:"hidden",height:window.innerHeight*C,width:window.innerWidth*C},children:[e.jsx("div",{style:{height:window.innerHeight*C,width:window.innerWidth*C-(m?o:0)},children:e.jsx(_,{model:s,columns:h,shownTrackIds:d,selection:p})}),m?e.jsxs(e.Fragment,{children:[e.jsx(M.ResizeHandle,{vertical:!0,onDrag:i=>r.setPanelWidth(o-i),className:n.resizeHandle}),e.jsx("div",{style:{width:o,overflow:"auto"},children:e.jsx(q,{model:s,rows:x,columns:h})})]}):null]})]})}),je=k(function(s){const{handleClose:n}=s;return e.jsx(M.Dialog,{open:!0,onClose:n,maxWidth:"xl",title:"Faceted track selector",children:e.jsx(I,{children:e.jsx(se,{...s})})})});export{je as default};
