import{r as l,j as e}from"./index-Bwk-R6QR.js";import{o as E,u as p,f as B,a as f,D as N,T as v,c as k,d as F,B as L,e as R,h as Z,n as j,p as C}from"./JBrowsePanel-CjeUdi3D-Dhrr89W5.js";import{J as I}from"./MenuItem-bcu4bG3--CNW0nWZm.js";import"./taxonium-component.es-D8UFPkMd.js";import"./dividerClasses-CVTzPOoo-DLNaoCl0.js";const V=E(function(A){const{model:r,handleClose:y}=A,[a,S]=l.useState(""),[o,T]=l.useState(),[w,m]=l.useState(!1),[D,x]=l.useState(),P=/^[A-Za-z][A-Za-z0-9]$/.exec(a),d=a.length===2&&!P,$=p.useDebounce(a,1e3),[c,b]=l.useState("");return l.useEffect(()=>{(async()=>{try{if(!d){x(void 0),m(!0);const s=await B({self:r,tag:$,blocks:p.getContainingView(r).staticBlocks});T(s)}}catch(s){console.error(s),x(s)}finally{m(!1)}})()},[r,d,$]),e.jsxs(f.Dialog,{open:!0,onClose:y,title:"Group by",children:[e.jsxs(N,{children:[e.jsx(v,{children:'NOTE: this will create new session tracks with the "filter by" set to the values chosen here rather than affecting the current track state'}),e.jsxs(k,{fullWidth:!0,value:c,onChange:s=>{b(s.target.value)},label:"Group by...",select:!0,children:[e.jsx(I,{value:"strand",children:"Strand"}),e.jsx(I,{value:"tag",children:"Tag"})]}),c==="tag"?e.jsxs(e.Fragment,{children:[e.jsx(v,{color:"textSecondary",children:"Examples: HP for haplotype, RG for read group, etc."}),e.jsx(k,{value:a,onChange:s=>{S(s.target.value)},placeholder:"Enter tag name",error:d,helperText:d?"Not a valid tag":"",autoComplete:"off","data-testid":"group-tag-name",slotProps:{htmlInput:{maxLength:2,"data-testid":"group-tag-name-input"}}}),D?e.jsx(f.ErrorMessage,{error:D}):w?e.jsx(f.LoadingEllipses,{title:"Loading unique tags"}):o?e.jsxs("div",{children:[e.jsxs("div",{children:["Found unique ",a," values:"]}),e.jsx("div",{children:o.join(", ")})]}):null]}):null]}),e.jsxs(F,{children:[e.jsx(L,{variant:"contained",color:"primary",type:"submit",disabled:!o,autoFocus:!0,onClick:()=>{const s=p.getContainingTrack(r),t=structuredClone(R(s.configuration)),g=p.getSession(r),h=p.getContainingView(r);if(c==="tag"){if(o){const n=[...o,void 0];for(const i of n){const u=`${t.trackId}-${a}:${i}-${+Date.now()}-sessionTrack`;g.addTrackConf({...t,trackId:u,name:`${t.name} (${a}:${i})`,displays:[{displayId:`${u}-LinearAlignmentsDisplay`,type:"LinearAlignmentsDisplay",pileupDisplay:{displayId:`${u}-LinearAlignmentsDisplay-LinearPileupDisplay`,type:"LinearPileupDisplay",filterBy:{...Z,tagFilter:{tag:a,value:i}}}}]}),h.showTrack(u)}}}else if(c==="strand"){const n=`${t.trackId}-${a}:(-)-${+Date.now()}-sessionTrack`,i=`${t.trackId}-${a}:(+)-${+Date.now()}-sessionTrack`;g.addTrackConf({...t,trackId:n,name:`${t.name} (-)`,displays:[{displayId:`${n}-LinearAlignmentsDisplay`,type:"LinearAlignmentsDisplay",pileupDisplay:{displayId:`${n}-LinearAlignmentsDisplay-LinearPileupDisplay`,type:"LinearPileupDisplay",filterBy:j}},{displayId:`${n}-LinearSNPCoverageDisplay`,type:"LinearSNPCoverageDisplay",filterBy:j}]}),g.addTrackConf({...t,trackId:i,name:`${t.name} (+)`,displays:[{displayId:`${i}-LinearAlignmentsDisplay`,type:"LinearAlignmentsDisplay",pileupDisplay:{displayId:`${i}-LinearAlignmentsDisplay-LinearPileupDisplay`,type:"LinearPileupDisplay",filterBy:C}},{displayId:`${i}-LinearSNPCoverageDisplay`,type:"LinearSNPCoverageDisplay",filterBy:C}]}),h.showTrack(n),h.showTrack(i)}y()},children:"Submit"}),e.jsx(L,{variant:"contained",color:"secondary",onClick:()=>{y()},children:"Cancel"})]})]})});export{V as default};
