import{r as ct}from"./browser-BpRiKmO--zAOSyNoU.js";import{c as lt}from"./AbortablePromiseCache-CcuMrnn7-56xRj2xE.js";import{y as ft,$ as ht}from"./remoteFile-DvhH--az-9OF1arfw.js";import{w as dt}from"./Observable-ztGTW3Os-DRs2VX0K.js";import{$ as ut,a0 as gt}from"./JBrowsePanel-CjeUdi3D-Dhrr89W5.js";const Le=BigInt(32);function mt(t,n,e){const i=+!!e,s=+!e;return BigInt(t.getInt32(n,e)*s+t.getInt32(n+4,e)*i)<<Le|BigInt(t.getUint32(n,e)*i+t.getUint32(n+4,e)*s)}function bt(t,n,e){const i=t.getUint32(n,e),s=t.getUint32(n+4,e),r=+!!e,a=+!e;return BigInt(i*a+s*r)<<Le|BigInt(i*r+s*a)}"getBigInt64"in DataView||(DataView.prototype.getBigInt64=function(t,n){return mt(this,t,n)});"getBigUint64"in DataView||(DataView.prototype.getBigUint64=function(t,n){return bt(this,t,n)});class V{constructor(n){this.ranges=n}get min(){return this.ranges[0].min}get max(){return this.ranges.at(-1).max}contains(n){for(const e of this.ranges)if(e.min<=n&&e.max>=n)return!0;return!1}isContiguous(){return this.ranges.length>1}getRanges(){return this.ranges.map(n=>new V([{min:n.min,max:n.max}]))}toString(){return this.ranges.map(n=>`[${n.min}-${n.max}]`).join(",")}union(n){const e=[...this.getRanges(),...n.getRanges()].sort((r,a)=>r.min<a.min?-1:r.min>a.min?1:r.max<a.max?-1:a.max>r.max?1:0),i=[];let s=e[0];for(const r of e)r.min>s.max+1?(i.push(s),s=r):r.max>s.max&&(s=new V([{min:s.min,max:r.max}]));return i.push(s),i.length===1?i[0]:new V(i)}}function P(t){let n=t.length;for(;--n>=0;)t[n]=0}const wt=3,kt=258,je=29,pt=256,yt=pt+1+je,qe=30,_t=512,xt=new Array((yt+2)*2);P(xt);const vt=new Array(qe*2);P(vt);const Bt=new Array(_t);P(Bt);const Ut=new Array(kt-wt+1);P(Ut);const Rt=new Array(je);P(Rt);const Et=new Array(qe);P(Et);const At=(t,n,e,i)=>{let s=t&65535|0,r=t>>>16&65535|0,a=0;for(;e!==0;){a=e>2e3?2e3:e,e-=a;do s=s+n[i++]|0,r=r+s|0;while(--a);s%=65521,r%=65521}return s|r<<16|0};var le=At;const St=()=>{let t,n=[];for(var e=0;e<256;e++){t=e;for(var i=0;i<8;i++)t=t&1?3988292384^t>>>1:t>>>1;n[e]=t}return n},Dt=new Uint32Array(St()),Ot=(t,n,e,i)=>{const s=Dt,r=i+e;t^=-1;for(let a=i;a<r;a++)t=t>>>8^s[(t^n[a])&255];return t^-1};var T=Ot,fe={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Ke={Z_NO_FLUSH:0,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFLATED:8};const Tt=(t,n)=>Object.prototype.hasOwnProperty.call(t,n);var Ct=function(t){const n=Array.prototype.slice.call(arguments,1);for(;n.length;){const e=n.shift();if(e){if(typeof e!="object")throw new TypeError(e+"must be non-object");for(const i in e)Tt(e,i)&&(t[i]=e[i])}}return t},It=t=>{let n=0;for(let i=0,s=t.length;i<s;i++)n+=t[i].length;const e=new Uint8Array(n);for(let i=0,s=0,r=t.length;i<r;i++){let a=t[i];e.set(a,s),s+=a.length}return e},We={assign:Ct,flattenChunks:It};let Ge=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Ge=!1}const L=new Uint8Array(256);for(let t=0;t<256;t++)L[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;L[254]=L[254]=1;var Nt=t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let n,e,i,s,r,a=t.length,f=0;for(s=0;s<a;s++)e=t.charCodeAt(s),(e&64512)===55296&&s+1<a&&(i=t.charCodeAt(s+1),(i&64512)===56320&&(e=65536+(e-55296<<10)+(i-56320),s++)),f+=e<128?1:e<2048?2:e<65536?3:4;for(n=new Uint8Array(f),r=0,s=0;r<f;s++)e=t.charCodeAt(s),(e&64512)===55296&&s+1<a&&(i=t.charCodeAt(s+1),(i&64512)===56320&&(e=65536+(e-55296<<10)+(i-56320),s++)),e<128?n[r++]=e:e<2048?(n[r++]=192|e>>>6,n[r++]=128|e&63):e<65536?(n[r++]=224|e>>>12,n[r++]=128|e>>>6&63,n[r++]=128|e&63):(n[r++]=240|e>>>18,n[r++]=128|e>>>12&63,n[r++]=128|e>>>6&63,n[r++]=128|e&63);return n};const Zt=(t,n)=>{if(n<65534&&t.subarray&&Ge)return String.fromCharCode.apply(null,t.length===n?t:t.subarray(0,n));let e="";for(let i=0;i<n;i++)e+=String.fromCharCode(t[i]);return e};var Ft=(t,n)=>{const e=n||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,n));let i,s;const r=new Array(e*2);for(s=0,i=0;i<e;){let a=t[i++];if(a<128){r[s++]=a;continue}let f=L[a];if(f>4){r[s++]=65533,i+=f-1;continue}for(a&=f===2?31:f===3?15:7;f>1&&i<e;)a=a<<6|t[i++]&63,f--;if(f>1){r[s++]=65533;continue}a<65536?r[s++]=a:(a-=65536,r[s++]=55296|a>>10&1023,r[s++]=56320|a&1023)}return Zt(r,s)},zt=(t,n)=>{n=n||t.length,n>t.length&&(n=t.length);let e=n-1;for(;e>=0&&(t[e]&192)===128;)e--;return e<0||e===0?n:e+L[t[e]]>n?e:n},he={string2buf:Nt,buf2string:Ft,utf8border:zt};function Mt(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var Ht=Mt;const q=16209,Vt=16191;var Pt=function(t,n){let e,i,s,r,a,f,k,o,c,U,u,l,R,p,y,w,m,h,d,b,B,x,v,g;const _=t.state;e=t.next_in,v=t.input,i=e+(t.avail_in-5),s=t.next_out,g=t.output,r=s-(n-t.avail_out),a=s+(t.avail_out-257),f=_.dmax,k=_.wsize,o=_.whave,c=_.wnext,U=_.window,u=_.hold,l=_.bits,R=_.lencode,p=_.distcode,y=(1<<_.lenbits)-1,w=(1<<_.distbits)-1;e:do{l<15&&(u+=v[e++]<<l,l+=8,u+=v[e++]<<l,l+=8),m=R[u&y];t:for(;;){if(h=m>>>24,u>>>=h,l-=h,h=m>>>16&255,h===0)g[s++]=m&65535;else if(h&16){d=m&65535,h&=15,h&&(l<h&&(u+=v[e++]<<l,l+=8),d+=u&(1<<h)-1,u>>>=h,l-=h),l<15&&(u+=v[e++]<<l,l+=8,u+=v[e++]<<l,l+=8),m=p[u&w];n:for(;;){if(h=m>>>24,u>>>=h,l-=h,h=m>>>16&255,h&16){if(b=m&65535,h&=15,l<h&&(u+=v[e++]<<l,l+=8,l<h&&(u+=v[e++]<<l,l+=8)),b+=u&(1<<h)-1,b>f){t.msg="invalid distance too far back",_.mode=q;break e}if(u>>>=h,l-=h,h=s-r,b>h){if(h=b-h,h>o&&_.sane){t.msg="invalid distance too far back",_.mode=q;break e}if(B=0,x=U,c===0){if(B+=k-h,h<d){d-=h;do g[s++]=U[B++];while(--h);B=s-b,x=g}}else if(c<h){if(B+=k+c-h,h-=c,h<d){d-=h;do g[s++]=U[B++];while(--h);if(B=0,c<d){h=c,d-=h;do g[s++]=U[B++];while(--h);B=s-b,x=g}}}else if(B+=c-h,h<d){d-=h;do g[s++]=U[B++];while(--h);B=s-b,x=g}for(;d>2;)g[s++]=x[B++],g[s++]=x[B++],g[s++]=x[B++],d-=3;d&&(g[s++]=x[B++],d>1&&(g[s++]=x[B++]))}else{B=s-b;do g[s++]=g[B++],g[s++]=g[B++],g[s++]=g[B++],d-=3;while(d>2);d&&(g[s++]=g[B++],d>1&&(g[s++]=g[B++]))}}else if((h&64)===0){m=p[(m&65535)+(u&(1<<h)-1)];continue n}else{t.msg="invalid distance code",_.mode=q;break e}break}}else if((h&64)===0){m=R[(m&65535)+(u&(1<<h)-1)];continue t}else if(h&32){_.mode=Vt;break e}else{t.msg="invalid literal/length code",_.mode=q;break e}break}}while(e<i&&s<a);d=l>>3,e-=d,l-=d<<3,u&=(1<<l)-1,t.next_in=e,t.next_out=s,t.avail_in=e<i?5+(i-e):5-(e-i),t.avail_out=s<a?257+(a-s):257-(s-a),_.hold=u,_.bits=l};const M=15,de=852,ue=592,ge=0,ee=1,me=2,$t=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Lt=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),jt=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),qt=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),Kt=(t,n,e,i,s,r,a,f)=>{const k=f.bits;let o=0,c=0,U=0,u=0,l=0,R=0,p=0,y=0,w=0,m=0,h,d,b,B,x,v=null,g;const _=new Uint16Array(M+1),A=new Uint16Array(M+1);let S=null,N,O,Z;for(o=0;o<=M;o++)_[o]=0;for(c=0;c<i;c++)_[n[e+c]]++;for(l=k,u=M;u>=1&&_[u]===0;u--);if(l>u&&(l=u),u===0)return s[r++]=1<<24|64<<16|0,s[r++]=1<<24|64<<16|0,f.bits=1,0;for(U=1;U<u&&_[U]===0;U++);for(l<U&&(l=U),y=1,o=1;o<=M;o++)if(y<<=1,y-=_[o],y<0)return-1;if(y>0&&(t===ge||u!==1))return-1;for(A[1]=0,o=1;o<M;o++)A[o+1]=A[o]+_[o];for(c=0;c<i;c++)n[e+c]!==0&&(a[A[n[e+c]]++]=c);if(t===ge?(v=S=a,g=20):t===ee?(v=$t,S=Lt,g=257):(v=jt,S=qt,g=0),m=0,c=0,o=U,x=r,R=l,p=0,b=-1,w=1<<l,B=w-1,t===ee&&w>de||t===me&&w>ue)return 1;for(;;){N=o-p,a[c]+1<g?(O=0,Z=a[c]):a[c]>=g?(O=S[a[c]-g],Z=v[a[c]-g]):(O=96,Z=0),h=1<<o-p,d=1<<R,U=d;do d-=h,s[x+(m>>p)+d]=N<<24|O<<16|Z|0;while(d!==0);for(h=1<<o-1;m&h;)h>>=1;if(h!==0?(m&=h-1,m+=h):m=0,c++,--_[o]===0){if(o===u)break;o=n[e+a[c]]}if(o>l&&(m&B)!==b){for(p===0&&(p=l),x+=U,R=o-p,y=1<<R;R+p<u&&(y-=_[R+p],!(y<=0));)R++,y<<=1;if(w+=1<<R,t===ee&&w>de||t===me&&w>ue)return 1;b=m&B,s[b]=l<<24|R<<16|x-r|0}}return m!==0&&(s[x+m]=o-p<<24|64<<16|0),f.bits=l,0};var $=Kt;const Wt=0,Je=1,Qe=2,{Z_FINISH:be,Z_BLOCK:Gt,Z_TREES:K,Z_OK:F,Z_STREAM_END:Jt,Z_NEED_DICT:Qt,Z_STREAM_ERROR:D,Z_DATA_ERROR:Xe,Z_MEM_ERROR:Ye,Z_BUF_ERROR:Xt,Z_DEFLATED:we}=Ke,X=16180,ke=16181,pe=16182,ye=16183,_e=16184,xe=16185,ve=16186,Be=16187,Ue=16188,Re=16189,Q=16190,C=16191,te=16192,Ee=16193,ne=16194,Ae=16195,Se=16196,De=16197,Oe=16198,W=16199,G=16200,Te=16201,Ce=16202,Ie=16203,Ne=16204,Ze=16205,re=16206,Fe=16207,ze=16208,E=16209,et=16210,tt=16211,Yt=852,en=592,tn=15,nn=tn,Me=t=>(t>>>24&255)+(t>>>8&65280)+((t&65280)<<8)+((t&255)<<24);function rn(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const z=t=>{if(!t)return 1;const n=t.state;return!n||n.strm!==t||n.mode<X||n.mode>tt?1:0},nt=t=>{if(z(t))return D;const n=t.state;return t.total_in=t.total_out=n.total=0,t.msg="",n.wrap&&(t.adler=n.wrap&1),n.mode=X,n.last=0,n.havedict=0,n.flags=-1,n.dmax=32768,n.head=null,n.hold=0,n.bits=0,n.lencode=n.lendyn=new Int32Array(Yt),n.distcode=n.distdyn=new Int32Array(en),n.sane=1,n.back=-1,F},rt=t=>{if(z(t))return D;const n=t.state;return n.wsize=0,n.whave=0,n.wnext=0,nt(t)},st=(t,n)=>{let e;if(z(t))return D;const i=t.state;return n<0?(e=0,n=-n):(e=(n>>4)+5,n<48&&(n&=15)),n&&(n<8||n>15)?D:(i.window!==null&&i.wbits!==n&&(i.window=null),i.wrap=e,i.wbits=n,rt(t))},at=(t,n)=>{if(!t)return D;const e=new rn;t.state=e,e.strm=t,e.window=null,e.mode=X;const i=st(t,n);return i!==F&&(t.state=null),i},sn=t=>at(t,nn);let He=!0,se,ae;const an=t=>{if(He){se=new Int32Array(512),ae=new Int32Array(32);let n=0;for(;n<144;)t.lens[n++]=8;for(;n<256;)t.lens[n++]=9;for(;n<280;)t.lens[n++]=7;for(;n<288;)t.lens[n++]=8;for($(Je,t.lens,0,288,se,0,t.work,{bits:9}),n=0;n<32;)t.lens[n++]=5;$(Qe,t.lens,0,32,ae,0,t.work,{bits:5}),He=!1}t.lencode=se,t.lenbits=9,t.distcode=ae,t.distbits=5},ot=(t,n,e,i)=>{let s;const r=t.state;return r.window===null&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Uint8Array(r.wsize)),i>=r.wsize?(r.window.set(n.subarray(e-r.wsize,e),0),r.wnext=0,r.whave=r.wsize):(s=r.wsize-r.wnext,s>i&&(s=i),r.window.set(n.subarray(e-i,e-i+s),r.wnext),i-=s,i?(r.window.set(n.subarray(e-i,e),0),r.wnext=i,r.whave=r.wsize):(r.wnext+=s,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=s))),0},on=(t,n)=>{let e,i,s,r,a,f,k,o,c,U,u,l,R,p,y=0,w,m,h,d,b,B,x,v;const g=new Uint8Array(4);let _,A;const S=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(z(t)||!t.output||!t.input&&t.avail_in!==0)return D;e=t.state,e.mode===C&&(e.mode=te),a=t.next_out,s=t.output,k=t.avail_out,r=t.next_in,i=t.input,f=t.avail_in,o=e.hold,c=e.bits,U=f,u=k,v=F;e:for(;;)switch(e.mode){case X:if(e.wrap===0){e.mode=te;break}for(;c<16;){if(f===0)break e;f--,o+=i[r++]<<c,c+=8}if(e.wrap&2&&o===35615){e.wbits===0&&(e.wbits=15),e.check=0,g[0]=o&255,g[1]=o>>>8&255,e.check=T(e.check,g,2,0),o=0,c=0,e.mode=ke;break}if(e.head&&(e.head.done=!1),!(e.wrap&1)||(((o&255)<<8)+(o>>8))%31){t.msg="incorrect header check",e.mode=E;break}if((o&15)!==we){t.msg="unknown compression method",e.mode=E;break}if(o>>>=4,c-=4,x=(o&15)+8,e.wbits===0&&(e.wbits=x),x>15||x>e.wbits){t.msg="invalid window size",e.mode=E;break}e.dmax=1<<e.wbits,e.flags=0,t.adler=e.check=1,e.mode=o&512?Re:C,o=0,c=0;break;case ke:for(;c<16;){if(f===0)break e;f--,o+=i[r++]<<c,c+=8}if(e.flags=o,(e.flags&255)!==we){t.msg="unknown compression method",e.mode=E;break}if(e.flags&57344){t.msg="unknown header flags set",e.mode=E;break}e.head&&(e.head.text=o>>8&1),e.flags&512&&e.wrap&4&&(g[0]=o&255,g[1]=o>>>8&255,e.check=T(e.check,g,2,0)),o=0,c=0,e.mode=pe;case pe:for(;c<32;){if(f===0)break e;f--,o+=i[r++]<<c,c+=8}e.head&&(e.head.time=o),e.flags&512&&e.wrap&4&&(g[0]=o&255,g[1]=o>>>8&255,g[2]=o>>>16&255,g[3]=o>>>24&255,e.check=T(e.check,g,4,0)),o=0,c=0,e.mode=ye;case ye:for(;c<16;){if(f===0)break e;f--,o+=i[r++]<<c,c+=8}e.head&&(e.head.xflags=o&255,e.head.os=o>>8),e.flags&512&&e.wrap&4&&(g[0]=o&255,g[1]=o>>>8&255,e.check=T(e.check,g,2,0)),o=0,c=0,e.mode=_e;case _e:if(e.flags&1024){for(;c<16;){if(f===0)break e;f--,o+=i[r++]<<c,c+=8}e.length=o,e.head&&(e.head.extra_len=o),e.flags&512&&e.wrap&4&&(g[0]=o&255,g[1]=o>>>8&255,e.check=T(e.check,g,2,0)),o=0,c=0}else e.head&&(e.head.extra=null);e.mode=xe;case xe:if(e.flags&1024&&(l=e.length,l>f&&(l=f),l&&(e.head&&(x=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(i.subarray(r,r+l),x)),e.flags&512&&e.wrap&4&&(e.check=T(e.check,i,l,r)),f-=l,r+=l,e.length-=l),e.length))break e;e.length=0,e.mode=ve;case ve:if(e.flags&2048){if(f===0)break e;l=0;do x=i[r+l++],e.head&&x&&e.length<65536&&(e.head.name+=String.fromCharCode(x));while(x&&l<f);if(e.flags&512&&e.wrap&4&&(e.check=T(e.check,i,l,r)),f-=l,r+=l,x)break e}else e.head&&(e.head.name=null);e.length=0,e.mode=Be;case Be:if(e.flags&4096){if(f===0)break e;l=0;do x=i[r+l++],e.head&&x&&e.length<65536&&(e.head.comment+=String.fromCharCode(x));while(x&&l<f);if(e.flags&512&&e.wrap&4&&(e.check=T(e.check,i,l,r)),f-=l,r+=l,x)break e}else e.head&&(e.head.comment=null);e.mode=Ue;case Ue:if(e.flags&512){for(;c<16;){if(f===0)break e;f--,o+=i[r++]<<c,c+=8}if(e.wrap&4&&o!==(e.check&65535)){t.msg="header crc mismatch",e.mode=E;break}o=0,c=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),t.adler=e.check=0,e.mode=C;break;case Re:for(;c<32;){if(f===0)break e;f--,o+=i[r++]<<c,c+=8}t.adler=e.check=Me(o),o=0,c=0,e.mode=Q;case Q:if(e.havedict===0)return t.next_out=a,t.avail_out=k,t.next_in=r,t.avail_in=f,e.hold=o,e.bits=c,Qt;t.adler=e.check=1,e.mode=C;case C:if(n===Gt||n===K)break e;case te:if(e.last){o>>>=c&7,c-=c&7,e.mode=re;break}for(;c<3;){if(f===0)break e;f--,o+=i[r++]<<c,c+=8}switch(e.last=o&1,o>>>=1,c-=1,o&3){case 0:e.mode=Ee;break;case 1:if(an(e),e.mode=W,n===K){o>>>=2,c-=2;break e}break;case 2:e.mode=Se;break;case 3:t.msg="invalid block type",e.mode=E}o>>>=2,c-=2;break;case Ee:for(o>>>=c&7,c-=c&7;c<32;){if(f===0)break e;f--,o+=i[r++]<<c,c+=8}if((o&65535)!==(o>>>16^65535)){t.msg="invalid stored block lengths",e.mode=E;break}if(e.length=o&65535,o=0,c=0,e.mode=ne,n===K)break e;case ne:e.mode=Ae;case Ae:if(l=e.length,l){if(l>f&&(l=f),l>k&&(l=k),l===0)break e;s.set(i.subarray(r,r+l),a),f-=l,r+=l,k-=l,a+=l,e.length-=l;break}e.mode=C;break;case Se:for(;c<14;){if(f===0)break e;f--,o+=i[r++]<<c,c+=8}if(e.nlen=(o&31)+257,o>>>=5,c-=5,e.ndist=(o&31)+1,o>>>=5,c-=5,e.ncode=(o&15)+4,o>>>=4,c-=4,e.nlen>286||e.ndist>30){t.msg="too many length or distance symbols",e.mode=E;break}e.have=0,e.mode=De;case De:for(;e.have<e.ncode;){for(;c<3;){if(f===0)break e;f--,o+=i[r++]<<c,c+=8}e.lens[S[e.have++]]=o&7,o>>>=3,c-=3}for(;e.have<19;)e.lens[S[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,_={bits:e.lenbits},v=$(Wt,e.lens,0,19,e.lencode,0,e.work,_),e.lenbits=_.bits,v){t.msg="invalid code lengths set",e.mode=E;break}e.have=0,e.mode=Oe;case Oe:for(;e.have<e.nlen+e.ndist;){for(;y=e.lencode[o&(1<<e.lenbits)-1],w=y>>>24,m=y>>>16&255,h=y&65535,!(w<=c);){if(f===0)break e;f--,o+=i[r++]<<c,c+=8}if(h<16)o>>>=w,c-=w,e.lens[e.have++]=h;else{if(h===16){for(A=w+2;c<A;){if(f===0)break e;f--,o+=i[r++]<<c,c+=8}if(o>>>=w,c-=w,e.have===0){t.msg="invalid bit length repeat",e.mode=E;break}x=e.lens[e.have-1],l=3+(o&3),o>>>=2,c-=2}else if(h===17){for(A=w+3;c<A;){if(f===0)break e;f--,o+=i[r++]<<c,c+=8}o>>>=w,c-=w,x=0,l=3+(o&7),o>>>=3,c-=3}else{for(A=w+7;c<A;){if(f===0)break e;f--,o+=i[r++]<<c,c+=8}o>>>=w,c-=w,x=0,l=11+(o&127),o>>>=7,c-=7}if(e.have+l>e.nlen+e.ndist){t.msg="invalid bit length repeat",e.mode=E;break}for(;l--;)e.lens[e.have++]=x}}if(e.mode===E)break;if(e.lens[256]===0){t.msg="invalid code -- missing end-of-block",e.mode=E;break}if(e.lenbits=9,_={bits:e.lenbits},v=$(Je,e.lens,0,e.nlen,e.lencode,0,e.work,_),e.lenbits=_.bits,v){t.msg="invalid literal/lengths set",e.mode=E;break}if(e.distbits=6,e.distcode=e.distdyn,_={bits:e.distbits},v=$(Qe,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,_),e.distbits=_.bits,v){t.msg="invalid distances set",e.mode=E;break}if(e.mode=W,n===K)break e;case W:e.mode=G;case G:if(f>=6&&k>=258){t.next_out=a,t.avail_out=k,t.next_in=r,t.avail_in=f,e.hold=o,e.bits=c,Pt(t,u),a=t.next_out,s=t.output,k=t.avail_out,r=t.next_in,i=t.input,f=t.avail_in,o=e.hold,c=e.bits,e.mode===C&&(e.back=-1);break}for(e.back=0;y=e.lencode[o&(1<<e.lenbits)-1],w=y>>>24,m=y>>>16&255,h=y&65535,!(w<=c);){if(f===0)break e;f--,o+=i[r++]<<c,c+=8}if(m&&(m&240)===0){for(d=w,b=m,B=h;y=e.lencode[B+((o&(1<<d+b)-1)>>d)],w=y>>>24,m=y>>>16&255,h=y&65535,!(d+w<=c);){if(f===0)break e;f--,o+=i[r++]<<c,c+=8}o>>>=d,c-=d,e.back+=d}if(o>>>=w,c-=w,e.back+=w,e.length=h,m===0){e.mode=Ze;break}if(m&32){e.back=-1,e.mode=C;break}if(m&64){t.msg="invalid literal/length code",e.mode=E;break}e.extra=m&15,e.mode=Te;case Te:if(e.extra){for(A=e.extra;c<A;){if(f===0)break e;f--,o+=i[r++]<<c,c+=8}e.length+=o&(1<<e.extra)-1,o>>>=e.extra,c-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=Ce;case Ce:for(;y=e.distcode[o&(1<<e.distbits)-1],w=y>>>24,m=y>>>16&255,h=y&65535,!(w<=c);){if(f===0)break e;f--,o+=i[r++]<<c,c+=8}if((m&240)===0){for(d=w,b=m,B=h;y=e.distcode[B+((o&(1<<d+b)-1)>>d)],w=y>>>24,m=y>>>16&255,h=y&65535,!(d+w<=c);){if(f===0)break e;f--,o+=i[r++]<<c,c+=8}o>>>=d,c-=d,e.back+=d}if(o>>>=w,c-=w,e.back+=w,m&64){t.msg="invalid distance code",e.mode=E;break}e.offset=h,e.extra=m&15,e.mode=Ie;case Ie:if(e.extra){for(A=e.extra;c<A;){if(f===0)break e;f--,o+=i[r++]<<c,c+=8}e.offset+=o&(1<<e.extra)-1,o>>>=e.extra,c-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){t.msg="invalid distance too far back",e.mode=E;break}e.mode=Ne;case Ne:if(k===0)break e;if(l=u-k,e.offset>l){if(l=e.offset-l,l>e.whave&&e.sane){t.msg="invalid distance too far back",e.mode=E;break}l>e.wnext?(l-=e.wnext,R=e.wsize-l):R=e.wnext-l,l>e.length&&(l=e.length),p=e.window}else p=s,R=a-e.offset,l=e.length;l>k&&(l=k),k-=l,e.length-=l;do s[a++]=p[R++];while(--l);e.length===0&&(e.mode=G);break;case Ze:if(k===0)break e;s[a++]=e.length,k--,e.mode=G;break;case re:if(e.wrap){for(;c<32;){if(f===0)break e;f--,o|=i[r++]<<c,c+=8}if(u-=k,t.total_out+=u,e.total+=u,e.wrap&4&&u&&(t.adler=e.check=e.flags?T(e.check,s,u,a-u):le(e.check,s,u,a-u)),u=k,e.wrap&4&&(e.flags?o:Me(o))!==e.check){t.msg="incorrect data check",e.mode=E;break}o=0,c=0}e.mode=Fe;case Fe:if(e.wrap&&e.flags){for(;c<32;){if(f===0)break e;f--,o+=i[r++]<<c,c+=8}if(e.wrap&4&&o!==(e.total&4294967295)){t.msg="incorrect length check",e.mode=E;break}o=0,c=0}e.mode=ze;case ze:v=Jt;break e;case E:v=Xe;break e;case et:return Ye;case tt:default:return D}return t.next_out=a,t.avail_out=k,t.next_in=r,t.avail_in=f,e.hold=o,e.bits=c,(e.wsize||u!==t.avail_out&&e.mode<E&&(e.mode<re||n!==be))&&ot(t,t.output,t.next_out,u-t.avail_out),U-=t.avail_in,u-=t.avail_out,t.total_in+=U,t.total_out+=u,e.total+=u,e.wrap&4&&u&&(t.adler=e.check=e.flags?T(e.check,s,u,t.next_out-u):le(e.check,s,u,t.next_out-u)),t.data_type=e.bits+(e.last?64:0)+(e.mode===C?128:0)+(e.mode===W||e.mode===ne?256:0),(U===0&&u===0||n===be)&&v===F&&(v=Xt),v},cn=t=>{if(z(t))return D;let n=t.state;return n.window&&(n.window=null),t.state=null,F},ln=(t,n)=>{if(z(t))return D;const e=t.state;return(e.wrap&2)===0?D:(e.head=n,n.done=!1,F)},fn=(t,n)=>{const e=n.length;let i,s,r;return z(t)||(i=t.state,i.wrap!==0&&i.mode!==Q)?D:i.mode===Q&&(s=1,s=le(s,n,e,0),s!==i.check)?Xe:(r=ot(t,n,e,e),r?(i.mode=et,Ye):(i.havedict=1,F))};var hn=rt,dn=st,un=nt,gn=sn,mn=at,bn=on,wn=cn,kn=ln,pn=fn,yn="pako inflate (from Nodeca project)",I={inflateReset:hn,inflateReset2:dn,inflateResetKeep:un,inflateInit:gn,inflateInit2:mn,inflate:bn,inflateEnd:wn,inflateGetHeader:kn,inflateSetDictionary:pn,inflateInfo:yn};function _n(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var xn=_n;const it=Object.prototype.toString,{Z_NO_FLUSH:vn,Z_FINISH:Bn,Z_OK:j,Z_STREAM_END:oe,Z_NEED_DICT:ie,Z_STREAM_ERROR:Un,Z_DATA_ERROR:Ve,Z_MEM_ERROR:Rn}=Ke;function Y(t){this.options=We.assign({chunkSize:1024*64,windowBits:15,to:""},t||{});const n=this.options;n.raw&&n.windowBits>=0&&n.windowBits<16&&(n.windowBits=-n.windowBits,n.windowBits===0&&(n.windowBits=-15)),n.windowBits>=0&&n.windowBits<16&&!(t&&t.windowBits)&&(n.windowBits+=32),n.windowBits>15&&n.windowBits<48&&(n.windowBits&15)===0&&(n.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ht,this.strm.avail_out=0;let e=I.inflateInit2(this.strm,n.windowBits);if(e!==j)throw new Error(fe[e]);if(this.header=new xn,I.inflateGetHeader(this.strm,this.header),n.dictionary&&(typeof n.dictionary=="string"?n.dictionary=he.string2buf(n.dictionary):it.call(n.dictionary)==="[object ArrayBuffer]"&&(n.dictionary=new Uint8Array(n.dictionary)),n.raw&&(e=I.inflateSetDictionary(this.strm,n.dictionary),e!==j)))throw new Error(fe[e])}Y.prototype.push=function(t,n){const e=this.strm,i=this.options.chunkSize,s=this.options.dictionary;let r,a,f;if(this.ended)return!1;for(n===~~n?a=n:a=n===!0?Bn:vn,it.call(t)==="[object ArrayBuffer]"?e.input=new Uint8Array(t):e.input=t,e.next_in=0,e.avail_in=e.input.length;;){for(e.avail_out===0&&(e.output=new Uint8Array(i),e.next_out=0,e.avail_out=i),r=I.inflate(e,a),r===ie&&s&&(r=I.inflateSetDictionary(e,s),r===j?r=I.inflate(e,a):r===Ve&&(r=ie));e.avail_in>0&&r===oe&&e.state.wrap>0&&t[e.next_in]!==0;)I.inflateReset(e),r=I.inflate(e,a);switch(r){case Un:case Ve:case ie:case Rn:return this.onEnd(r),this.ended=!0,!1}if(f=e.avail_out,e.next_out&&(e.avail_out===0||r===oe))if(this.options.to==="string"){let k=he.utf8border(e.output,e.next_out),o=e.next_out-k,c=he.buf2string(e.output,k);e.next_out=o,e.avail_out=i-o,o&&e.output.set(e.output.subarray(k,k+o),0),this.onData(c)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(!(r===j&&f===0)){if(r===oe)return r=I.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(e.avail_in===0)break}}return!0};Y.prototype.onData=function(t){this.chunks.push(t)};Y.prototype.onEnd=function(t){t===j&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=We.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function En(t,n){const e=new Y(n);if(e.push(t),e.err)throw e.msg||fe[e.err];return e.result}function An(t,n){return n=n||{},n.raw=!0,En(t,n)}var Sn=An,Dn={inflateRaw:Sn};const{inflateRaw:On}=Dn;var Tn=On;function Cn(t){return Tn(t.subarray(2))}class In extends Error{constructor(n){super(n),this.code="ERR_ABORTED"}}function Nn(t){t.sort((s,r)=>s.offset-r.offset);const n=[];let e,i;for(const s of t)e&&i&&s.offset-i<=2e3?(e.length=e.length+s.length-i+s.offset,e.blocks.push(s)):n.push(e={blocks:[s],length:s.length,offset:s.offset}),i=e.offset+e.length;return n}function J(t){if(t&&t.aborted)if(typeof DOMException>"u"){const n=new In("aborted");throw n.code="ERR_ABORTED",n}else throw new DOMException("aborted","AbortError")}const Pe=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function ce(t,n,e,i){return t<i&&n>=e}class Zn{constructor(n,e,i,s,r){if(this.bbi=n,this.refsByName=e,this.cirTreeOffset=i,this.isCompressed=s,this.blockType=r,this.featureCache=new lt({cache:new ht({maxSize:1e3}),fill:async({length:a,offset:f},k)=>this.bbi.read(a,f,{signal:k})}),!(i>=0))throw new Error("invalid cirTreeOffset!")}async readWigData(n,e,i,s,r){try{const a=this.refsByName[n];a===void 0&&s.complete();const f={chrId:a,start:e,end:i};this.cirTreePromise||(this.cirTreePromise=this.bbi.read(48,this.cirTreeOffset,r));const k=await this.cirTreePromise,o=new DataView(k.buffer).getUint32(4,!0);let c=[],U=0;const u=(y,w,m)=>{try{const h=y.subarray(w),d=new DataView(h.buffer,h.byteOffset,h.length);let b=0;const B=d.getUint8(b);b+=2;const x=d.getUint16(b,!0);if(b+=2,B===1){const v=[];for(let g=0;g<x;g++){const _=d.getUint32(b,!0);b+=4;const A=d.getUint32(b,!0);b+=4;const S=d.getUint32(b,!0);b+=4;const N=d.getUint32(b,!0);b+=4;const O=Number(d.getBigUint64(b,!0));b+=8;const Z=Number(d.getBigUint64(b,!0));b+=8,v.push({startChrom:_,startBase:A,endBase:N,endChrom:S,blockOffset:O,blockSize:Z,offset:b})}c=c.concat(v.filter(g=>l(g)).map(g=>({offset:g.blockOffset,length:g.blockSize})))}else if(B===0){const v=[];for(let _=0;_<x;_++){const A=d.getUint32(b,!0);b+=4;const S=d.getUint32(b,!0);b+=4;const N=d.getUint32(b,!0);b+=4;const O=d.getUint32(b,!0);b+=4;const Z=Number(d.getBigUint64(b,!0));b+=8,v.push({startChrom:A,startBase:S,endChrom:N,endBase:O,blockOffset:Z,offset:b})}const g=v.filter(_=>l(_)).map(_=>_.blockOffset);g.length>0&&p(g,m+1)}}catch(h){s.error(h)}},l=y=>{const{startChrom:w,startBase:m,endChrom:h,endBase:d}=y;return(w<a||w===a&&m<=i)&&(h>a||h===a&&d>=e)},R=async(y,w,m)=>{try{const h=w.max-w.min,d=w.min,b=await this.featureCache.get(`${h}_${d}`,{length:h,offset:d},r==null?void 0:r.signal);for(const B of y)w.contains(B)&&(u(b,B-d,m),U-=1,U===0&&this.readFeatures(s,c,{...r,request:f}).catch(x=>{s.error(x)}))}catch(h){s.error(h)}},p=(y,w)=>{try{U+=y.length;const m=4+o*32;let h=new V([{min:y[0],max:y[0]+m}]);for(let d=1;d<y.length;d+=1){const b=new V([{min:y[d],max:y[d]+m}]);h=h.union(b)}h.getRanges().map(d=>R(y,d,w))}catch(m){s.error(m)}};p([Number(this.cirTreeOffset)+48],1);return}catch(a){s.error(a)}}parseSummaryBlock(n,e,i){const s=[];let r=e;const a=new DataView(n.buffer,n.byteOffset,n.length);for(;r<n.byteLength;){const f=a.getUint32(r,!0);r+=4;const k=a.getUint32(r,!0);r+=4;const o=a.getUint32(r,!0);r+=4;const c=a.getUint32(r,!0);r+=4;const U=a.getFloat32(r,!0);r+=4;const u=a.getFloat32(r,!0);r+=4;const l=a.getFloat32(r,!0);r+=4,r+=4,(!i||f===i.chrId&&ce(k,o,i.start,i.end))&&s.push({start:k,end:o,maxScore:u,minScore:U,summary:!0,score:l/(c||1)})}return s}parseBigBedBlock(n,e,i,s){const r=[];let a=e;const f=n,k=new DataView(f.buffer,f.byteOffset,f.length);for(;a<n.byteLength;){const o=a,c=k.getUint32(a,!0);a+=4;const U=k.getInt32(a,!0);a+=4;const u=k.getInt32(a,!0);a+=4;let l=a;for(;l<n.length&&n[l]!==0;l++);const R=n.subarray(a,l),p=(Pe==null?void 0:Pe.decode(R))??R.toString();a=l+1,r.push({chromId:c,start:U,end:u,rest:p,uniqueId:`bb-${i+o}`})}return s?r.filter(o=>ce(o.start,o.end,s.start,s.end)):r}parseBigWigBlock(n,e,i){const s=n.subarray(e),r=new DataView(s.buffer,s.byteOffset,s.length);let a=0;a+=4;const f=r.getInt32(a,!0);a+=8;const k=r.getUint32(a,!0);a+=4;const o=r.getUint32(a,!0);a+=4;const c=r.getUint8(a);a+=2;const U=r.getUint16(a,!0);a+=2;const u=new Array(U);switch(c){case 1:{for(let l=0;l<U;l++){const R=r.getInt32(a,!0);a+=4;const p=r.getInt32(a,!0);a+=4;const y=r.getFloat32(a,!0);a+=4,u[l]={start:R,end:p,score:y}}break}case 2:{for(let l=0;l<U;l++){const R=r.getInt32(a,!0);a+=4;const p=r.getFloat32(a,!0);a+=4,u[l]={score:p,start:R,end:R+o}}break}case 3:{for(let l=0;l<U;l++){const R=r.getFloat32(a,!0);a+=4;const p=f+l*k;u[l]={score:R,start:p,end:p+o}}break}}return i?u.filter(l=>ce(l.start,l.end,i.start,i.end)):u}async readFeatures(n,e,i={}){try{const{blockType:s,isCompressed:r}=this,{signal:a,request:f}=i,k=Nn(e);J(a),await Promise.all(k.map(async o=>{J(a);const{length:c,offset:U}=o,u=await this.featureCache.get(`${c}_${U}`,o,a);for(const l of o.blocks){J(a);let R=u.subarray(Number(l.offset)-Number(o.offset));switch(r&&(R=Cn(R)),J(a),s){case"summary":{n.next(this.parseSummaryBlock(R,0,f));break}case"bigwig":{n.next(this.parseBigWigBlock(R,0,f));break}case"bigbed":{n.next(this.parseBigBedBlock(R,0,Number(l.offset)*256,f));break}default:console.warn(`Don't know what to do with ${s}`)}}})),n.complete()}catch(s){n.error(s)}}}const Fn=-2003829722,$e=-2021002517;function H(t){return new DataView(t.buffer,t.byteOffset,t.length)}class $n{getHeader(n){return this.headerP||(this.headerP=this._getHeader(n).catch(e=>{throw this.headerP=void 0,e})),this.headerP}constructor(n){const{filehandle:e,renameRefSeqs:i=a=>a,path:s,url:r}=n;if(this.renameRefSeqs=i,e)this.bbi=e;else if(r)this.bbi=new ft(r);else if(s)this.bbi=new ct(s);else throw new Error("no file given")}async _getHeader(n){const e=await this._getMainHeader(n),i=await this._readChromTree(e,n);return{...e,...i}}async _getMainHeader(n,e=2e3){const i=await this.bbi.read(e,0,n),s=H(i),r=s.getInt32(0,!0);if(r!==Fn&&r!==$e)throw new Error("not a BigWig/BigBed file");let a=0;const f=s.getInt32(a,!0);a+=4;const k=s.getUint16(a,!0);a+=2;const o=s.getUint16(a,!0);a+=2;const c=Number(s.getBigUint64(a,!0));a+=8;const U=Number(s.getBigUint64(a,!0));a+=8;const u=Number(s.getBigUint64(a,!0));a+=8;const l=s.getUint16(a,!0);a+=2;const R=s.getUint16(a,!0);a+=2;const p=Number(s.getBigUint64(a,!0));a+=8;const y=Number(s.getBigUint64(a,!0));a+=8;const w=s.getUint32(a,!0);a+=4;const m=Number(s.getBigUint64(a,!0));a+=8;const h=[];for(let x=0;x<o;x++){const v=s.getUint32(a,!0);a+=4;const g=s.getUint32(a,!0);a+=4;const _=Number(s.getBigUint64(a,!0));a+=8;const A=Number(s.getBigUint64(a,!0));a+=8,h.push({reductionLevel:v,reserved:g,dataOffset:_,indexOffset:A})}const d=f===$e?"bigbed":"bigwig";if(p>e||y>e-40)return this._getMainHeader(n,e*2);let b;if(y){const x=i.subarray(Number(y));let v=0;const g=H(x),_=Number(g.getBigUint64(v,!0));v+=8;const A=g.getFloat64(v,!0);v+=8;const S=g.getFloat64(v,!0);v+=8;const N=g.getFloat64(v,!0);v+=8;const O=g.getFloat64(v,!0);v+=8,b={scoreMin:A,scoreMax:S,scoreSum:N,scoreSumSquares:O,basesCovered:_}}else throw new Error("no stats");const B=new TextDecoder("utf8");return{zoomLevels:h,magic:f,extHeaderOffset:m,numZoomLevels:o,fieldCount:l,totalSummary:b,definedFieldCount:R,uncompressBufSize:w,asOffset:p,chromTreeOffset:c,totalSummaryOffset:y,unzoomedDataOffset:U,unzoomedIndexOffset:u,fileType:d,version:k,autoSql:p?B.decode(i.subarray(p,i.indexOf(0,p))):""}}async _readChromTree(n,e){const i=[],s={},r=Number(n.chromTreeOffset),a=H(await this.bbi.read(32,r,e));let f=0;f+=4,f+=4;const k=a.getUint32(f,!0);f+=4;const o=a.getUint32(f,!0);f+=4,f+=8;const c=new TextDecoder("utf8"),U=async u=>{const l=await this.bbi.read(4,u),R=H(l);let p=0;const y=R.getUint8(p);p+=1,p+=1;const w=R.getUint16(p,!0);if(p+=2,y){const m=await this.bbi.read(w*(k+o),u+p),h=H(m);p=0;for(let d=0;d<w;d++){const b=c.decode(m.subarray(p,p+k)).replaceAll("\0","");p+=k;const B=h.getUint32(p,!0);p+=4;const x=h.getUint32(p,!0);p+=4,s[this.renameRefSeqs(b)]=B,i[B]={name:b,id:B,length:x}}}else{const m=[],h=H(await this.bbi.read(w*(k+8),u+p));p=0;for(let d=0;d<w;d++){p+=k;const b=Number(h.getBigUint64(p,!0));p+=8,m.push(U(b))}await Promise.all(m)}};return await U(r+32),{refsByName:s,refsByNumber:i}}async getUnzoomedView(n){const{unzoomedIndexOffset:e,refsByName:i,uncompressBufSize:s,fileType:r}=await this.getHeader(n);return new Zn(this.bbi,i,e,s>0,r)}async getFeatureStream(n,e,i,s){await this.getHeader(s);const r=this.renameRefSeqs(n);let a;const{basesPerSpan:f,scale:k}=s||{};return f?a=await this.getView(1/f,s):k?a=await this.getView(k,s):a=await this.getView(1,s),new dt(o=>{a.readWigData(r,e,i,o,s).catch(c=>{o.error(c)})})}async getFeatures(n,e,i,s){const r=await this.getFeatureStream(n,e,i,s);return(await ut(r.pipe(gt()))).flat()}}export{Zn as M,$n as P};
