import{e as q}from"./index-Bp4pXTEU-Cipcrd2k.js";import{$ as y,a0 as D,u as S,O as E}from"./JBrowsePanel-CjeUdi3D-Dhrr89W5.js";import{o as $}from"./rxjs-euq-mp90-DvajfGj-.js";import"./index-Bwk-R6QR.js";import"./taxonium-component.es-D8UFPkMd.js";class O extends q.BaseFeatureDataAdapter{constructor(){super(...arguments),this.gcMode="content"}async configure(){var r;const u=await((r=this.getSubAdapter)===null||r===void 0?void 0:r.call(this,this.getConf("sequenceAdapter")));if(!u)throw new Error("Error getting subadapter");return u.dataAdapter}async getRefNames(r){return(await this.configure()).getRefNames(r)}getFeatures(r,u){const{statusCallback:b=()=>{},stopToken:k}=u||{};return $.ObservableCreate(async d=>{var h;const x=await this.configure(),n=this.getConf("windowSize"),p=this.getConf("windowDelta"),e=n===1?1:Math.ceil(n/2),G=n===1,m=Math.max(0,Math.floor((r.start-e)/n)*n),w=Math.ceil((r.end+e)/n)*n;if(w<0||m>w){d.complete();return}const i=((h=(await y(x.getFeatures({...r,start:m,end:w},u).pipe(D())))[0])===null||h===void 0?void 0:h.get("seq"))||"";await S.updateStatus("Calculating GC",b,()=>{let c=0,l=0,g=0,C=performance.now();const M=e;for(let t=M-e;t<M+e;t++){const s=i[t];s==="c"||s==="C"?c++:(s==="g"||s==="G")&&l++,s!=="N"&&g++}for(let t=e;t<i.length-e;t+=p){if(performance.now()-C>400&&(E.checkStopToken(k),C=performance.now()),G){const f=i[t];c=f==="c"||f==="C"?1:0,l=f==="g"||f==="G"?1:0,g=f!=="N"?1:0}else if(t>e){const f=t-p-e,N=t-p+e,v=t-e,A=t+e;for(let a=f;a<Math.min(N,v);a++)if(a>=0&&a<i.length){const o=i[a];o==="c"||o==="C"?c--:(o==="g"||o==="G")&&l--,o!=="N"&&g--}for(let a=Math.max(N,v);a<A;a++)if(a>=0&&a<i.length){const o=i[a];o==="c"||o==="C"?c++:(o==="g"||o==="G")&&l++,o!=="N"&&g++}}const s=m,F=this.gcMode==="content"?(l+c)/(g||1):this.gcMode==="skew"?(l-c)/(l+c||1):0;d.next(new S.SimpleFeature({uniqueId:`${this.id}_${s+t}`,refName:r.refName,start:s+t,end:s+t+p,score:F}))}}),d.complete()})}}O.capabilities=["hasLocalStats"];export{O as default};
