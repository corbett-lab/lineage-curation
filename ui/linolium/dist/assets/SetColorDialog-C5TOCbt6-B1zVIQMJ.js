import{r as j,j as e}from"./index-Bwk-R6QR.js";import{x as F}from"./DraggableDialog-CDUQSgiK-DXKKLHfz.js";import{m as S,u as C,D as O,B as h,d as E,T as L,a as N,c as T,aZ as R,ap as G,aq as I,ar as P,as as W}from"./JBrowsePanel-CjeUdi3D-Dhrr89W5.js";import{e as Y}from"./util-B1Sm35mH-zsEGfboc.js";import{t as A,c as B}from"./ColorPicker-DfV0rLc1-CT4FsxiE.js";import{H as D}from"./DataGrid-CtzhbUAR-B5avypAp.js";import"./taxonium-component.es-D8UFPkMd.js";import"./getThemeProps-VQY9obTE-DyGMZP3D.js";import"./FormControlLabel-t1db3bCW-BhUWxcLA.js";import"./MenuItem-bcu4bG3--CNW0nWZm.js";import"./dividerClasses-CVTzPOoo-DLNaoCl0.js";import"./Divider-DzCbFD9M-BaKdmFVz.js";import"./Badge-DesLZhxI-BI0lVxgb.js";import"./TableCell-mfS6Ut2J-N_4-_qc3.js";import"./Checkbox-DRfuV2d3-Bnouab3n.js";const V=S()({textAreaFont:{fontFamily:"Courier New"}});function Z({onClose:t,currLayout:o}){const{classes:r}=V(),[s,l]=j.useState(""),[i,n]=j.useState();return e.jsxs(e.Fragment,{children:[e.jsxs(O,{children:[e.jsx(L,{children:'Paste CSV or TSV. If a header column is present. First line is a header. If a column called "name" is present, it uses that to connect to IDs in the table, otherwise it uses the first column no.'}),i?e.jsx(N.ErrorMessage,{error:i}):null,e.jsx(T,{variant:"outlined",multiline:!0,minRows:5,placeholder:`name,population
HG00098,GBR
HG00101,GBR
HG00459,CHS
...`,maxRows:10,fullWidth:!0,value:s,onChange:a=>{l(a.target.value)},slotProps:{input:{classes:{input:r.textAreaFont}}}})]}),e.jsxs(E,{children:[e.jsx(h,{variant:"contained",color:"secondary",onClick:()=>{const a=s.split(`
`).map(u=>u.trim()).filter(u=>!!u),m=a[0].split(/[,\t]/gm);if(m.includes("name")){n("");const u=Object.fromEntries(o.map(c=>[c.name,c])),p=Object.fromEntries(a.slice(1).map(c=>{const w=c.split(/[,\t]/gm),d=Object.fromEntries(w.map((x,f)=>[m[f],x]));return[d.name,{...d,...u[d.name]}]}));t(o.map(c=>({...c,...p[c.name]})))}else n(new Error('No "name" column found on line 1'))},children:"Update rows"}),e.jsx(h,{variant:"contained",color:"primary",onClick:()=>{const a=s.split(`
`).map(u=>u.trim()).filter(u=>!!u),m=a[0].split(/[,\t]/gm);if(m.includes("name")){n("");const u=Object.fromEntries(o.map(c=>[c.name,c])),p=Object.fromEntries(a.slice(1).map(c=>{const w=c.split(/[,\t]/gm),d=Object.fromEntries(w.map((x,f)=>[m[f],x]));return[d.name,{...d,...u[d.name]}]}));t(o.map(c=>({...p[c.name]})))}else n(new Error('No "name" column found on line 1'))},children:"Replace rows"}),e.jsx(h,{variant:"contained",color:"inherit",onClick:()=>{t()},children:"Cancel"})]})]})}function q(){return e.jsxs(e.Fragment,{children:["Helpful tips",e.jsxs("ul",{children:[e.jsx("li",{children:"You can select rows in the table with the checkboxes"}),e.jsx("li",{children:"Multi-select is enabled with shift-click and control-click"}),e.jsx("li",{children:'The "Move selected items up/down" can re-arrange subtracks'}),e.jsx("li",{children:"Sorting the data grid itself can also re-arrange subtracks"}),e.jsx("li",{children:"Changes are applied when you hit Submit"}),e.jsx("li",{children:"You can click and drag the dialog box to move it on the screen"}),e.jsx("li",{children:"Columns in the table can be hidden using a vertical '...' menu on the right side of each column"})]})]})}function z({setCurrLayout:t,currLayout:o}){var r;return e.jsxs("div",{children:["Create color palette based on...",Object.keys((r=o[0])!==null&&r!==void 0?r:[]).filter(s=>s!=="name"&&s!=="color"&&s!=="label"&&s!=="id"&&s!=="HP").map(s=>e.jsx(h,{variant:"contained",color:"inherit",onClick:()=>{const l=new Map;for(const n of o){const a=l.get(n[s]);a?l.set(n[s],a+1):l.set(n[s],1)}const i=Object.fromEntries([...l.entries()].sort((n,a)=>n[1]-a[1]).map((n,a)=>[n[0],R.set1[a]||Y(n[0])]));t(o.map(n=>({...n,color:i[n[s]]})))},children:s},s)),e.jsx(h,{onClick:()=>{t(o.map(s=>({...s,color:void 0})))},children:"Clear colors"})]})}const J=S()({cell:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}});function Q({rows:t,onChange:o,setSelected:r}){const{classes:s}=J(),{id:l,name:i,label:n,color:a,baseUri:m,HP:u,...p}=t[0],[c,w]=j.useState({idx:0,field:null});return e.jsx("div",{style:{height:400,width:"100%"},children:e.jsx(D,{checkboxSelection:!0,disableRowSelectionOnClick:!0,onRowSelectionModelChange:d=>{r([...d.ids])},rows:t,rowHeight:25,columnHeaderHeight:33,columns:[{field:"color",headerName:"Color",renderCell:d=>{const{value:x,id:f}=d;return e.jsx(B,{color:x||"blue",onChange:g=>{const b=t.find(v=>v.name===f);b&&(b.color=g),o([...t])}})}},{field:"label",headerName:"Name",width:C.measureGridWidth(t.map(d=>d.label))},...Object.keys(p).map(d=>({field:d,renderCell:({value:x})=>e.jsx("div",{className:s.cell,children:e.jsx(N.SanitizedHTML,{html:C.getStr(x)})}),width:C.measureGridWidth(t.map(x=>`${x[d]}`))}))],sortModel:[],onSortModelChange:d=>{const x=d[0],f=(c.idx+1)%2,g=x.field||c.field;w({idx:f,field:g}),o(g?[...t].sort((b,v)=>{const k=C.getStr(b[g]),y=C.getStr(v[g]);return f===1?k.localeCompare(y):y.localeCompare(k)}):t)}})})}function M(t,o,r=1){const s=o.map(i=>t.findIndex(n=>n.name===i)).sort((i,n)=>i-n);let l=0;for(const i of s){const n=Math.max(l,i-r);n>=l&&t.splice(n,0,t.splice(i,1)[0]),l=l+1}return t}function H(t,o,r=1){const s=o.map(i=>t.findIndex(n=>n.name===i)).sort((i,n)=>n-i);let l=t.length-1;for(const i of s){const n=Math.min(l,i+r);n<=l&&t.splice(n,0,t.splice(i,1)[0]),l=l-1}return t}function U({selected:t,onChange:o,rows:r,showTips:s}){const[l,i]=j.useState(null),[n,a]=j.useState("blue");return e.jsxs(e.Fragment,{children:[e.jsx(h,{disabled:!t.length,onClick:m=>{i(m.currentTarget)},children:"Change color of selected items"}),e.jsxs(h,{onClick:()=>{o(M([...r],t))},disabled:!t.length,children:[e.jsx(G,{}),s?"Move selected items up":null]}),e.jsxs(h,{onClick:()=>{o(H([...r],t))},disabled:!t.length,children:[e.jsx(I,{}),s?"Move selected items down":null]}),e.jsxs(h,{onClick:()=>{o(M([...r],t,r.length))},disabled:!t.length,children:[e.jsx(P,{}),s?"Move selected items to top":null]}),e.jsxs(h,{onClick:()=>{o(H([...r],t,r.length))},disabled:!t.length,children:[e.jsx(W,{}),s?"Move selected items to bottom":null]}),e.jsx(A.ColorPopover,{anchorEl:l,color:n,onChange:m=>{a(m);for(const u of t){const p=r.find(c=>c.name===u);p&&(p.color=m)}o([...r])},onClose:()=>{i(null)}})]})}function X({rows:t,onChange:o,showTips:r}){const[s,l]=j.useState([]);return e.jsxs("div",{children:[e.jsx(U,{selected:s,rows:t,showTips:r,onChange:o}),t.length?e.jsx(Q,{rows:t,onChange:o,setSelected:l}):e.jsx("div",{children:"No rows"})]})}const K=S()({content:{minWidth:800},fr:{float:"right",display:"flex",gap:8},textAreaFont:{fontFamily:"Courier New"}});function he({model:t,handleClose:o}){const{classes:r}=K(),{sources:s}=t,[l,i]=j.useState(!1),[n,a]=j.useState(s||[]),[m,u]=C.useLocalStorage("multivariant-showTips",!1);return e.jsx(F,{open:!0,onClose:o,maxWidth:"xl",title:"Multi-sample variant display - Color/arrangement editor",children:l?e.jsx(Z,{currLayout:n,onClose:p=>{p&&a(p),i(!1)}}):e.jsxs(e.Fragment,{children:[e.jsxs(O,{className:r.content,children:[e.jsxs("div",{className:r.fr,children:[e.jsx(h,{variant:"contained",onClick:()=>{u(!m)},children:m?"Hide tips":"Show tips"}),e.jsx(h,{color:"secondary",variant:"contained",onClick:()=>{i(!l)},children:"Show Bulk row editor"})]}),m?e.jsx(q,{}):null,e.jsx("br",{}),e.jsx(z,{currLayout:n,setCurrLayout:a}),e.jsx(X,{rows:n,onChange:a,showTips:m})]}),e.jsxs(E,{children:[e.jsx(h,{variant:"contained",type:"submit",color:"inherit",onClick:()=>{t.clearLayout(),a(t.sources||[])},children:"Clear custom settings"}),e.jsx(h,{variant:"contained",color:"secondary",onClick:()=>{o(),a([...t.sources||[]])},children:"Cancel"}),e.jsx(h,{variant:"contained",color:"primary",type:"submit",onClick:()=>{t.setLayout(n),o()},children:"Submit"})]})]})})}export{he as default};
