import{s as c,ad as y,O as P,u as S,ag as T}from"./JBrowsePanel-CjeUdi3D-Dhrr89W5.js";import"./index-Bwk-R6QR.js";import"./taxonium-component.es-D8UFPkMd.js";const k=.3,x=2;function Z(r,I){const{stopToken:d,features:u,regions:N,bpPerPx:m,scaleOpts:t,height:i,config:n}=I,b=N[0],V=c.readConfObject(n,"bicolorPivot"),R=c.readConfObject(n,"bicolorPivotValue"),F=c.readConfObject(n,"negColor"),g=c.readConfObject(n,"posColor"),M=c.readConfObject(n,"color"),A=c.readConfObject(n,"clipColor"),C=V!=="none"&&t.scaleType!=="log",D=y({...t,pivotValue:C?R:void 0,range:C?[F,"#eee",g]:["#eee",g]}),E=y({...t,range:[0,i]}),Y=M==="#f0f"?(o,e)=>D(e):(o,e)=>c.readConfObject(n,"color",{feature:o,score:e}),O=E.domain(),h=O[0],v=O[1];let j=Number.NEGATIVE_INFINITY,p=!1;const w=[];let l=performance.now();for(const o of u.values()){performance.now()-l>400&&(P.checkStopToken(d),l=performance.now());const[e,s]=S.featureSpanPx(o,b,m);(Math.floor(e)!==Math.floor(j)||s-e>1)&&(w.push(o),j=e);const a=o.get("score");p=p||a>v||a<h;const f=s-e+k;a>=t.domain[0]?(r.fillStyle=Y(o,a),r.fillRect(e,0,f,i)):(r.fillStyle="#eee",r.fillRect(e,0,f,i))}if(r.save(),p){r.fillStyle=A;for(const o of u.values()){performance.now()-l>400&&(P.checkStopToken(d),l=performance.now());const[e,s]=S.featureSpanPx(o,b,m),a=s-e+k,f=o.get("score");f>v?T(e,0,a,x,r):f<h&&t.scaleType!=="log"&&T(e,0,a,x,r)}}return r.restore(),{reducedFeatures:w}}export{Z as drawDensity};
