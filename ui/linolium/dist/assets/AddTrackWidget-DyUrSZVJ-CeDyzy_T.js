import{r as d,j as t}from"./index-Bwk-R6QR.js";import{o as k,u as c,bb as I,bA as W,bT as U,m as j,a as f,c as v,B as S,bD as F,T as b,t as J,bE as M,P,bR as L,bS as C,an as $,bG as A,a4 as D,bp as G}from"./JBrowsePanel-CjeUdi3D-Dhrr89W5.js";import{J as N}from"./MenuItem-bcu4bG3--CNW0nWZm.js";import{r as R}from"./Delete-DSU0jSiU-1j-ZpVRl.js";import{T as q,U as H}from"./CardContent-Di2YOEAl-B4_V9uGq.js";import{a as E}from"./ListItem-BegJmGel-CD2nrZTw.js";import{F as Y}from"./FormControlLabel-t1db3bCW-BhUWxcLA.js";import{X as K}from"./Checkbox-DRfuV2d3-Bnouab3n.js";import{E as Q,i as X,K as z,O as V}from"./Stepper-GjK3tLw3-DuPmd5oe.js";import"./taxonium-component.es-D8UFPkMd.js";import"./dividerClasses-CVTzPOoo-DLNaoCl0.js";import"./Collapse-BxSvw4ja-BFsBk1wj.js";const Z=j()(e=>({spacing:{marginBottom:e.spacing(3)}}));function _({trackAdapter:e,trackType:a}){const{classes:r}=Z(),{type:s,subadapter:n}=e;return s==="SNPCoverageAdapter"?t.jsxs(b,{className:r.spacing,children:["Selected ",t.jsx("code",{children:a}),". Using adapter ",t.jsx("code",{children:s})," with subadapter ",t.jsx("code",{children:n==null?void 0:n.type}),". Please enter a track name and, if necessary, update the track type."]}):t.jsxs(b,{className:r.spacing,children:["Using adapter ",t.jsx("code",{children:s})," and guessing track type"," ",t.jsx("code",{children:a}),". Please enter a track name and, if necessary, update the track type."]})}function ee(e){var a;const r={};for(const s of e){const n=((a=s.adapterMetadata)===null||a===void 0?void 0:a.category)||"Default";r[n]||(r[n]=[]),r[n].push(s)}return r}const O=k(({model:e})=>{const{trackAdapter:a}=e,{pluginManager:r}=c.getEnv(e);return t.jsx(v,{value:(a==null?void 0:a.type)!=="UNKNOWN"?a==null?void 0:a.type:"",label:"Adapter type",variant:"outlined",select:!0,fullWidth:!0,onChange:s=>{e.setAdapterHint(s.target.value)},slotProps:{select:{SelectDisplayProps:{"data-testid":"adapterTypeSelect"}}},children:Object.entries(ee(r.getAdapterElements().filter(s=>{var n;return!(!((n=s.adapterMetadata)===null||n===void 0)&&n.hiddenFromGUI)}))).map(([s,n])=>[t.jsx(L,{children:s},s),n.map(i=>t.jsx(N,{value:i.name,children:i.displayName},i.name))])})}),te=j()(e=>({spacing:{marginBottom:e.spacing(3)}}));function ae({model:e}){const{classes:a}=te();return t.jsxs(t.Fragment,{children:[t.jsxs(b,{className:a.spacing,children:["JBrowse was not able to guess the adapter type for this data, but it may be in the list below. If not, you can"," ",t.jsx(f.ExternalLink,{href:"https://github.com/GMOD/jbrowse-components/releases",children:"check for new releases"})," ","of JBrowse to see if they support this data type or"," ",t.jsx(f.ExternalLink,{href:"https://github.com/GMOD/jbrowse-components/issues/new",children:"file an issue"})," ","and add a feature request for this data type."]}),t.jsx(O,{model:e})]})}const se=j()(e=>({paper:{display:"flex",flexDirection:"column",padding:e.spacing(1)},card:{marginTop:e.spacing(1)}})),ne=k(function({model:e}){const{classes:a}=se(),[r,s]=d.useState(""),[n,i]=d.useState(""),[o,l]=d.useState(["Name","ID"]),[u,m]=d.useState(["CDS","exon"]),y=[{label:"Indexing attributes",values:o},{label:"Feature types to exclude",values:u}];return d.useEffect(()=>{e.setTextIndexingConf({attributes:o,exclude:u})},[e,o,u]),t.jsxs(P,{className:a.paper,children:[t.jsx(C,{children:"Indexing configuration"}),y.map((p,g)=>t.jsx(q,{raised:!0,className:a.card,children:t.jsxs(H,{children:[t.jsx(C,{children:p.label}),t.jsxs($,{disablePadding:!0,children:[p.values.map((h,x)=>t.jsx(E,{disableGutters:!0,children:t.jsx(v,{value:h,slotProps:{input:{endAdornment:t.jsx(A,{position:"end",children:t.jsx(D,{onClick:()=>{const T=p.values.filter((ke,B)=>B!==x);g===0?l(T):m(T)},children:t.jsx(R,{})})})}}})},`${h}-${x}`)),t.jsx(E,{disableGutters:!0,children:t.jsx(v,{value:g===0?r:n,placeholder:"add new",onChange:h=>{g===0?s(h.target.value):i(h.target.value)},slotProps:{input:{endAdornment:t.jsx(A,{position:"end",children:t.jsx(D,{onClick:()=>{g===0?(l([...o,r]),s("")):(m([...u,n]),i(""))},disabled:g===0?r==="":n==="","data-testid":"stringArrayAdd-Feat",children:t.jsx(G,{})})})}}})})]})]})},p.label))]})}),re=k(function({model:e}){const{pluginManager:a}=c.getEnv(e),{trackType:r}=e,s=a.getTrackElements();return t.jsx(v,{value:r,variant:"outlined",label:"Track type",select:!0,fullWidth:!0,onChange:n=>{e.setTrackType(n.target.value)},slotProps:{select:{SelectDisplayProps:{"data-testid":"trackTypeSelect"}}},children:s.map(({name:n,displayName:i})=>t.jsx(N,{value:n,children:i},n))})}),oe=j()(e=>({spacing:{marginBottom:e.spacing(3)}}));function ie(){const{classes:e}=oe();return t.jsxs(b,{className:e.spacing,children:["This version of JBrowse cannot display data of this type. It is possible, however, that there is a newer version that can display them. You can"," ",t.jsx(f.ExternalLink,{href:"https://github.com/GMOD/jbrowse-components/releases",children:"check for new releases"})," ","of JBrowse or"," ",t.jsx(f.ExternalLink,{href:"https://github.com/GMOD/jbrowse-components/issues/new",children:"file an issue"})," ","and add a feature request for this data type."]})}const le=j()(e=>({spacing:{marginBottom:e.spacing(3)}})),ce=k(function({model:e}){const{classes:a}=le(),[r,s]=d.useState(!0),n=c.getSession(e),{trackName:i,unsupported:o,trackAdapter:l,trackType:u,warningMessage:m,adapterHint:y}=e;if(d.useEffect(()=>{y===""&&l&&e.setAdapterHint(l.type)},[y,l,l==null?void 0:l.type,e]),o)return t.jsx(ie,{});if((l==null?void 0:l.type)===J.UNKNOWN)return t.jsx(ae,{model:e});if(l!=null&&l.type){const p=c.isSupportedIndexingAdapter(l.type),{pluginManager:g}=c.getEnv(e),h=g.evaluateExtensionPoint("Core-addTrackComponent",({model:x})=>t.jsx(f.AssemblySelector,{session:n,helperText:"Select assembly to add track to",selected:x.assembly,onChange:T=>{x.setAssembly(T)},TextFieldProps:{fullWidth:!0,SelectProps:{SelectDisplayProps:{"data-testid":"assemblyNameSelect"}}}}),{model:e});return t.jsxs("div",{children:[t.jsx(_,{trackAdapter:l,trackType:u}),m?t.jsx(b,{color:"warning",children:m}):null,t.jsx(v,{className:a.spacing,label:"trackName",helperText:"A name for this track",fullWidth:!0,value:i,onChange:x=>{e.setTrackName(x.target.value)},slotProps:{htmlInput:{"data-testid":"trackNameInput"}}}),t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[t.jsx(O,{model:e}),t.jsx(re,{model:e}),t.jsx(d.Suspense,{fallback:null,children:t.jsx(h,{model:e})})]}),c.isElectron&&p&&t.jsx(I,{children:t.jsx(Y,{label:"Index track for text searching?",control:t.jsx(K,{checked:r,onChange:x=>{s(x.target.checked),e.setTextIndexTrack(x.target.checked)}})})}),c.isElectron&&r&&p?t.jsx(ne,{model:e}):null]})}else return t.jsx(b,{children:"Could not recognize this data type."})}),de=j()(e=>({paper:{padding:e.spacing(2)},spacer:{height:e.spacing(8)}})),pe=k(function({model:e}){const{classes:a}=de(),r=M(e);return t.jsxs(P,{className:a.paper,children:[t.jsx(f.FileSelector,{name:"Main file",description:"",location:e.trackData,setLocation:e.setTrackData,setName:e.setTrackName,rootModel:r}),t.jsx("div",{className:a.spacer}),t.jsx(f.FileSelector,{name:"Index file",description:"(Optional) The URL of the index file is automatically inferred from the URL of the main file if it is not supplied.",location:e.indexTrackData,setLocation:e.setIndexTrackData,setName:e.setTrackName,rootModel:r})]})});function ue({trackId:e,model:a}){const{textIndexingConf:r,trackName:s,assembly:n}=a,{jobsManager:i}=M(a),o=r||{attributes:["Name","ID"],exclude:["CDS","exon"]},l=`${s}-index`;i.queueJob({indexingParams:{...o,assemblies:[n],tracks:[e],indexType:"perTrack",name:l,timestamp:new Date().toISOString()},name:l,cancelCallback:()=>i.abortJob()})}function me({model:e}){var a;const{textIndexTrack:r,trackAdapter:s,view:n}=e,i=c.getSession(e),o=e.getTrackConfig(Date.now());if(c.isSessionWithAddTracks(i))if(o&&s){const{trackId:l}=o;i.addTrackConf(o),(a=n==null?void 0:n.showTrack)===null||a===void 0||a.call(n,l),c.isElectron&&r&&c.isSupportedIndexingAdapter(s.type)&&ue({model:e,trackId:l}),e.clearData(),c.isSessionModelWithWidgets(i)&&i.hideWidget(e)}else throw new Error(`Failed to add track.
The configuration of this file is not currently supported.`);else throw new Error("Can't add tracks to this session")}const he=j()(e=>({root:{marginTop:e.spacing(1)},stepper:{backgroundColor:e.palette.background.default},button:{marginRight:e.spacing(1)},actionsContainer:{marginTop:e.spacing(10),marginBottom:e.spacing(2)},alertContainer:{padding:`${e.spacing(2)}px 0px ${e.spacing(2)}px 0px`}})),w=["Enter track data","Confirm track type"],xe=k(function({model:e}){const[a,r]=d.useState(0),{classes:s}=he(),{assembly:n,trackAdapter:i,trackData:o,trackName:l,trackType:u}=e;function m(p){switch(p){case 0:return t.jsx(pe,{model:e});case 1:return t.jsx(ce,{model:e});default:return t.jsx(b,{children:"Unknown step"})}}function y(){switch(a){case 0:return!o;case 1:return!(l&&u&&i!=null&&i.type&&n);default:return!0}}return t.jsx("div",{className:s.root,children:t.jsx(Q,{className:s.stepper,activeStep:a,orientation:"vertical",children:w.map((p,g)=>t.jsxs(X,{children:[t.jsx(z,{children:p}),t.jsxs(V,{children:[m(g),t.jsxs("div",{className:s.actionsContainer,children:[t.jsx(S,{disabled:a===0,className:s.button,onClick:()=>{r(a-1)},"data-testid":"addTrackBackButton",children:"Back"}),t.jsx(S,{disabled:y(),variant:"contained",color:"primary",onClick:()=>{if(a!==w.length-1)r(a+1);else try{me({model:e})}catch(h){c.getSession(e).notifyError(`${h}`,h)}},className:s.button,"data-testid":"addTrackNextButton",children:a===w.length-1?"Add":"Next"})]})]})]},p))})})}),ge=j()({textbox:{width:"100%"},submit:{marginTop:25,marginBottom:100,display:"block"}}),fe=k(function({model:e}){const{classes:a}=ge(),[r,s]=d.useState(""),[n,i]=d.useState();return t.jsxs("div",{children:[n?t.jsx(f.ErrorMessage,{error:n}):null,t.jsx(v,{multiline:!0,rows:10,value:r,placeholder:"Paste track config or array of track configs in JSON format",variant:"outlined",className:a.textbox,onChange:o=>{s(o.target.value)}}),t.jsx(S,{variant:"contained",className:a.submit,onClick:()=>{try{i(void 0);const o=c.getSession(e),l=JSON.parse(r),u=Array.isArray(l)?l:[l];c.isSessionWithAddTracks(o)&&c.isSessionModelWithWidgets(o)&&(F(()=>{for(const m of u)o.addTrackConf(m);for(const m of u)e.view.showTrack(m.trackId);e.clearData()}),o.hideWidget(e))}catch(o){console.error(o),i(o)}},children:"Submit"})]})}),Ie=k(function({model:e}){const[a,r]=d.useState("Default add track workflow"),s={"Default add track workflow":xe,"Add track JSON":fe,...Object.fromEntries(c.getEnv(e).pluginManager.getAddTrackWorkflowElements().map(o=>[o.name,o.ReactComponent]))},n=s[a]?a:"Default add track workflow",i=s[n];return t.jsxs(t.Fragment,{children:[t.jsxs(I,{children:[t.jsx(W,{value:n,onChange:o=>{r(o.target.value)},children:Object.keys(s).map(o=>t.jsx(N,{value:o,children:o},o))}),t.jsx(U,{children:"Type of add track workflow"})]}),t.jsx(d.Suspense,{fallback:null,children:t.jsx(i,{model:e})})]})});export{Ie as default};
