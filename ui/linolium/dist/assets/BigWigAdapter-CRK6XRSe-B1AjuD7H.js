import{P as y,M as P}from"./bbi-DEvpxuLy-BtN8_9V6.js";import"./remoteFile-DvhH--az-9OF1arfw.js";import{e as S}from"./index-Bp4pXTEU-Cipcrd2k.js";import{a1 as v,u as h,aY as N}from"./JBrowsePanel-CjeUdi3D-Dhrr89W5.js";import{o as x}from"./rxjs-euq-mp90-DvajfGj-.js";import"./browser-BpRiKmO--zAOSyNoU.js";import"./AbortablePromiseCache-CcuMrnn7-56xRj2xE.js";import"./Observable-ztGTW3Os-DRs2VX0K.js";import"./taxonium-component.es-D8UFPkMd.js";import"./index-Bwk-R6QR.js";class C extends y{async getView(e,t){const{zoomLevels:a,refsByName:r,uncompressBufSize:n}=await this.getHeader(t),u=1/e,c=a.length-1;for(let i=c;i>=0;i-=1){const o=a[i];if(o&&o.reductionLevel<=2*u)return new P(this.bbi,r,o.indexOffset,n>0,"summary")}return this.getUnzoomedView(t)}}var L=N();class B extends S.BaseFeatureDataAdapter{async setupPre(e){const{statusCallback:t=()=>{}}=e||{},a=this.pluginManager,r=new C({filehandle:v.openLocation(this.getConf("bigWigLocation"),a)});return{bigwig:r,header:await h.updateStatus("Downloading bigwig header",t,()=>r.getHeader(e))}}async setup(e){return this.setupP||(this.setupP=this.setupPre(e).catch(t=>{throw this.setupP=void 0,t})),this.setupP}async getRefNames(e){const{header:t}=await this.setup(e);return Object.keys(t.refsByName)}async refIdToName(e){var t;const{header:a}=await this.setup();return(t=a.refsByNumber[e])===null||t===void 0?void 0:t.name}async getGlobalStats(e){const{header:t}=await this.setup(e);return L.rectifyStats(t.totalSummary)}getFeatures(e,t={}){const{refName:a,start:r,end:n}=e,{bpPerPx:u=0,resolution:c=1,stopToken:i,statusCallback:o=()=>{}}=t;return x.ObservableCreate(async l=>{const p=this.getConf("source"),g=this.getConf("resolutionMultiplier"),{bigwig:f}=await this.setup(t),w=await h.updateStatus("Downloading bigwig data",o,()=>f.getFeatures(a,r,n,{...t,basesPerSpan:u/c*g}));for(const s of w){p&&(s.source=p);const m=`${p}:${e.refName}:${s.start}-${s.end}`;s.refName=a,s.uniqueId=m,l.next({get:b=>s[b],id:()=>m,toJSON:()=>s})}l.complete()},i)}async getMultiRegionFeatureDensityStats(e){return{featureDensity:0}}}B.capabilities=["hasResolution","hasLocalStats","hasGlobalStats"];export{B as default};
