import{M as b,N as v,u,O as B,j as S,s as m,t as w}from"./JBrowsePanel-CjeUdi3D-Dhrr89W5.js";import"./index-Bwk-R6QR.js";import"./taxonium-component.es-D8UFPkMd.js";async function C(t,a){const{rpcManager:r}=u.getSession(t),o=m.getConf(t,"numStdDev")||3,{adapterConfig:g,autoscaleType:e}=t,i=w.getRpcSessionId(t),{currStatsBpPerPx:c}=a,p={sessionId:i,adapterConfig:g,statusCallback:s=>{S(t)&&t.setMessage(s)},...a};if(e==="global"||e==="globalsd"){const s=await r.call(i,"WiggleGetGlobalQuantitativeStats",p),{scoreMin:d,scoreMean:n,scoreStdDev:l}=s;return e==="globalsd"?{...s,scoreMin:d>=0?0:n-o*l,scoreMax:n+o*l,currStatsBpPerPx:c}:{...s,currStatsBpPerPx:c}}if(e==="local"||e==="localsd"){const{dynamicBlocks:s,bpPerPx:d}=u.getContainingView(t),n=await r.call(i,"WiggleGetMultiRegionQuantitativeStats",{...p,regions:s.contentBlocks.map(M=>{const{start:x,end:y}=M;return{...JSON.parse(JSON.stringify(M)),start:Math.floor(x),end:Math.ceil(y)}}),bpPerPx:d}),{scoreMin:l,scoreMean:P,scoreStdDev:f}=n;return e==="localsd"?{...n,scoreMin:l>=0?0:P-o*f,scoreMax:P+o*f,currStatsBpPerPx:c}:{...n,currStatsBpPerPx:c}}if(e==="zscale")return r.call(i,"WiggleGetGlobalQuantitativeStats",p);throw new Error(`invalid autoscaleType '${e}'`)}function h(t){b(t,v(async()=>{try{if(t.quantitativeStatsReady){const a=u.getContainingView(t),r=B.createStopToken();t.setStatsLoading(r);const o=JSON.stringify(a.dynamicBlocks),g=await C(t,{stopToken:r,filters:[],currStatsBpPerPx:a.bpPerPx,...t.adapterProps()});S(t)&&t.updateQuantitativeStats(g,o)}}catch(a){S(t)&&!u.isAbortException(a)&&(console.error(a),t.setError(a))}},{delay:1e3}))}export{h as getQuantitativeStatsAutorun};
